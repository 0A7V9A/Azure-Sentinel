// Name : Detect Member server Petya antimalware
// Description : Petya antimalware detected on member server
WindowsEvent
| where Provider == "Microsoft-Windows-Security-Auditing" and EventID in (1116,1117,1118,1119)
| extend File = Data.[21], Folder = Data.[18], ThreadName = Data.[07]
| where ThreadName contains "Petya" or ((File contains "medoc" or Folder contains "medoc") or (File contains "ezvit.exe" or Folder contains "ezvit.exe") or (File contains "UniCryptC" or Folder contains "UniCryptC") or (File contains "UDE_File_Cache" or Folder contains "UDE_File_Cache"))
| extend  HostCustomEntity = Computer // Entity extraction for computer