// Id: 5b57680b-d60a-42a5-9cd5-17e499834f8e
// DisplayName: Hosts Sending Most Amount of Data to IP
// Description: Hosts Sending Most Amount of Data to IP
// InputEntityType: IP
// InputFields: [Address]
// OutputEntityTypes: [Host]
// QueryPeriodBefore: 1d
// QueryPeriodAfter: 1d
// DataSource: WireData
// Tactics: #Exfiltration, #CommandAndControl, #Collection
		
let HostsSendingDatatoIP = (v_ipAddress:string){
WireData
| where SessionState == "Disconnected" 
| where RemoteIP == v_ipAddress
| summarize Host_Aux_BytesSent = sum(SentBytes) by Computer, LocalIP
| top 10 by Host_Aux_BytesSent desc nulls last 
| project-rename Host_HostName = Computer
};
HostsSendingDatatoIP(<Address>)
