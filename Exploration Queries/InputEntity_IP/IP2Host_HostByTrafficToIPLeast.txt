// Id: ab597a67-352e-4914-b2e6-d64919a910a8
// DisplayName: Hosts Sending Least Amount of Data to IP
// Description: Hosts sending least amount of data to IP during the range of -1d and +1d
// InputEntityType: IP
// InputFields: [Address]
// OutputEntityTypes: [Host]
// QueryPeriodBefore: 1d
// QueryPeriodAfter: 1d
// DataSource: WireData
// Tactics: #Exfiltration, #CommandAndControl, #Collection
		
let HostsSendingDatatoIP = (v_ipAddress:string){
WireData
| where SessionState == "Disconnected" 
| where RemoteIP == v_ipAddress
| summarize Host_Aux_BytesSent = sum(SentBytes) by Computer, LocalIP
| top 10 by Host_Aux_BytesSent asc nulls last 
| project-rename Host_HostName = Computer
};
HostsSendingDatatoIP(<Address>)
