Id: de95c467-531d-4813-a187-ed96a40846fe
DisplayName: Custom Ip Expansion Query
Description: This investigation query runs custom function CustomIpExpansion()
InputEntityType: Ip
InputFields:
  - Address
OutputEntityTypes:
  - Host
  - Ip
  - Account
  - Process
  - File
QueryPeriodBefore: 1d
QueryPeriodAfter: 1d
DataSources:
    - SecurityEvent
Tactics: 
  - Discovery
query: |
  let GenericExpansionResult=datatable(
    Host_HostName:string, Host_NTDomain:string, Host_DnsDomain:string, Host_Aux_Other:string,
    IP_Address:string, IP_Aux_Other:string,
    Account_Name:string, Account_NTDomain:string, Account_UPNSuffix:string, Account_AadUserId:string, Account_Aux_Other:string,
    Process_Account_Name:string, Process_Account_NTDomain:string, Process_Account_UnstructuredName:string, Process_Host_UnstructuredName:string, Process_ProcessId:string, Process_ImageFile_FullPath:string, Process_Aux_Other:string,
    File_Name:string, File_FullPath:string, File_Aux_Other:string)[];
  union isfuzzy=true
  GenericExpansionResult,
  CustomIpExpansion('<Address>')
  | project Host_HostName, Host_NTDomain, Host_DnsDomain, Host_Aux_Other, 
      IP_Address, IP_Aux_Other, 
      Account_Name, Account_NTDomain, Account_UPNSuffix, Account_AadUserId, Account_Aux_Other, 
      Process_Account_Name, Process_Account_NTDomain, Process_Account_UnstructuredName, Process_Host_UnstructuredName, Process_ProcessId, Process_ImageFile_FullPath, Process_Aux_Other, 
      File_Name, File_FullPath, File_Aux_Other
