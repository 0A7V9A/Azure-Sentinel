// Name: Processes executed from base-encoded PE files
//
// Id: ca67c83e-7fff-4127-a3e3-1af66d6d4cad
//
// Description: Finding base64 encoded PE files header seen in the command line parameters.
//
// Tactics: #Initial Access, #Execution, #Defense Evasion
//
let ProcessCreationEvents=() {
let processEvents=SecurityEvent
| where EventID==4688
| project  TimeGenerated, ComputerName=Computer,AccountName=SubjectUserName, AccountDomain=SubjectDomainName, FileName=tostring(split(NewProcessName, '\\')[-1]),
ProcessCommandLine = CommandLine, InitiatingProcessFileName=ParentProcessName;
processEvents};
ProcessCreationEvents
| where ProcessCommandLine contains 'TVqQAAMAAAAEAAA'