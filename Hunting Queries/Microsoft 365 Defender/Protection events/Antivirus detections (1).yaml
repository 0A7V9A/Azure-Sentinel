id: 05250700-5123-45be-826d-dd14c623fade
name: Antivirus detections (1)
description: |-
  Query for Microsoft Defender Antivirus detections.
  Query #1: Query for Antivirus detection events.
requiredDataConnectors:
- connectorId: Microsoft365Defender
  dataTypes:
  - AlertInfo
  - AlertEvidence
query: "// Query #2:\r\n//    This query select only machines where more than 1 malware family was detected.\r\n//    Such behavior is usually indicative that some malware was active on the machine\r\n// Implementation details:\r\n//    This query looks for alerts on Windows Defender Antivirus detections.\r\n//    For most purposes it is probably better to query on the events themselves (see query #1).\r\n//    However, this query might still be useful sometimes (e.g. to quickly parse the family name).\r\nAlertInfo | join AlertEvidence on AlertId\r\n| where Title contains \"Defender AV detected\"\r\n| parse Title with *\"'\"FamilyName\"'\"*\r\n| summarize FamilyCount=dcount(FamilyName), Families=makeset(FamilyName), Titles=makeset(Title) by DeviceName, DeviceId, bin(Timestamp, 1d)\r\n| where FamilyCount > 1\r\n| limit 100 "
