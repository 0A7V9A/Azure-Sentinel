id: c1f6dbf3-9a97-4577-a249-a272a86d99ec
name: powershell-version-2.0-execution
description: |-
  Find the execution of PowerShell Version 2.0, eather to discover legacy scripts using version 2 or to find attackers trying to hide from script logging and AMSI.
requiredDataConnectors:
- connectorId: Microsoft365Defender
  dataTypes:
  - DeviceProcessEvents
tactics:
- Execution
query: |-
  DeviceProcessEvents
  | where FileName in~ ("powershell.exe", "powershell_ise.exe")
  | where ProcessCommandLine has "-v 2"
     or ProcessCommandLine has "-v 2.0"
     or ProcessCommandLine has "-version 2"
     or ProcessCommandLine has "-version 2.0"
