id: cdac93ef-56c0-45bf-9e7f-9cbf0ad06808
name: Appspot Phishing Abuse
description: |
  This query helps surface phishing campaigns associated with Appspot abuse. These emails frequently contain phishing links that utilize the recipients' own email address as a unique identifier in the URI.
  This campaign was published on Twitter by @MsftSecIntel at this link: https://twitter.com/MsftSecIntel/status/1374148156301004800
  Reference - https://twitter.com/MsftSecIntel
requiredDataConnectors:
- connectorId: Microsoft365Defender
  dataTypes:
  - EmailUrlInfo
  - EmailEvents
tactics:
- Initial access
query: "EmailUrlInfo\r\n// Detect URLs with a subdomain on appspot.com\r\n| where UrlDomain matches regex @'\\b[\\w\\-]+-dot-[\\w\\-\\.]+\\.appspot\\.com\\b'\r\n// Enrich results with sender and recipient data\r\n| join kind=inner EmailEvents on $left.NetworkMessageId==$right.NetworkMessageId\r\n// Phishing attempts from Appspot related campaigns typically contain the recipient's email address in the URI\r\n// Example 1: https://example-dot-example.appspot.com/#recipient@domain.com\r\n// Example 2: https://example-dot-example.appspot.com/index.html?user=recipient@domain.com\r\n| where Url has RecipientEmailAddress\r\n    // Some phishing campaigns pass recipient email as a Base64 encoded string in the URI\r\n    or Url has base64_encode_tostring(RecipientEmailAddress)\r\n| project-away Timestamp1, NetworkMessageId1, ReportId1 "
