OfficeActivity
| where RecordType startswith "Az"
| where Operation startswith "UserLoggedIn"
| extend UserAgent = extractjson("$[0].Value", ExtendedProperties, typeof(string))
| extend machineIndex=indexof(UserAgent, "machine_id") 
| extend UserAgent = substring(UserAgent, 0, machineIndex) 
| project Operation, UserId, TimeGenerated , UserAgent, ClientIP 
| summarize userAgentCount=count() by UserAgent, ClientIP
| sort by userAgentCount desc;