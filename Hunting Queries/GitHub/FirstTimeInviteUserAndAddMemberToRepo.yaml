id: c3237d88-fdc4-4dee-8b90-118ded2c507c
name: GitHub First Time Invite Member and Add Member to Repo
description: |
  'This hunting query identifies GitHub activites where a user was invited and added to a repo for the first time that may be a sign of compromise.'
requiredDataConnectors:
  - connectorId: CustomConnector
    dataTypes:
      - GitHub_CL
tactics:
  - Persistence
relevantTechniques:
  - T1136
query: |

  let LearningPeriod = 7d;
  let RunTime = 1h;
  let StartTime = 1h;
  let EndRunTime = StartTime - RunTime;
  let EndLearningTime = StartTime + LearningPeriod;
  let GitHubOrgMemberLogs = (GitHub_CL
  | extend TimeGenerated = node_createdAt_t
  | where node_action_s == "org.invite_member" or node_action_s == "org.update_member" or node_action_s == "org.add_member");
  GitHubOrgMemberLogs
  | where TimeGenerated between (ago(EndLearningTime) .. ago(StartTime))
  | distinct node_actorLogin_s
  | join kind=rightanti (
    GitHubOrgMemberLogs
    | where TimeGenerated between (ago(StartTime) .. ago(EndRunTime))
    | distinct node_actorLogin_s
  ) on node_actorLogin_s

