id: f18c4dfb-4fa6-4a9d-9bd3-f7569d1d685a
name: GitHub User Grants Access and Other User Grants Access
description: |
  'This hunting query identifies Accounts in GitHub that have granted access to another account which then grants access to yet another account that may be a sign of compromise.'
requiredDataConnectors:
  - connectorId: CustomConnector
    dataTypes:
      - GitHub_CL
tactics:
  - Persistence
relevantTechniques:
  - T1098
query: |

  GitHub_CL
  | where userLogin_s != ""
  | where action_s == "org.invite_member" or action_s == "org.add_member" or action_s == "team.add_member" or action_s == "repo.add_member"
  | distinct userLogin_s, createdAt_t, actorLogin_s
  | project-rename firstUserAdded = userLogin_s, firstEventTime = createdAt_t, firstAdderUser = actorLogin_s
  | join kind= innerunique (
    GitHub_CL
    | where userLogin_s != ""
    | where action_s == "org.invite_member" or action_s == "org.add_member" or                                 action_s == "team.add_member" or action_s == "repo.add_member"
    | distinct userLogin_s, createdAt_t, actorLogin_s
    | project-rename secondUserAdded = userLogin_s, secondEventTime = createdAt_t, secondAdderUser = actorLogin_s
  ) on $right.secondAdderUser == $left.firstUserAdded
  | where secondEventTime between (firstEventTime .. (firstEventTime + 1h))
