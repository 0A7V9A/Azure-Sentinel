id: f041e01d-840d-43da-95c8-4188f6cef546
name: GitHub Activites from a New Country
description: |
  'This alerts when there is an actitity from a new country.'
severity: Medium
requiredDataConnectors:
  - connectorId: CustomConnector
    dataTypes:
      - GitHub_CL
queryFrequency: 1d
queryPeriod: 1d
triggerOperator: gt
triggerThreshold: 0
tactics:
  - InitalAccess
relevantTechniques:
  - T1078
query: |

  let LearningPeriod = 7d;
  let RunTime = 1h;
  let StartTime = 1h;
  let EndRunTime = StartTime - RunTime;
  let EndLearningTime = StartTime + LearningPeriod;
  let GitHubCountryCodeLogs = (GitHub_CL
  | extend TimeGenerated = node_createdAt_t
  | where node_actorLocation_countryCode_s != "");
    GitHubCountryCodeLogs
  | where TimeGenerated between (ago(EndLearningTime) .. ago(StartTime))
  | summarize makeset(node_actorLocation_countryCode_s) by node_actorLogin_s
  | join kind=innerunique (
    GitHubCountryCodeLogs
    | where TimeGenerated between (ago(StartTime) .. ago(EndRunTime))
    | distinct node_actorLocation_countryCode_s, node_actorLogin_s 
  ) on node_actorLogin_s 
  | where set_node_actorLocation_countryCode_s !contains node_actorLocation_countryCode_s
