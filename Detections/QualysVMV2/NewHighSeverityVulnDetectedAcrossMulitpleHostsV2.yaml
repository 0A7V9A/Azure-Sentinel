id: 6116dc19-475a-4148-84b2-efe89c073e27
name: New High Severity Vulnerability Detected Across Multiple Hosts
description: |
  'This creates an incident when a new high severity vulnerability is detected across multilple hosts'
severity: Medium
requiredDataConnectors:
  - connectorId: QualysVulnerabilityManagementV2
    dataTypes: 
      - QualysHostDetection_CL
queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
tactics:
  - InitialAccess
relevantTechniques:
  - T1190
query: |

  let threshold = 10;
  QualysHostDetection_CL
  | mv-expand todynamic(Detections_s)
  | extend Status = tostring(Detections_s.Status), Vulnerability = tostring(Detections_s.Results), Severity = tostring(Detections_s.Severity)
  | where Status =~ "New" and Severity == "5"
  | summarize StartTime = min(TimeGenerated), EndTime = max(TimeGenerated), dcount(NetBios_s) by tostring(Detections_s.QID)
  | where dcount_NetBios_s >= threshold
  | extend timestamp = StartTime
version: 1.0.0