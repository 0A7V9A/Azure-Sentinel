// Name: Suspect User Agent connection attempt
//
// Id: f845881e-2500-44dc-8ed7-b372af3e1e25
//
// Description: Connection attempts (success or fail) from clients with short User Agent strings
//
// DataSource: #W3CIISLog
//
// Severity: Low
//
// QueryFrequency: 24h
//
// QueryPeriod: 24h
//
// AlertTriggerOperator: lte
//
// AlertTriggerThreshold: 4 - can adjust higher as needed
//
// Techniques: #InitialAccess, #Discovery
//
W3CIISLog | where TimeGenerated >= ago(1d)
// The below line can be used to exclude local IPs if these create noise
//| where cIP !startswith "192.168." and cIP != "::1"
| where isnotempty(csUserAgent) and csUserAgent != "-" and string_size(csUserAgent) <= 4