id: ce65b00f-014c-4950-85fd-09f85d68c801
name: (Private Preview) CMMC Identification & Authentication Control Family Monitoring
description: |
  'CMMC Control Assessments have Deviated from Configured Threshold Baselines'
severity: Medium
requiredDataConnectors:
  - connectorId: AzureSecurityCenter
    dataTypes:
      - SecurityAlert (ASC)
queryFrequency: 7d
queryPeriod: 7d
triggerOperator: gt
triggerThreshold: 0
tactics:
  - Discovery
relevantTechniques:
  - T1082
query: |

let Policymap = datatable(RecommendationName:string, ControlFamily:string, ControlNumber:string, MaturityLevel:string, 800171Map:string, 80053Map:string)
[
'Add system-assigned managed identity to enable Guest Configuration assignments on virtual machines with no identities',	'Identification & Authentication',	'IA.1.077',	'ML-1',	'3.5.2',	'IA-2, IA-3, IA-5',
'Deploy the Windows Guest Configuration extension to enable Guest Configuration assignments on Windows VMs',	'Identification & Authentication',	'IA.1.077',	'ML-1',	'3.5.2',	'IA-2, IA-3, IA-5',
'Audit Linux machines that have accounts without passwords',	'Identification & Authentication',	'IA.1.077',	'ML-1',	'3.5.2',	'IA-2, IA-3, IA-5',
'Audit Linux machines that do not have the passwd file permissions set to 0644',	'Identification & Authentication',	'IA.1.077',	'ML-1',	'3.5.2',	'IA-2, IA-3, IA-5',
'Add system-assigned managed identity to enable Guest Configuration assignments on virtual machines with no identities',	'Identification & Authentication',	'IA.2.078',	'ML-2',	'3.5.7',	'IA-5(1)',
'Audit Windows machines that do not restrict the minimum password length to 14 characters',	'Identification & Authentication',	'IA.2.078',	'ML-2',	'3.5.7',	'IA-5(1)',
'Deploy the Windows Guest Configuration extension to enable Guest Configuration assignments on Windows VMs',	'Identification & Authentication',	'IA.2.078',	'ML-2',	'3.5.7',	'IA-5(1)',
'Audit Windows machines that do not have the password complexity setting enabled',	'Identification & Authentication',	'IA.2.078',	'ML-2',	'3.5.7',	'IA-5(1)',
'Add system-assigned managed identity to enable Guest Configuration assignments on virtual machines with no identities',	'Identification & Authentication',	'IA.2.079',	'ML-2',	'3.5.8',	'IA-5(1)',
'Audit Windows machines that allow re-use of the previous 24 passwords',	'Identification & Authentication',	'IA.2.079',	'ML-2',	'3.5.8',	'IA-5(1)',
'Deploy the Windows Guest Configuration extension to enable Guest Configuration assignments on Windows VMs',	'Identification & Authentication',	'IA.2.079',	'ML-2',	'3.5.8',	'IA-5(1)',
'Add system-assigned managed identity to enable Guest Configuration assignments on VMs with a user-assigned identity',	'Identification & Authentication',	'IA.2.079',	'ML-2',	'3.5.8',	'IA-5(1)',
'Add system-assigned managed identity to enable Guest Configuration assignments on virtual machines with no identities',	'Identification & Authentication',	'IA.2.079',	'ML-2',	'3.5.10',	'IA-5(1)',
'Audit Windows machines that do not store passwords using reversible encryption',	'Identification & Authentication',	'IA.2.079',	'ML-2',	'3.5.10',	'IA-5(1)',
'Deploy the Windows Guest Configuration extension to enable Guest Configuration assignments on Windows VMs',	'Identification & Authentication',	'IA.2.079',	'ML-2',	'3.5.10',	'IA-5(1)',
'Add system-assigned managed identity to enable Guest Configuration assignments on VMs with a user-assigned identity',	'Identification & Authentication',	'IA.2.079',	'ML-2',	'3.5.10',	'IA-5(1)',
'MFA should be enabled on accounts with owner permissions on your subscription',	'Identification & Authentication',	'IA.3.083',	'ML-3',	'3.5.3',	'IA-2(1), IA-2(2), IA-2(3)',
'MFA should be enabled on accounts with write permissions on your subscription',	'Identification & Authentication',	'IA.3.083',	'ML-3',	'3.5.3',	'IA-2(1), IA-2(2), IA-2(3)',
'MFA should be enabled on accounts with read permissions on your subscription',	'Identification & Authentication',	'IA.3.083',	'ML-3',	'3.5.3',	'IA-2(1), IA-2(2), IA-2(3)',
'Function App should only be accessible over HTTPS',	'Identification & Authentication',	'IA.3.084',	'ML-3',	'3.5.4',	'IA-2(8),IA-2(9)',
'Web Application should only be accessible over HTTPS',	'Identification & Authentication',	'IA.3.084',	'ML-3',	'3.5.4',	'IA-2(8),IA-2(9)',
'MFA should be enabled on accounts with owner permissions on your subscription',	'Identification & Authentication',	'IA.3.084',	'ML-3',	'3.5.4',	'IA-2(8),IA-2(9)',
'MFA should be enabled on accounts with write permissions on your subscription',	'Identification & Authentication',	'IA.3.084',	'ML-3',	'3.5.4',	'IA-2(8),IA-2(9)',
'MFA should be enabled on accounts with read permissions on your subscription',	'Identification & Authentication',	'IA.3.084',	'ML-3',	'3.5.4',	'IA-2(8),IA-2(9)'
];
SecurityRecommendation
| join kind=rightouter Policymap on RecommendationName
| where ControlFamily == 'System & Information Integrity'
| summarize
    Assessments = count(),
    Success = countif(RecommendationState == 'Healthy' or RecommendationState == 'NotApplicable'),
    Failed = countif(RecommendationState == 'Unhealthy')
    by ControlFamily, ControlNumber, MaturityLevel, RecommendationName, AssessedResourceId
| extend SuccessRatePercentage = (Success * 100 / Assessments)
| extend FailedRatePercentage = (Failed * 100 / Assessments)
| project
    ControlNumber,
    ControlFamily,
    MaturityLevel,
    RecommendationName,
    Assessments,
    SuccessRatePercentage,
    FailedRatePercentage,
    AssessedResourceId
| where RecommendationName <> ''
// | where RecommendationName <> '' //Filter Out or Suppress Recommendations
// | where MaturityLevel == 'ML-3' //Filter by Maturity Level 
| where FailedRatePercentage > 30 //Adjust Either FailedRatePercentage or PasedRatePercentage Thresholds within Organizational Needs
| sort by FailedRatePercentage desc
| limit 250
| extend HostCustomEntity = AssessedResourceId

entityMappings:
  - entityType: Host
    fieldMappings:
      - identifier: FullName
        columnName: HostCustomEntity
version: 1.0.0
