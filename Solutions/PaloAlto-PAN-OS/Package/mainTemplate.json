{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for PaloAlto-PAN-OS"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "solutionId": "azuresentinel.azure-sentinel-solution-paloaltopanos",
    "_solutionId": "[variables('solutionId')]",
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "PaloAltoCustomConnector": "PaloAltoCustomConnector",
    "_PaloAltoCustomConnector": "[variables('PaloAltoCustomConnector')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "PaloAltoCustomConnector",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'-lc-',uniquestring(variables('_playbookContentId1')))]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "blanks": "[replace('b', 'b', '')]",
    "PaloAlto-PAN-OS-GetSystemInfo": "PaloAlto-PAN-OS-GetSystemInfo",
    "_PaloAlto-PAN-OS-GetSystemInfo": "[variables('PaloAlto-PAN-OS-GetSystemInfo')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "PaloAlto-PAN-OS-GetSystemInfo",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2')))]",
    "PaloAlto-PAN-OS-GetThreatPCAP": "PaloAlto-PAN-OS-GetThreatPCAP",
    "_PaloAlto-PAN-OS-GetThreatPCAP": "[variables('PaloAlto-PAN-OS-GetThreatPCAP')]",
    "playbookVersion3": "1.0",
    "playbookContentId3": "PaloAlto-PAN-OS-GetThreatPCAP",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3')))]",
    "PaloAlto-PAN-OS-GetURLCategoryInfo": "PaloAlto-PAN-OS-GetURLCategoryInfo",
    "_PaloAlto-PAN-OS-GetURLCategoryInfo": "[variables('PaloAlto-PAN-OS-GetURLCategoryInfo')]",
    "playbookVersion4": "1.0",
    "playbookContentId4": "PaloAlto-PAN-OS-GetURLCategoryInfo",
    "_playbookContentId4": "[variables('playbookContentId4')]",
    "playbookId4": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId4'))]",
    "playbookTemplateSpecName4": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId4')))]",
    "PaloAlto-PAN-OS-BlockIP": "PaloAlto-PAN-OS-BlockIP",
    "_PaloAlto-PAN-OS-BlockIP": "[variables('PaloAlto-PAN-OS-BlockIP')]",
    "playbookVersion5": "1.0",
    "playbookContentId5": "PaloAlto-PAN-OS-BlockIP",
    "_playbookContentId5": "[variables('playbookContentId5')]",
    "playbookId5": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId5'))]",
    "playbookTemplateSpecName5": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId5')))]",
    "PaloAlto-PAN-OS-BlockURL": "PaloAlto-PAN-OS-BlockURL",
    "_PaloAlto-PAN-OS-BlockURL": "[variables('PaloAlto-PAN-OS-BlockURL')]",
    "playbookVersion6": "1.0",
    "playbookContentId6": "PaloAlto-PAN-OS-BlockURL",
    "_playbookContentId6": "[variables('playbookContentId6')]",
    "playbookId6": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId6'))]",
    "playbookTemplateSpecName6": "[concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId6')))]"
  },
  "resources": [
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "LogicAppsCustomConnector"
      },
      "properties": {
        "description": "PaloAltoCustomConnector",
        "displayName": "PaloAltoCustomConnector"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName1'),'/',variables('playbookVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "LogicAppsCustomConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "PaloAltoCustomConnector Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "PaloAlto_PAN-OS_Rest_API_CustomConnector_Name": {
              "defaultValue": "PAN-OSRestApiCustomConnector",
              "type": "String",
              "metadata": {
                "description": "Name of the PaloAlto REST API Connector"
              }
            },
            "PaloAlto_PAN-OS_XML_API_CustomConnector_Name": {
              "defaultValue": "PAN-OSXmlApiCustomConnector",
              "type": "String",
              "metadata": {
                "description": "Name of the PaloAlto XML API Connector"
              }
            },
            "Service_EndPoint": {
              "defaultValue": "https://{yourPaloAltoDomain}",
              "type": "String",
              "metadata": {
                "description": "enter the PaloAlto endpoint (ex: https://{yourPaloAltoDomain})"
              }
            }
          },
          "variables": {
            "operationId-Listsecurityrules": "Listsecurityrules",
            "_operationId-Listsecurityrules": "[[variables('operationId-Listsecurityrules')]",
            "operationId-Createsecuritypolicyrule": "Createsecuritypolicyrule",
            "_operationId-Createsecuritypolicyrule": "[[variables('operationId-Createsecuritypolicyrule')]",
            "operationId-Updatesecuritypolicyrule": "Updatesecuritypolicyrule",
            "_operationId-Updatesecuritypolicyrule": "[[variables('operationId-Updatesecuritypolicyrule')]",
            "operationId-Listcustomurlcategories": "Listcustomurlcategories",
            "_operationId-Listcustomurlcategories": "[[variables('operationId-Listcustomurlcategories')]",
            "operationId-Listaddressobjects": "Listaddressobjects",
            "_operationId-Listaddressobjects": "[[variables('operationId-Listaddressobjects')]",
            "operationId-Createanaddressobject": "Createanaddressobject",
            "_operationId-Createanaddressobject": "[[variables('operationId-Createanaddressobject')]",
            "operationId-Updateaddressobject": "Updateaddressobject",
            "_operationId-Updateaddressobject": "[[variables('operationId-Updateaddressobject')]",
            "operationId-Listaddressgroups": "Listaddressgroups",
            "_operationId-Listaddressgroups": "[[variables('operationId-Listaddressgroups')]",
            "operationId-Createaddressobjectgroup": "Createaddressobjectgroup",
            "_operationId-Createaddressobjectgroup": "[[variables('operationId-Createaddressobjectgroup')]",
            "operationId-Updateanaddressobjectgroup": "Updateanaddressobjectgroup",
            "_operationId-Updateanaddressobjectgroup": "[[variables('operationId-Updateanaddressobjectgroup')]",
            "operationId-Listurlfilteringsecurityprofiles": "Listurlfilteringsecurityprofiles",
            "_operationId-Listurlfilteringsecurityprofiles": "[[variables('operationId-Listurlfilteringsecurityprofiles')]",
            "operationId-Updateanurlfilteringsecurityprofile": "Updateanurlfilteringsecurityprofile",
            "_operationId-Updateanurlfilteringsecurityprofile": "[[variables('operationId-Updateanurlfilteringsecurityprofile')]",
            "operationId-Queryxmlapi": "Queryxmlapi",
            "_operationId-Queryxmlapi": "[[variables('operationId-Queryxmlapi')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "playbookContentId": "PaloAltoCustomConnector",
            "playbookId": "[[resourceId('Microsoft.Web/customApis', parameters('PaloAlto_PAN-OS_XML_API_CustomConnector_Name'))]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/customApis",
              "apiVersion": "2016-06-01",
              "name": "[[parameters('PaloAlto_PAN-OS_Rest_API_CustomConnector_Name')]",
              "location": "[[parameters('workspace-location')]",
              "properties": {
                "connectionParameters": {
                  "api_key": {
                    "type": "securestring",
                    "uiDefinition": {
                      "displayName": "API Key",
                      "description": "The API Key for this api",
                      "tooltip": "Provide your API Key",
                      "constraints": {
                        "tabIndex": 2,
                        "clearText": false,
                        "required": "true"
                      }
                    }
                  }
                },
                "backendService": {
                  "serviceUrl": "[[parameters('Service_EndPoint')]"
                },
                "brandColor": "#FFFFFF",
                "description": "This is the PaloAlto Custom Connector",
                "displayName": "[[parameters('PaloAlto_PAN-OS_Rest_API_CustomConnector_Name')]",
                "iconUri": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAAEYCAYAAACHjumMAAARQklEQVR4nOzdv49c1fnH8TOD8Xc7u7G9Nfo2ETPCVCFVEGlSOt2SxqaiROmQyIhYC4roSBWKSGApCu7iMgUFokk61vFGuMgfYG8UCaQkshbhie4yd3O9OzP3x3Ofc57nnPer8ffrxeZm5+5nn/PcDzvTAABKCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBhD3pntXk59DZ7x+QO2OH599uHx3vyT1Nfh1fHe/C/HP3/xeurrwP8wwRhx8oWxnLwZQrhJyPS3+pz9MDydfk7I2PFc6gso3WJ+Zfezn7zwXlhOfxtC2Fn99vXF7NqNEMLjL47+/TDxJZq2mF298dlrL3waQvjp6rd2wnJyazG/eiVMlgdfHP3nX4kvsWiT1BdQspPvtE+nn4cQLm35x+5cvPvgVsTLcmM1tdzc8o98E6ZPX734h78dRLwsNHBESqRjuASOTOt1CJdw8rnlyJQUAZNAj3CpETINHcOlRsgkxA4msgHhUqu+QO6XvpPpGS61nbCcvB4my0/YycTFBBPRYn5ld2C4fP/nZ9feHf+q/FjMrt4YEC61S4vZtbdHviS0YMkb0fHrsw/DcvKW8K8pdul7vDf/cjXJDfUkTJ/+iKVvPEwwkTR6LlJF7mNW/5ule5Qd9jFxsYNRtqHnIlVMT2ZNz0WKnkxEHJEUCRa6fWR7ZBq40O2DnowyjkhKIoVLyPXIFCFcAo+w9REwCiKGSy2rkIkULjVCRhE7mJElCJdaFj2ZyOFSoyejhAlmRNKei/jf77wnI+y5SNGTUcCSd0Qj9Vyk3C59R+i5SNGTGRkTzEhG7LlIudzHjNRzkaInMzJ2MEJKPRcpNz0ZhZ6LFD2ZEXFEEki40O3D7JEp0UK3D3oyQhyRBnISLsHqkclBuAQeYcsRMAM4CpeaqZBxEi41QkaAHUxPDsOlZqIn4yxcavRkBmKC6SF1z0UqdU8mcc9Fip7MACx5ezDSc5FKtvQ10HORoifTExNMR4Z6LlJJ9jFGei5S9GR6YgfTwmjPRSpaT8Zgz0WKnkwPHJG2cLzQ7UPtyOR0odsHPZkWHJE2KCRcgtaRqYBwCTzCbkfArFFQuNRGDZlCwqVGyGzBDuaMAsOlNkpPprBwqdGT2YAJpsF7z0VK2pNx3nORoiezBkvehkx6LlKDl74Z9Fyk6MmcwQSzklHPRWrQPiaTnosUPZkzit/BZNpzkerck8mw5yJFT6ah6CNSwQvdPjYemQpd6PZRfE+m2CMS4dLZ2iMT4dJJ8Y+wiwwYwqW3Z0KGcOml6JApbgdDuAx20pP57LUX3iZceiu2J1PUDmYxv7K7eHH3IeEyzHK5/PtkMvn/1Nfh1fTC5PaF3//1V6mvI6aijkirIhThMtByuvxdNcWkvg6vbh88upf6GmIrJmDouYjd//VX//zN8zvPvUrIDPLG/uFRcU+Tsg+Y6lh00tB9Ov0zPZdBHk0vTH7x/sN/vHL74NGTyScHX1f/d/V71cdSX5wD9/YPH7988e4DMz90PaasdzAsdMXuVxNLFSrrPri8df3yt0++qz6/L8W/NBfeKDVYatlOMISL2NZwqVQf48i0UfHhEnINGMJFrDVcaoTMWoTLSnZHJMJFrHO4NK2OS1+FEHb1Ls0FwqUhqwmm9J/nMoJHQ8IlrCaZ6YXJBzqX5cY9wuVZeQUMPReRKiCGhEtt//Doo5KPSvuHj2+nvgZrsgkYei5i91cBMdjtg0dPCt7HFNlzaeM+YOi5iD3Tc5H+ZQX2ZIruubRxveRloSs2aKHbVQE9GRa6LdxOMISLmGq4hPwfYRMuHbgMGMJFTD1capmGDOHSkbsjEuEiFi1cmjLqyRAuPbiaYOi5iA3uuUhl0pOh59KTr4Ch5yIi7blIee/J0HPpz03A0HMRE/dcpJz3ZOi5DGA+YOi5iI3ac5Fy2JMx23N5Z7Z7OfU1tDG95GWhK5ZkoduFk9fW7EJ39c4ON6y/75LZCcbJDWgZ4SJjPVxuenhLFJMB4+QGtIxwkfEQLjXTIWMuYJzcgJaZDRcnNQOz4bKYXb2x4T2pTkLm5PNrjKmAcXIDWpas59KFg5qB6Z7LYnbt3S0fvrT6/JpiK2Ds34Cmpe65bOOhZmC557I6Gm0/Bi0nb1o7KpkJGA83oHHJey6bNI69lmsGZnsuPd4LfMfaPiZ5wNBzETPVc2k689panUzN9lwWs6s3jvfmX/Z8L/BL1ee7+rxb2Mkk7cGw0BUzu9B18tqaXej2mFq2+SZ1TybZBOPkBrSMcJHJPVyChUfYSQLGyQ1oGeEiU0K41JKGTPSAcXIDWmY2XJzUDMyGy5aei1SynkzUgHFyA1pGz0XGc89FKklPJm7A2L8BTaPnIuO+5yKVoCcTLWA83IDG0XORyaHnIhW9J6MeMPRcxOi5yOTWc5GK2pNR7cGw0BUzu9B18tqaXehGnFq2Ue/JqE0wTm5AywgXGcKlnfojbJWAcXIDWka4yBAu3amGzOgB4+QGtMxsuDipGZgNF8Wei5RaT2bUgHFyA1pGz0Wm5J6LlEpPZtyAsX8DmkbPRab4nouUQk9mtIDxcAMaR89Fhp6L3Og9GXHA0HMRo+ciQ89lXKP2ZEQ9GBa6YmYXuk5eW7MLXUdTyzbinszgCcbJDWgZ4SJDuOgTP8IeFDBObkDLCBcZwiUeUcj0DhgnN6BlZsPFSc3AbLgY7rlIDe7J9AoYJzegZfRcZOi5pDOoJ9MvYOzfgKbRc5Gh55LYgJ5M54DxcAMaR89Fhp5Ler17Mq0BQ89FjJ6LDD0XW3r1ZLb2YFjoipld6Dp5bc0udAuaWrZp7clsnGCc3ICWES4yhIt9rY+w1waMkxvQMsJFhnDxY2vInAsYJzegZWbDxUnNwGy4ZNxzkdrYk3kmYJzcgJbRc5Gh5+LX2p7MswFj/wY0jZ6LDD0X59b0ZE4DxsMNaBw9Fxl6Lv6d68lM6bmI0XORoeeSl9OezDuz3csXfjnbfSUsw1upr8opswvd06llaTZYguWFLlOLyE5YTi6/f/jo6+n/ffrgXvVCp74ih+yHi92pJRAuWbtz8e6DW6HewaxeaEKmO8JFhnDJ12m4hOaSd/WC30t2WX6YDRcnNQOz4ULPReygGS7h7GNqy48JjaDnIkPPJWPr8uNMwJw8JuSotAE9FxnL38DouYjd2T88OncCOvefCrCP2Yieiww9l3zdOXs0qq39jx2rkNk/fPwyO5kT9Fxk6Lnk62D/8PHPNoVL6PK+SMd78+oPfzz6pflgdqHL0yIZphaxjVNLU+tPtCv4yES4yBAu+eoULqHrz+QtMGQIFxnCJV+dwyX0+aHfBfVkzIYLPRcZei5i53oubXq9bYnlx4wjoeciQ88lY0O+/nsGTN49GXouMpa/AdFzEVvbc2nT+61jM97H0HORoeeSr157l6ZBb36fWU+GnosMPZd8tfZc2rT2YNo478mYXejytEiGqUVs8NTSNGiCaXJ8ZCJcZAiXfI0SLmGMgAk+Q4ZwkSFc8jVauISxAib46smYDRd6LjL0XMR691zajBYwwfhjyhV6LjL0XDKm8fU7csDY7snQc5Gx/A2EnovYoJ5Lm1EDJtjex9BzkaHnkq9R9y5NowdMsNeToeciQ88lX+KeSxtxD6ZN4p6M2YUuT4tkmFrE1KaWJpUJpinhkYlwkSFc8hUlXEKMgAlpQoZwkSFc8hUtXEKsgAlxezJmw4Weiww9F7HRey5togVMiPOYk56LDD2XjKWoGUQOGN2eDD0XGXouWVPpubSJGjBBdx9Dz0WGnku+ou5dmqIHTBi/J0PPRYaeS77Uey5t1HswbYQ9GbMLXZ4WyTC1iCWbWpqSTDBNgiMT4SJDuOTLRLgECwEThoUM4SJDuOTLTLgEKwET+vVkzIYLPRcZei5i0XsubcwETOj2mJSeiww9l4xZrBkYC5jtPRl6LjIWb8AaPRexJD2XNqYCJmzfx9BzkaHnki9Te5cmcwETzvdk6LnI0HPJV/KeS5vkPRivnDwtCla/uzG1iJl8Xc8yOcFY5yhcKjdXX8xmEC5iLsIlEDD9OQuXmpmQIVzE3IRLIGD6cdJz2eTmqmeSDD0XMXM9lzYETA8Oei5bpe6ZpP73e2e5ZrAJAdORh55LB9dTHZXouYiZ7Lm0IWA6cNJz6Sr6Poa9i5irvUsTAbOFk57LEFXIfKm9k6HnIma+59KGHswGTp8WDaHy3ZGpRczt1NLEBLNGQeESNI5MhItYFuESCJjzCguX2mghQ7iIZRMugYB5lvOei5S4J0PPRcxdz6UNAdPgveciJe2p0HOR8dhzaUPArGTSc5Ea3JOh5yLmsufShoDJr+ci1Xsfw95FLKu9S1PRAZNxz0WqU0+GnouY+55Lm2J7MIU+LRpi7XdXphaxbKeWpiInGMKll3NHJsJFrIhwCSUGDOEyyGnIEC5ixYRLKO2ItJhf2V28uPuQcBnsDuEicnDx7oOXU19ETEVNMMvl5DLhIlLUF8fYcuy5tCkqYN47PHo48H2w8f07av64+jX1hTiVZc+lTVEBE2Rvtl+y07frrX4lZHorau/SVFzAhPPvu4TNTt+Tqn5HzerX6v+vfr/6eOoLNC77nkubopa86xzvzasX/+PU12HQ/bb3AV/eun752yfffR5CeCnupblQ7NTSVOQE08SRaa3WcAmraYYj01qEy0rxARMImbM6hUuNkDmHcGko/ojUdLw3/2MIIel7ByX26Pmd537QNVyaVselr0IIuzqX5kJxPZc2TDANJfYUmqYXJh8MCZewmmSqPz/+VflR+v2zDgHTsH94dFDwUen+/uHRR5K/YPXnSz0qFdlzacMRaY0Cnyz12rtsU+iTJfYuGzDBrFFQT+Zcz0WqsJ5M8T2XNkwwLTKeZkabWjbJfJphaumACaZFpo+w1cMl5P0Im3DpiIDpILOQiRIutQxDhnDpgSNSDxn0ZAb3XKQy6cnQc+mJCaYH7z0HSc9FKoeejPfXPwUCpgfnPRlxz0XKeU+GnssAHJEGcPhkKereZRunT5bYuwzEBDOAo57M6D0XKWc9GXouQkwwQoanGTNTyybGpxmmlhEwwQgZfYRtPlyC7UfYhMtICJgRGAsZF+FSMxgyhMuIOCKNyEBPJlnPRcpIT4aey8iYYEaUuieRsuciZaEnk/r1yxEBM6LEPZnkPRepxD0Zei4KOCIpSPBkydXeZZtET5bYuyhhglEQsSdjruciFbknQ89FGROMMsVpJpupZRPlaYapJQImGGVKj7CzD5eg+wibcImEgIlg5JApIlxqCiFDuETEESmiEXoybnsuUiP1ZOi5RMYEE5G0Z+G55yI1Rk+Gnkt8BExEwp6M+56LlLAnQ88lAY5ICQx4slTU3mWbgU+W2LskwgSTQI+eTHY9F6mePRl6LokxwSS2ZZphamnRMs0wtRjABJPYhkfYhEsHWx5hEy5GEDAGnAkZwqWHNSFDuADrHO/NP6rG/tTX4VH1eTvem/8p9XUAACLhiARADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0DNfwMAAP//98IA4m2bU34AAAAASUVORK5CYII=",
                "swagger": {
                  "swagger": "2.0",
                  "info": {
                    "title": "Default title",
                    "description": "[variables('blanks')]",
                    "version": "1.0"
                  },
                  "host": "$substring([parameters('Service EndPoint')],8 )",
                  "basePath": "/",
                  "schemes": [
                    "https"
                  ],
                  "paths": {
                    "/restapi/v10.0/Policies/SecurityRules": {
                      "get": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "@status": {
                                  "type": "string",
                                  "description": "defines the status",
                                  "title": "@status"
                                },
                                "@code": {
                                  "type": "string",
                                  "description": "defines the status code",
                                  "title": "@code"
                                },
                                "result": {
                                  "type": "object",
                                  "properties": {
                                    "@total-count": {
                                      "type": "string",
                                      "description": "the total count of security policy rules in PAN-OS VM",
                                      "title": "@total-count"
                                    },
                                    "@count": {
                                      "type": "string",
                                      "description": "the count of security policy rules in PAN-OS VM",
                                      "title": "@count"
                                    },
                                    "entry": {
                                      "type": "array",
                                      "items": {
                                        "type": "object",
                                        "properties": {
                                          "@name": {
                                            "type": "string",
                                            "description": "the name of the security policy rule",
                                            "title": "@name"
                                          },
                                          "@uuid": {
                                            "type": "string",
                                            "description": "the unique id of the security policy rule",
                                            "title": "@uuid"
                                          },
                                          "@location": {
                                            "type": "string",
                                            "description": "the location where the security policy rule is being located at. default value is \"vsys\"",
                                            "title": "@location"
                                          },
                                          "@vsys": {
                                            "type": "string",
                                            "description": "the vsys name of the location. default value is \"vsys1\"",
                                            "title": "@vsys"
                                          },
                                          "action": {
                                            "type": "string",
                                            "description": "action allowed on security policy rule.",
                                            "title": "action"
                                          },
                                          "application": {
                                            "type": "object",
                                            "properties": {
                                              "member": {
                                                "type": "array",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "description": "member"
                                              }
                                            },
                                            "description": "application"
                                          },
                                          "category": {
                                            "type": "object",
                                            "properties": {
                                              "member": {
                                                "type": "array",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "description": "member"
                                              }
                                            },
                                            "description": "category"
                                          },
                                          "destination": {
                                            "type": "object",
                                            "properties": {
                                              "member": {
                                                "type": "array",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "description": "member"
                                              }
                                            },
                                            "description": "destination"
                                          },
                                          "from": {
                                            "type": "object",
                                            "properties": {
                                              "member": {
                                                "type": "array",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "description": "member"
                                              }
                                            },
                                            "description": "from"
                                          },
                                          "hip-profiles": {
                                            "type": "object",
                                            "properties": {
                                              "member": {
                                                "type": "array",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "description": "member"
                                              }
                                            },
                                            "description": "hip-profiles"
                                          },
                                          "service": {
                                            "type": "object",
                                            "properties": {
                                              "member": {
                                                "type": "array",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "description": "member"
                                              }
                                            },
                                            "description": "service"
                                          },
                                          "source": {
                                            "type": "object",
                                            "properties": {
                                              "member": {
                                                "type": "array",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "description": "member"
                                              }
                                            },
                                            "description": "source"
                                          },
                                          "source-user": {
                                            "type": "object",
                                            "properties": {
                                              "member": {
                                                "type": "array",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "description": "member"
                                              }
                                            },
                                            "description": "source-user"
                                          },
                                          "to": {
                                            "type": "object",
                                            "properties": {
                                              "member": {
                                                "type": "array",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "description": "member"
                                              }
                                            },
                                            "description": "to"
                                          },
                                          "source-hip": {
                                            "type": "object",
                                            "properties": {
                                              "member": {
                                                "type": "array",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "description": "member"
                                              }
                                            },
                                            "description": "source-hip"
                                          },
                                          "destination-hip": {
                                            "type": "object",
                                            "properties": {
                                              "member": {
                                                "type": "array",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "description": "member"
                                              }
                                            },
                                            "description": "destination-hip"
                                          }
                                        }
                                      },
                                      "description": "entry"
                                    }
                                  },
                                  "description": "result"
                                }
                              }
                            }
                          }
                        },
                        "summary": "List security rules",
                        "description": "List of all the security rules",
                        "operationId": "[[variables('_operationId-Listsecurityrules')]",
                        "x-ms-visibility": "important",
                        "parameters": [
                          {
                            "name": "location",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys",
                            "description": "Enter the location"
                          },
                          {
                            "name": "vsys",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys1",
                            "description": "Enter the vsys location name"
                          },
                          {
                            "name": "name",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "description": "filter the security rule by name",
                            "x-ms-summary": "name"
                          }
                        ]
                      },
                      "post": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "@status": {
                                  "type": "string",
                                  "description": "status if success or failure",
                                  "title": "@status"
                                },
                                "@code": {
                                  "type": "string",
                                  "description": "statuscode",
                                  "title": "@code"
                                },
                                "msg": {
                                  "type": "string",
                                  "description": "status message",
                                  "title": "msg"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Create a security policy rule",
                        "description": "Creates a new policy rule",
                        "operationId": "[[variables('_operationId-Createsecuritypolicyrule')]",
                        "x-ms-visibility": "important",
                        "parameters": [
                          {
                            "name": "location",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys",
                            "description": "Enter the location"
                          },
                          {
                            "name": "vsys",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys1",
                            "description": "Enter the vsys location name"
                          },
                          {
                            "name": "name",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "description": "Enter the name of security policy rule"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "required": true,
                            "schema": {
                              "type": "object",
                              "properties": {
                                "entry": {
                                  "type": "object",
                                  "properties": {
                                    "@name": {
                                      "type": "string",
                                      "description": "Enter the name of security policy rule",
                                      "title": "name"
                                    },
                                    "to": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the to member, Array of strings",
                                          "title": "to member",
                                          "default": "any"
                                        }
                                      },
                                      "description": "to",
                                      "required": [
                                        "member"
                                      ]
                                    },
                                    "from": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the from member,Array of strings",
                                          "title": "from member",
                                          "default": "any"
                                        }
                                      },
                                      "description": "from",
                                      "required": [
                                        "member"
                                      ]
                                    },
                                    "source-user": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the source-user member, Array of strings",
                                          "title": "source-user member",
                                          "default": "any"
                                        }
                                      },
                                      "description": "source-user"
                                    },
                                    "application": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the application member, Array of strings",
                                          "title": "application member",
                                          "default": "any"
                                        }
                                      },
                                      "description": "application",
                                      "required": [
                                        "member"
                                      ]
                                    },
                                    "service": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the service member, Array of strings",
                                          "title": "service member",
                                          "default": "any"
                                        }
                                      },
                                      "description": "service",
                                      "required": [
                                        "member"
                                      ]
                                    },
                                    "hip-profiles": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the hip-profiles member, Array of strings",
                                          "title": "hip-profiles member",
                                          "default": "any"
                                        }
                                      },
                                      "description": "hip-profiles"
                                    },
                                    "action": {
                                      "type": "string",
                                      "description": "enter the action ex: allow",
                                      "enum": [
                                        "deny",
                                        "allow",
                                        "drop",
                                        "reset-client",
                                        "reset-server",
                                        "reset-both"
                                      ],
                                      "title": "action",
                                      "default": "allow"
                                    },
                                    "category": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the category member, Array of strings",
                                          "title": "category member",
                                          "default": "any"
                                        }
                                      },
                                      "description": "category"
                                    },
                                    "source": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the source member, Array of strings for ex:[\"url.com\",\"panos.com\"]",
                                          "title": "source member",
                                          "default": "any"
                                        }
                                      },
                                      "description": "source",
                                      "required": [
                                        "member"
                                      ]
                                    },
                                    "destination": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the source member, Array of strings for ex:[\"1.1.1.1\",\"2.2.2.2\"]",
                                          "title": "destination member",
                                          "default": "any"
                                        }
                                      },
                                      "description": "destination",
                                      "required": [
                                        "member"
                                      ]
                                    }
                                  },
                                  "description": "entry",
                                  "required": [
                                    "@name",
                                    "action",
                                    "application",
                                    "category",
                                    "destination",
                                    "from",
                                    "hip-profiles",
                                    "service",
                                    "source",
                                    "to"
                                  ]
                                }
                              },
                              "required": [
                                "entry"
                              ]
                            }
                          }
                        ]
                      },
                      "put": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "@status": {
                                  "type": "string",
                                  "description": "status if success or failure",
                                  "title": "@status"
                                },
                                "@code": {
                                  "type": "string",
                                  "description": "status code",
                                  "title": "@code"
                                },
                                "msg": {
                                  "type": "string",
                                  "description": "the status msg if success or failure",
                                  "title": "msg"
                                }
                              }
                            }
                          }
                        },
                        "parameters": [
                          {
                            "name": "location",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys",
                            "description": "Enter the location"
                          },
                          {
                            "name": "vsys",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys1",
                            "description": "Enter the vsys location name"
                          },
                          {
                            "name": "name",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "description": "Enter the name of security policy rule"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "required": true,
                            "schema": {
                              "type": "object",
                              "properties": {
                                "entry": {
                                  "type": "object",
                                  "properties": {
                                    "@name": {
                                      "type": "string",
                                      "description": "Enter the name of security policy rule",
                                      "title": "name"
                                    },
                                    "to": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the to member, Array of strings",
                                          "title": "to member",
                                          "default": "any"
                                        }
                                      },
                                      "description": "to",
                                      "required": [
                                        "member"
                                      ]
                                    },
                                    "from": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the from member,Array of strings",
                                          "title": "from member",
                                          "default": "any"
                                        }
                                      },
                                      "description": "from",
                                      "required": [
                                        "member"
                                      ]
                                    },
                                    "source-user": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the source-user member, Array of strings",
                                          "title": "source-user member",
                                          "default": "any"
                                        }
                                      },
                                      "description": "source-user"
                                    },
                                    "application": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the application member, Array of strings",
                                          "title": "application member",
                                          "default": "any"
                                        }
                                      },
                                      "description": "application",
                                      "required": [
                                        "member"
                                      ]
                                    },
                                    "service": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the service member, Array of strings",
                                          "title": "service member",
                                          "default": "any"
                                        }
                                      },
                                      "description": "service",
                                      "required": [
                                        "member"
                                      ]
                                    },
                                    "hip-profiles": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the hip-profiles member, Array of strings",
                                          "title": "hip-profiles member",
                                          "default": "any"
                                        }
                                      },
                                      "description": "hip-profiles"
                                    },
                                    "action": {
                                      "type": "string",
                                      "description": "enter the action ex: allow",
                                      "enum": [
                                        "deny",
                                        "allow",
                                        "drop",
                                        "reset-client",
                                        "reset-server",
                                        "reset-both"
                                      ],
                                      "title": "action",
                                      "default": "allow"
                                    },
                                    "category": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the category member, Array of strings",
                                          "title": "category member",
                                          "default": "any"
                                        }
                                      },
                                      "description": "category"
                                    },
                                    "source": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the source member, Array of strings for ex:[\"url.com\",\"panos.com\"]",
                                          "title": "source member",
                                          "default": "any"
                                        }
                                      },
                                      "description": "source",
                                      "required": [
                                        "member"
                                      ]
                                    },
                                    "destination": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the source member, Array of strings for ex:[\"1.1.1.1\",\"2.2.2.2\"]",
                                          "title": "destination member",
                                          "default": "any"
                                        }
                                      },
                                      "description": "destination",
                                      "required": [
                                        "member"
                                      ]
                                    }
                                  },
                                  "description": "entry",
                                  "required": [
                                    "@name",
                                    "action",
                                    "application",
                                    "category",
                                    "destination",
                                    "from",
                                    "hip-profiles",
                                    "service",
                                    "source",
                                    "to"
                                  ]
                                }
                              },
                              "required": [
                                "entry"
                              ]
                            }
                          }
                        ],
                        "summary": "Update security policy rule",
                        "description": "update address object to existing Security Policy Rule",
                        "operationId": "[[variables('_operationId-Updatesecuritypolicyrule')]",
                        "x-ms-visibility": "important"
                      }
                    },
                    "/restapi/v10.0/Objects/CustomURLCategories": {
                      "get": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "@status": {
                                  "type": "string",
                                  "description": "status if success or failure",
                                  "title": "@status"
                                },
                                "@code": {
                                  "type": "string",
                                  "description": "status code",
                                  "title": "@code"
                                },
                                "result": {
                                  "type": "object",
                                  "properties": {
                                    "@total-count": {
                                      "type": "string",
                                      "description": "total count of URL filtering category info present in PAN-OS",
                                      "title": "@total-count"
                                    },
                                    "@count": {
                                      "type": "string",
                                      "description": "count of the list of URL filtering category info",
                                      "title": "@count"
                                    },
                                    "entry": {
                                      "type": "array",
                                      "items": {
                                        "type": "object",
                                        "properties": {
                                          "@name": {
                                            "type": "string",
                                            "description": "name of URL filtering category information",
                                            "title": "@name"
                                          },
                                          "@location": {
                                            "type": "string",
                                            "description": "location of the URL filtering category info. default value is vsys",
                                            "title": "@location"
                                          },
                                          "@vsys": {
                                            "type": "string",
                                            "description": "vsys location name of URL filtering category info. default value is vsys1",
                                            "title": "@vsys"
                                          },
                                          "description": {
                                            "type": "string",
                                            "description": "description of URL filtering category information",
                                            "title": "description"
                                          },
                                          "list": {
                                            "type": "object",
                                            "properties": {
                                              "member": {
                                                "type": "array",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "description": "member"
                                              }
                                            },
                                            "description": "list"
                                          },
                                          "type": {
                                            "type": "string",
                                            "description": "type of URL filtering category info",
                                            "title": "type"
                                          }
                                        }
                                      },
                                      "description": "entry"
                                    }
                                  },
                                  "description": "result"
                                }
                              }
                            }
                          }
                        },
                        "summary": "List custom url categories",
                        "description": "List custom url categories",
                        "operationId": "[[variables('_operationId-Listcustomurlcategories')]",
                        "x-ms-visibility": "important",
                        "parameters": [
                          {
                            "name": "location",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys",
                            "description": "Enter the location"
                          },
                          {
                            "name": "vsys",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys1",
                            "description": "Enter the vsys location name"
                          },
                          {
                            "name": "name",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "description": "filter by custom url category name",
                            "x-ms-summary": "name"
                          }
                        ]
                      }
                    },
                    "/restapi/v10.0/Objects/Addresses": {
                      "get": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "@status": {
                                  "type": "string",
                                  "description": "status if success or failure",
                                  "title": "@status"
                                },
                                "@code": {
                                  "type": "string",
                                  "description": "status code",
                                  "title": "@code"
                                },
                                "result": {
                                  "type": "object",
                                  "properties": {
                                    "@total-count": {
                                      "type": "string",
                                      "description": "total count of address objects present in PAN-OS VM",
                                      "title": "@total-count"
                                    },
                                    "@count": {
                                      "type": "string",
                                      "description": "count of address objects present in PAN-OS",
                                      "title": "@count"
                                    },
                                    "entry": {
                                      "type": "array",
                                      "items": {
                                        "type": "object",
                                        "properties": {
                                          "@name": {
                                            "type": "string",
                                            "description": "Enter the name of the address object",
                                            "title": "@name"
                                          },
                                          "@location": {
                                            "type": "string",
                                            "description": "location of PAN-OS VM. default value is vsys",
                                            "title": "@location"
                                          },
                                          "@vsys": {
                                            "type": "string",
                                            "description": "vsys location name of address object. default value is vsys1",
                                            "title": "@vsys"
                                          },
                                          "description": {
                                            "type": "string",
                                            "description": "description of address object",
                                            "title": "description"
                                          },
                                          "fqdn": {
                                            "type": "string",
                                            "description": "URL address of address object",
                                            "title": "fqdn"
                                          },
                                          "ip-netmask": {
                                            "type": "string",
                                            "description": "Ip address of address object",
                                            "title": "ip-netmask"
                                          }
                                        }
                                      },
                                      "description": "entry"
                                    }
                                  },
                                  "description": "result"
                                }
                              }
                            }
                          }
                        },
                        "summary": "List address objects",
                        "description": "List address objects",
                        "operationId": "[[variables('_operationId-Listaddressobjects')]",
                        "x-ms-visibility": "important",
                        "parameters": [
                          {
                            "name": "location",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys",
                            "description": "Enter the location"
                          },
                          {
                            "name": "vsys",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys1",
                            "description": "Enter the vsys location name"
                          },
                          {
                            "name": "name",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "description": "filter by address object name",
                            "x-ms-summary": "name"
                          }
                        ]
                      },
                      "post": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "@status": {
                                  "type": "string",
                                  "description": "status if success or failure",
                                  "title": "@status"
                                },
                                "@code": {
                                  "type": "string",
                                  "description": "status code",
                                  "title": "@code"
                                },
                                "msg": {
                                  "type": "string",
                                  "description": "success or failure msg",
                                  "title": "msg"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Create an address object",
                        "description": "creates address object",
                        "x-ms-visibility": "important",
                        "operationId": "[[variables('_operationId-Createanaddressobject')]",
                        "parameters": [
                          {
                            "name": "location",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys",
                            "description": "Enter the location"
                          },
                          {
                            "name": "vsys",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys1",
                            "description": "Enter the vsys location name"
                          },
                          {
                            "name": "name",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "description": "Enter the name of address object"
                          },
                          {
                            "name": "address type",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "enum": [
                              "ip-netmask",
                              "fqdn"
                            ]
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "required": true,
                            "schema": {
                              "type": "object",
                              "properties": {
                                "entry": {
                                  "type": "object",
                                  "properties": {
                                    "@name": {
                                      "type": "string",
                                      "description": "Enter the name of address object",
                                      "title": "name"
                                    },
                                    "fqdn": {
                                      "type": "string",
                                      "description": "Enter the URL ex:url.com",
                                      "title": "fqdn",
                                      "x-ms-visibility": "advanced"
                                    },
                                    "ip-netmask": {
                                      "type": "string",
                                      "description": "Enter the IP address ex:1.1.1.1",
                                      "title": "ip-netmask",
                                      "x-ms-visibility": "advanced"
                                    },
                                    "description": {
                                      "type": "string",
                                      "description": "Enter the description",
                                      "title": "description"
                                    }
                                  },
                                  "description": "entry",
                                  "required": [
                                    "@name",
                                    "description"
                                  ]
                                }
                              },
                              "required": [
                                "entry"
                              ]
                            }
                          }
                        ]
                      },
                      "put": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "@status": {
                                  "type": "string",
                                  "description": "status if success or failure",
                                  "title": "@status"
                                },
                                "@code": {
                                  "type": "string",
                                  "description": "status code",
                                  "title": "@code"
                                },
                                "msg": {
                                  "type": "string",
                                  "description": "status message",
                                  "title": "msg"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Update an address object",
                        "operationId": "[[variables('_operationId-Updateaddressobject')]",
                        "x-ms-visibility": "important",
                        "description": "Updates an address objects parameters.",
                        "parameters": [
                          {
                            "name": "location",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys",
                            "description": "Enter the location"
                          },
                          {
                            "name": "vsys",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys1",
                            "description": "Enter the vsys location name"
                          },
                          {
                            "name": "name",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "description": "Enter the name of address object",
                            "x-ms-summary": "name"
                          },
                          {
                            "name": "address type",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "enum": [
                              "ip-netmask",
                              "fqdn"
                            ]
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "required": true,
                            "schema": {
                              "type": "object",
                              "properties": {
                                "entry": {
                                  "type": "object",
                                  "properties": {
                                    "@name": {
                                      "type": "string",
                                      "description": "Enter the name of address object",
                                      "title": "name"
                                    },
                                    "fqdn": {
                                      "type": "string",
                                      "description": "Enter the URL for ex:url.com",
                                      "title": "fqdn",
                                      "x-ms-visibility": "advanced"
                                    },
                                    "ip-netmask": {
                                      "type": "string",
                                      "description": "Enter the IP address for ex: 1.1.1.1",
                                      "title": "ip-netmask",
                                      "x-ms-visibility": "advanced"
                                    },
                                    "description": {
                                      "type": "string",
                                      "description": "Enter the description",
                                      "title": "description"
                                    }
                                  },
                                  "description": "entry",
                                  "required": [
                                    "@name",
                                    "description"
                                  ]
                                }
                              },
                              "required": [
                                "entry"
                              ]
                            }
                          }
                        ]
                      }
                    },
                    "/restapi/v10.0/Objects/AddressGroups": {
                      "get": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "@status": {
                                  "type": "string",
                                  "description": "status if success or failure",
                                  "title": "@status"
                                },
                                "@code": {
                                  "type": "string",
                                  "description": "status code",
                                  "title": "@code"
                                },
                                "result": {
                                  "type": "object",
                                  "properties": {
                                    "@total-count": {
                                      "type": "string",
                                      "description": "total count of address object groups present in PAN-OS VM",
                                      "title": "@total-count"
                                    },
                                    "@count": {
                                      "type": "string",
                                      "description": "count of address object groups present in PAN-OS VM",
                                      "title": "@count"
                                    },
                                    "entry": {
                                      "type": "array",
                                      "items": {
                                        "type": "object",
                                        "properties": {
                                          "@name": {
                                            "type": "string",
                                            "description": "Enter the name of address object group",
                                            "title": "@name"
                                          },
                                          "@location": {
                                            "type": "string",
                                            "description": "location of address object group",
                                            "title": "@location"
                                          },
                                          "@vsys": {
                                            "type": "string",
                                            "description": "vys location name of address object group",
                                            "title": "@vsys"
                                          },
                                          "static": {
                                            "type": "object",
                                            "properties": {
                                              "member": {
                                                "type": "array",
                                                "items": {
                                                  "type": "string"
                                                },
                                                "description": "member"
                                              }
                                            },
                                            "description": "static"
                                          }
                                        }
                                      },
                                      "description": "entry"
                                    }
                                  },
                                  "description": "result"
                                }
                              }
                            }
                          }
                        },
                        "summary": "List address groups",
                        "operationId": "[[variables('_operationId-Listaddressgroups')]",
                        "x-ms-visibility": "important",
                        "description": "List address groups",
                        "parameters": [
                          {
                            "name": "location",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys",
                            "description": "Enter the location"
                          },
                          {
                            "name": "vsys",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys1",
                            "description": "Enter the vsys location name"
                          },
                          {
                            "name": "name",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "description": "filter by address group name",
                            "x-ms-summary": "name"
                          }
                        ]
                      },
                      "post": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "@status": {
                                  "type": "string",
                                  "description": "status if success or failure",
                                  "title": "@status"
                                },
                                "@code": {
                                  "type": "string",
                                  "description": "statuscode",
                                  "title": "@code"
                                },
                                "msg": {
                                  "type": "string",
                                  "description": "status message",
                                  "title": "msg"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Create an address object group",
                        "description": "Creates an address object group",
                        "operationId": "[[variables('_operationId-Createaddressobjectgroup')]",
                        "x-ms-visibility": "important",
                        "parameters": [
                          {
                            "name": "location",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys",
                            "description": "Enter the location"
                          },
                          {
                            "name": "vsys",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys1",
                            "description": "Enter the vsys location name"
                          },
                          {
                            "name": "name",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "description": "Enter the name of security policy rule"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "required": true,
                            "schema": {
                              "type": "object",
                              "properties": {
                                "entry": {
                                  "type": "object",
                                  "properties": {
                                    "@name": {
                                      "type": "string",
                                      "description": "Enter the name of address object group",
                                      "title": "name"
                                    },
                                    "static": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the whole array of members i.e existing and also new ones",
                                          "title": "member"
                                        }
                                      },
                                      "description": "static",
                                      "required": [
                                        "member"
                                      ]
                                    }
                                  },
                                  "description": "entry",
                                  "required": [
                                    "@name",
                                    "static"
                                  ]
                                }
                              },
                              "required": [
                                "entry"
                              ]
                            }
                          }
                        ]
                      },
                      "put": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "@status": {
                                  "type": "string",
                                  "description": "status if success or failure",
                                  "title": "@status"
                                },
                                "@code": {
                                  "type": "string",
                                  "description": "statuscode",
                                  "title": "@code"
                                },
                                "msg": {
                                  "type": "string",
                                  "description": "status message",
                                  "title": "msg"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Update an address object group",
                        "operationId": "[[variables('_operationId-Updateanaddressobjectgroup')]",
                        "description": "Update the address object group",
                        "x-ms-visibility": "important",
                        "parameters": [
                          {
                            "name": "location",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys",
                            "description": "Enter the location"
                          },
                          {
                            "name": "vsys",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys1",
                            "description": "Enter the vsys location name"
                          },
                          {
                            "name": "name",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "description": "Enter the name of the address object group"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "required": true,
                            "schema": {
                              "type": "object",
                              "properties": {
                                "entry": {
                                  "type": "object",
                                  "properties": {
                                    "@name": {
                                      "type": "string",
                                      "description": "Enter the name of address object group",
                                      "title": "name"
                                    },
                                    "static": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the whole array of members i.e existing and also new ones",
                                          "title": "member"
                                        }
                                      },
                                      "description": "static",
                                      "required": [
                                        "member"
                                      ]
                                    }
                                  },
                                  "description": "entry",
                                  "required": [
                                    "@name",
                                    "static"
                                  ]
                                }
                              },
                              "required": [
                                "entry"
                              ]
                            }
                          }
                        ]
                      }
                    },
                    "/restapi/v10.0/Objects/URLFilteringSecurityProfiles": {
                      "get": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "@status": {
                                  "type": "string",
                                  "description": "status if success or failure",
                                  "title": "@status"
                                },
                                "@code": {
                                  "type": "string",
                                  "description": "status code",
                                  "title": "@code"
                                },
                                "result": {
                                  "type": "object",
                                  "properties": {
                                    "@total-count": {
                                      "type": "string",
                                      "description": "total count of url filtering security profile information",
                                      "title": "@total-count"
                                    },
                                    "@count": {
                                      "type": "string",
                                      "description": "count of url filtering security profile information",
                                      "title": "@count"
                                    },
                                    "entry": {
                                      "type": "array",
                                      "items": {
                                        "type": "object",
                                        "properties": {
                                          "@name": {
                                            "type": "string",
                                            "description": "Enter the name of URL filtering category security profile",
                                            "title": "@name"
                                          },
                                          "@location": {
                                            "type": "string",
                                            "description": "location of URL filtering security profile",
                                            "title": "@location"
                                          },
                                          "@vsys": {
                                            "type": "string",
                                            "description": "@vsys"
                                          },
                                          "description": {
                                            "type": "string",
                                            "description": "description of url filtering security info",
                                            "title": "description"
                                          },
                                          "credential-enforcement": {
                                            "type": "object",
                                            "properties": {
                                              "mode": {
                                                "type": "object",
                                                "properties": {
                                                  "disabled": {
                                                    "type": "object",
                                                    "description": "disabled"
                                                  }
                                                },
                                                "description": "mode"
                                              },
                                              "log-severity": {
                                                "type": "string",
                                                "description": "log-severity of filtering security category info",
                                                "title": "log-severity"
                                              }
                                            },
                                            "description": "credential-enforcement"
                                          },
                                          "log-http-hdr-user-agent": {
                                            "type": "string",
                                            "description": "log-http-hdr-user-agent",
                                            "title": "log-http-hdr-user-agent"
                                          },
                                          "mlav-engine-urlbased-enabled": {
                                            "type": "object",
                                            "properties": {
                                              "entry": {
                                                "type": "array",
                                                "items": {
                                                  "type": "object",
                                                  "properties": {
                                                    "@name": {
                                                      "type": "string",
                                                      "description": "Enter the name of URL filtering category security profile"
                                                    },
                                                    "mlav-policy-action": {
                                                      "type": "string",
                                                      "description": "mlav-policy-action"
                                                    }
                                                  }
                                                },
                                                "description": "entry"
                                              }
                                            },
                                            "description": "mlav-engine-urlbased-enabled"
                                          }
                                        }
                                      },
                                      "description": "entry"
                                    }
                                  },
                                  "description": "result"
                                }
                              }
                            }
                          }
                        },
                        "summary": "List url filtering security profiles",
                        "description": "List url filtering security profiles",
                        "operationId": "[[variables('_operationId-Listurlfilteringsecurityprofiles')]",
                        "x-ms-visibility": "important",
                        "parameters": [
                          {
                            "name": "location",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys",
                            "description": "Enter the location"
                          },
                          {
                            "name": "vsys",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys1",
                            "description": "Enter the vsys location name"
                          },
                          {
                            "name": "name",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "description": "filter by name of URL filtering security profile",
                            "x-ms-summary": "name"
                          }
                        ]
                      },
                      "put": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "@status": {
                                  "type": "string",
                                  "description": "status if success or failure",
                                  "title": "@status"
                                },
                                "@code": {
                                  "type": "string",
                                  "description": "status code",
                                  "title": "@code"
                                },
                                "msg": {
                                  "type": "string",
                                  "description": "status msg",
                                  "title": "msg"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Update an url filtering security profile",
                        "operationId": "[[variables('_operationId-Updateanurlfilteringsecurityprofile')]",
                        "description": "Update an url filtering security profile",
                        "x-ms-visibility": "important",
                        "parameters": [
                          {
                            "name": "location",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys"
                          },
                          {
                            "name": "vsys",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "default": "vsys1"
                          },
                          {
                            "name": "name",
                            "in": "query",
                            "required": true,
                            "type": "string",
                            "description": "Enter the name of URL filtering category security profile"
                          },
                          {
                            "name": "body",
                            "in": "body",
                            "required": true,
                            "schema": {
                              "type": "object",
                              "properties": {
                                "entry": {
                                  "type": "object",
                                  "properties": {
                                    "@name": {
                                      "type": "string",
                                      "description": "Enter the name of URL filtering category security profile",
                                      "title": "name"
                                    },
                                    "description": {
                                      "type": "string",
                                      "description": "Enter the description",
                                      "title": "description"
                                    },
                                    "allow": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "categories to allow, Array of strings",
                                          "title": "allow member"
                                        }
                                      },
                                      "description": "allow"
                                    },
                                    "alert": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Categories to alert on, Array of strings",
                                          "title": "alert member"
                                        }
                                      },
                                      "description": "alert"
                                    },
                                    "block": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Categories to block, Array of strings",
                                          "title": "block member"
                                        }
                                      },
                                      "description": "block"
                                    },
                                    "continue": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Categories to continue, Array of strings",
                                          "title": "continue member"
                                        }
                                      },
                                      "description": "continue"
                                    },
                                    "override": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Categories to admin override, Array of strings",
                                          "title": "override member"
                                        }
                                      },
                                      "description": "override"
                                    },
                                    "credential-enforcement": {
                                      "type": "object",
                                      "properties": {
                                        "mode": {
                                          "type": "object",
                                          "properties": {
                                            "disabled": {
                                              "type": "object",
                                              "description": "disabled (object) or ip-user (object) or domain-credentials (object) or group-mapping (object)"
                                            }
                                          },
                                          "description": "mode"
                                        },
                                        "log-severity": {
                                          "type": "string",
                                          "description": "Log severity when credential matched",
                                          "title": "credential-enforcement log severity",
                                          "default": "any"
                                        },
                                        "allow": {
                                          "type": "object",
                                          "properties": {
                                            "member": {
                                              "type": "string",
                                              "description": "Categories to allow and bypass credential enforcement",
                                              "title": "credential-enforcement allow member"
                                            }
                                          },
                                          "description": "allow"
                                        },
                                        "alert": {
                                          "type": "object",
                                          "properties": {
                                            "member": {
                                              "type": "string",
                                              "description": "Categories to alert on credential match",
                                              "title": "credential-enforcement alert member"
                                            }
                                          },
                                          "description": "alert"
                                        },
                                        "block": {
                                          "type": "object",
                                          "properties": {
                                            "member": {
                                              "type": "string",
                                              "description": "Categories to block on credential matchmember",
                                              "title": "credential-enforcement allow member"
                                            }
                                          },
                                          "description": "block"
                                        },
                                        "continue": {
                                          "type": "object",
                                          "properties": {
                                            "member": {
                                              "type": "string",
                                              "description": "Categories to block/continue on credential match",
                                              "title": "credential-enforcement continue member"
                                            }
                                          },
                                          "description": "continue"
                                        }
                                      },
                                      "description": "credential-enforcement",
                                      "required": [
                                        "mode",
                                        "log-severity"
                                      ]
                                    },
                                    "enable-container-page": {
                                      "type": "string",
                                      "description": "Enter the enable-container-page",
                                      "title": "enable-container-page",
                                      "enum": [
                                        true,
                                        false
                                      ],
                                      "default": true
                                    },
                                    "log-container-page-only": {
                                      "type": "string",
                                      "description": "Log container page only",
                                      "title": "log-container-page-only",
                                      "enum": [
                                        true,
                                        false
                                      ],
                                      "default": true
                                    },
                                    "safe-search-enforcement": {
                                      "type": "string",
                                      "description": "Safe-Search will be enforced if it is set",
                                      "title": "safe-search-enforcement",
                                      "enum": [
                                        true,
                                        false
                                      ],
                                      "default": false
                                    },
                                    "log-http-hdr-xff": {
                                      "type": "string",
                                      "description": "Log HTTP Header X-Forwarded-For field",
                                      "title": "log-http-hdr-xff",
                                      "enum": [
                                        true,
                                        false
                                      ]
                                    },
                                    "log-http-hdr-user-agent": {
                                      "type": "string",
                                      "description": "Log HTTP Header User-Agent field",
                                      "title": "log-http-hdr-user-agent",
                                      "enum": [
                                        true,
                                        false
                                      ],
                                      "default": false
                                    },
                                    "log-http-hdr-referer": {
                                      "type": "string",
                                      "description": "Log HTTP Header Referer field",
                                      "title": "log-http-hdr-referer",
                                      "enum": [
                                        true,
                                        false
                                      ]
                                    },
                                    "http-header-insertion": {
                                      "type": "object",
                                      "properties": {
                                        "entry": {
                                          "type": "object",
                                          "properties": {
                                            "@name": {
                                              "type": "string",
                                              "description": "Enter the http-header-insertion entry name",
                                              "title": "http-header-insertion entry name"
                                            },
                                            "type": {
                                              "type": "object",
                                              "properties": {
                                                "entry": {
                                                  "type": "object",
                                                  "properties": {
                                                    "@name": {
                                                      "type": "string",
                                                      "description": "Enter the http-header-insertion type entry name",
                                                      "title": "http-header-insertion type entry name"
                                                    },
                                                    "headers": {
                                                      "type": "object",
                                                      "properties": {
                                                        "entry": {
                                                          "type": "object",
                                                          "properties": {
                                                            "@name": {
                                                              "type": "string",
                                                              "description": "Enter the http-header-insertion entry type entry headers entry name",
                                                              "title": "http-header-insertion entry type entry headers entry name"
                                                            },
                                                            "header": {
                                                              "type": "string",
                                                              "description": "Enter the http-header-insertion entry type entry headers entry header",
                                                              "title": "http-header-insertion entry type entry headers entry header"
                                                            },
                                                            "value": {
                                                              "type": "string",
                                                              "description": "Enter the http-header-insertion entry type entry headers entry value",
                                                              "title": "http-header-insertion entry type entry headers entry value"
                                                            },
                                                            "log": {
                                                              "type": "string",
                                                              "description": "Enter the http-header-insertion entry type entry headers entry log",
                                                              "title": "http-header-insertion entry type entry headers entry log",
                                                              "default": false,
                                                              "enum": [
                                                                true,
                                                                false
                                                              ]
                                                            }
                                                          },
                                                          "description": "entry",
                                                          "required": [
                                                            "name",
                                                            "header",
                                                            "value",
                                                            "log"
                                                          ]
                                                        }
                                                      },
                                                      "description": "headers",
                                                      "required": [
                                                        "entry"
                                                      ]
                                                    },
                                                    "domains": {
                                                      "type": "object",
                                                      "properties": {
                                                        "member": {
                                                          "type": "string",
                                                          "description": "Enter the http-header-insertion entry type entry domains member",
                                                          "title": "http-header-insertion entry type entry domains member"
                                                        }
                                                      },
                                                      "description": "domains",
                                                      "required": [
                                                        "member"
                                                      ]
                                                    }
                                                  },
                                                  "description": "entry"
                                                }
                                              },
                                              "description": "type",
                                              "required": [
                                                "entry"
                                              ]
                                            }
                                          },
                                          "description": "entry",
                                          "required": [
                                            "@name",
                                            "type",
                                            "domains"
                                          ]
                                        }
                                      },
                                      "description": "http-header-insertion",
                                      "required": [
                                        "entry"
                                      ]
                                    },
                                    "mlav-category-exception": {
                                      "type": "object",
                                      "properties": {
                                        "member": {
                                          "type": "string",
                                          "description": "Enter the mlav-category-exception member",
                                          "title": "mlav-category-exception member"
                                        }
                                      },
                                      "description": "mlav-category-exception",
                                      "required": [
                                        "member"
                                      ]
                                    },
                                    "mlav-engine-urlbased-enabled": {
                                      "type": "object",
                                      "properties": {
                                        "entry": {
                                          "type": "object",
                                          "properties": {
                                            "@name": {
                                              "type": "string",
                                              "description": "Enter the mlav-engine-urlbased-enabled entry name",
                                              "title": "mlav-engine-urlbased-enabled entry name"
                                            },
                                            "mlav-policy-action": {
                                              "type": "string",
                                              "description": "Enter the mlav-engine-urlbased-enabled mlav-policy-action",
                                              "title": "mlav-engine-urlbased-enabled mlav-policy-action",
                                              "enum": [
                                                "block",
                                                "alert",
                                                "allow"
                                              ]
                                            }
                                          },
                                          "description": "entry",
                                          "required": [
                                            "@name",
                                            "mlav-policy-action"
                                          ]
                                        }
                                      },
                                      "description": "mlav-engine-urlbased-enabled",
                                      "required": [
                                        "entry"
                                      ]
                                    }
                                  },
                                  "description": "entry",
                                  "required": [
                                    "@name",
                                    "allow",
                                    "alert",
                                    "continue",
                                    "block",
                                    "credential-enforcement",
                                    "description",
                                    "enable-container-page",
                                    "http-header-insertion",
                                    "log-container-page-only",
                                    "log-http-hdr-user-agent",
                                    "mlav-category-exception",
                                    "mlav-engine-urlbased-enabled",
                                    "override",
                                    "safe-search-enforcement",
                                    "log-http-hdr-xff",
                                    "log-http-hdr-referer"
                                  ]
                                }
                              },
                              "required": [
                                "entry"
                              ]
                            }
                          }
                        ]
                      }
                    }
                  },
                  "securityDefinitions": {
                    "API Key": {
                      "type": "apiKey",
                      "in": "header",
                      "name": "X-PAN-KEY"
                    }
                  },
                  "security": [
                    {}
                  ]
                }
              }
            },
            {
              "type": "Microsoft.Web/customApis",
              "apiVersion": "2016-06-01",
              "name": "[[parameters('PaloAlto_PAN-OS_XML_API_CustomConnector_Name')]",
              "location": "[[[variables('workspace-location-inline')]",
              "properties": {
                "connectionParameters": {
                  "api_key": {
                    "type": "securestring",
                    "uiDefinition": {
                      "displayName": "API Key",
                      "description": "The API Key for this api",
                      "tooltip": "Provide your API Key",
                      "constraints": {
                        "tabIndex": 2,
                        "clearText": false,
                        "required": "true"
                      }
                    }
                  }
                },
                "backendService": {
                  "serviceUrl": "[[parameters('Service_EndPoint')]"
                },
                "brandColor": "#FFFFFF",
                "description": "This is the PaloAlto Custom Connector",
                "displayName": "[[parameters('PaloAlto_PAN-OS_XML_API_CustomConnector_Name')]",
                "iconUri": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAAEYCAYAAACHjumMAAARQklEQVR4nOzdv49c1fnH8TOD8Xc7u7G9Nfo2ETPCVCFVEGlSOt2SxqaiROmQyIhYC4roSBWKSGApCu7iMgUFokk61vFGuMgfYG8UCaQkshbhie4yd3O9OzP3x3Ofc57nnPer8ffrxeZm5+5nn/PcDzvTAABKCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBgAaggYAGoIGABqCBhD3pntXk59DZ7x+QO2OH599uHx3vyT1Nfh1fHe/C/HP3/xeurrwP8wwRhx8oWxnLwZQrhJyPS3+pz9MDydfk7I2PFc6gso3WJ+Zfezn7zwXlhOfxtC2Fn99vXF7NqNEMLjL47+/TDxJZq2mF298dlrL3waQvjp6rd2wnJyazG/eiVMlgdfHP3nX4kvsWiT1BdQspPvtE+nn4cQLm35x+5cvPvgVsTLcmM1tdzc8o98E6ZPX734h78dRLwsNHBESqRjuASOTOt1CJdw8rnlyJQUAZNAj3CpETINHcOlRsgkxA4msgHhUqu+QO6XvpPpGS61nbCcvB4my0/YycTFBBPRYn5ld2C4fP/nZ9feHf+q/FjMrt4YEC61S4vZtbdHviS0YMkb0fHrsw/DcvKW8K8pdul7vDf/cjXJDfUkTJ/+iKVvPEwwkTR6LlJF7mNW/5ule5Qd9jFxsYNRtqHnIlVMT2ZNz0WKnkxEHJEUCRa6fWR7ZBq40O2DnowyjkhKIoVLyPXIFCFcAo+w9REwCiKGSy2rkIkULjVCRhE7mJElCJdaFj2ZyOFSoyejhAlmRNKei/jf77wnI+y5SNGTUcCSd0Qj9Vyk3C59R+i5SNGTGRkTzEhG7LlIudzHjNRzkaInMzJ2MEJKPRcpNz0ZhZ6LFD2ZEXFEEki40O3D7JEp0UK3D3oyQhyRBnISLsHqkclBuAQeYcsRMAM4CpeaqZBxEi41QkaAHUxPDsOlZqIn4yxcavRkBmKC6SF1z0UqdU8mcc9Fip7MACx5ezDSc5FKtvQ10HORoifTExNMR4Z6LlJJ9jFGei5S9GR6YgfTwmjPRSpaT8Zgz0WKnkwPHJG2cLzQ7UPtyOR0odsHPZkWHJE2KCRcgtaRqYBwCTzCbkfArFFQuNRGDZlCwqVGyGzBDuaMAsOlNkpPprBwqdGT2YAJpsF7z0VK2pNx3nORoiezBkvehkx6LlKDl74Z9Fyk6MmcwQSzklHPRWrQPiaTnosUPZkzit/BZNpzkerck8mw5yJFT6ah6CNSwQvdPjYemQpd6PZRfE+m2CMS4dLZ2iMT4dJJ8Y+wiwwYwqW3Z0KGcOml6JApbgdDuAx20pP57LUX3iZceiu2J1PUDmYxv7K7eHH3IeEyzHK5/PtkMvn/1Nfh1fTC5PaF3//1V6mvI6aijkirIhThMtByuvxdNcWkvg6vbh88upf6GmIrJmDouYjd//VX//zN8zvPvUrIDPLG/uFRcU+Tsg+Y6lh00tB9Ov0zPZdBHk0vTH7x/sN/vHL74NGTyScHX1f/d/V71cdSX5wD9/YPH7988e4DMz90PaasdzAsdMXuVxNLFSrrPri8df3yt0++qz6/L8W/NBfeKDVYatlOMISL2NZwqVQf48i0UfHhEnINGMJFrDVcaoTMWoTLSnZHJMJFrHO4NK2OS1+FEHb1Ls0FwqUhqwmm9J/nMoJHQ8IlrCaZ6YXJBzqX5cY9wuVZeQUMPReRKiCGhEtt//Doo5KPSvuHj2+nvgZrsgkYei5i91cBMdjtg0dPCt7HFNlzaeM+YOi5iD3Tc5H+ZQX2ZIruubRxveRloSs2aKHbVQE9GRa6LdxOMISLmGq4hPwfYRMuHbgMGMJFTD1capmGDOHSkbsjEuEiFi1cmjLqyRAuPbiaYOi5iA3uuUhl0pOh59KTr4Ch5yIi7blIee/J0HPpz03A0HMRE/dcpJz3ZOi5DGA+YOi5iI3ac5Fy2JMx23N5Z7Z7OfU1tDG95GWhK5ZkoduFk9fW7EJ39c4ON6y/75LZCcbJDWgZ4SJjPVxuenhLFJMB4+QGtIxwkfEQLjXTIWMuYJzcgJaZDRcnNQOz4bKYXb2x4T2pTkLm5PNrjKmAcXIDWpas59KFg5qB6Z7LYnbt3S0fvrT6/JpiK2Ds34Cmpe65bOOhZmC557I6Gm0/Bi0nb1o7KpkJGA83oHHJey6bNI69lmsGZnsuPd4LfMfaPiZ5wNBzETPVc2k689panUzN9lwWs6s3jvfmX/Z8L/BL1ee7+rxb2Mkk7cGw0BUzu9B18tqaXej2mFq2+SZ1TybZBOPkBrSMcJHJPVyChUfYSQLGyQ1oGeEiU0K41JKGTPSAcXIDWmY2XJzUDMyGy5aei1SynkzUgHFyA1pGz0XGc89FKklPJm7A2L8BTaPnIuO+5yKVoCcTLWA83IDG0XORyaHnIhW9J6MeMPRcxOi5yOTWc5GK2pNR7cGw0BUzu9B18tqaXehGnFq2Ue/JqE0wTm5AywgXGcKlnfojbJWAcXIDWka4yBAu3amGzOgB4+QGtMxsuDipGZgNF8Wei5RaT2bUgHFyA1pGz0Wm5J6LlEpPZtyAsX8DmkbPRab4nouUQk9mtIDxcAMaR89Fhp6L3Og9GXHA0HMRo+ciQ89lXKP2ZEQ9GBa6YmYXuk5eW7MLXUdTyzbinszgCcbJDWgZ4SJDuOgTP8IeFDBObkDLCBcZwiUeUcj0DhgnN6BlZsPFSc3AbLgY7rlIDe7J9AoYJzegZfRcZOi5pDOoJ9MvYOzfgKbRc5Gh55LYgJ5M54DxcAMaR89Fhp5Ler17Mq0BQ89FjJ6LDD0XW3r1ZLb2YFjoipld6Dp5bc0udAuaWrZp7clsnGCc3ICWES4yhIt9rY+w1waMkxvQMsJFhnDxY2vInAsYJzegZWbDxUnNwGy4ZNxzkdrYk3kmYJzcgJbRc5Gh5+LX2p7MswFj/wY0jZ6LDD0X59b0ZE4DxsMNaBw9Fxl6Lv6d68lM6bmI0XORoeeSl9OezDuz3csXfjnbfSUsw1upr8opswvd06llaTZYguWFLlOLyE5YTi6/f/jo6+n/ffrgXvVCp74ih+yHi92pJRAuWbtz8e6DW6HewaxeaEKmO8JFhnDJ12m4hOaSd/WC30t2WX6YDRcnNQOz4ULPReygGS7h7GNqy48JjaDnIkPPJWPr8uNMwJw8JuSotAE9FxnL38DouYjd2T88OncCOvefCrCP2Yieiww9l3zdOXs0qq39jx2rkNk/fPwyO5kT9Fxk6Lnk62D/8PHPNoVL6PK+SMd78+oPfzz6pflgdqHL0yIZphaxjVNLU+tPtCv4yES4yBAu+eoULqHrz+QtMGQIFxnCJV+dwyX0+aHfBfVkzIYLPRcZei5i53oubXq9bYnlx4wjoeciQ88lY0O+/nsGTN49GXouMpa/AdFzEVvbc2nT+61jM97H0HORoeeSr157l6ZBb36fWU+GnosMPZd8tfZc2rT2YNo478mYXejytEiGqUVs8NTSNGiCaXJ8ZCJcZAiXfI0SLmGMgAk+Q4ZwkSFc8jVauISxAib46smYDRd6LjL0XMR691zajBYwwfhjyhV6LjL0XDKm8fU7csDY7snQc5Gx/A2EnovYoJ5Lm1EDJtjex9BzkaHnkq9R9y5NowdMsNeToeciQ88lX+KeSxtxD6ZN4p6M2YUuT4tkmFrE1KaWJpUJpinhkYlwkSFc8hUlXEKMgAlpQoZwkSFc8hUtXEKsgAlxezJmw4Weiww9F7HRey5togVMiPOYk56LDD2XjKWoGUQOGN2eDD0XGXouWVPpubSJGjBBdx9Dz0WGnku+ou5dmqIHTBi/J0PPRYaeS77Uey5t1HswbYQ9GbMLXZ4WyTC1iCWbWpqSTDBNgiMT4SJDuOTLRLgECwEThoUM4SJDuOTLTLgEKwET+vVkzIYLPRcZei5i0XsubcwETOj2mJSeiww9l4xZrBkYC5jtPRl6LjIWb8AaPRexJD2XNqYCJmzfx9BzkaHnki9Te5cmcwETzvdk6LnI0HPJV/KeS5vkPRivnDwtCla/uzG1iJl8Xc8yOcFY5yhcKjdXX8xmEC5iLsIlEDD9OQuXmpmQIVzE3IRLIGD6cdJz2eTmqmeSDD0XMXM9lzYETA8Oei5bpe6ZpP73e2e5ZrAJAdORh55LB9dTHZXouYiZ7Lm0IWA6cNJz6Sr6Poa9i5irvUsTAbOFk57LEFXIfKm9k6HnIma+59KGHswGTp8WDaHy3ZGpRczt1NLEBLNGQeESNI5MhItYFuESCJjzCguX2mghQ7iIZRMugYB5lvOei5S4J0PPRcxdz6UNAdPgveciJe2p0HOR8dhzaUPArGTSc5Ea3JOh5yLmsufShoDJr+ci1Xsfw95FLKu9S1PRAZNxz0WqU0+GnouY+55Lm2J7MIU+LRpi7XdXphaxbKeWpiInGMKll3NHJsJFrIhwCSUGDOEyyGnIEC5ixYRLKO2ItJhf2V28uPuQcBnsDuEicnDx7oOXU19ETEVNMMvl5DLhIlLUF8fYcuy5tCkqYN47PHo48H2w8f07av64+jX1hTiVZc+lTVEBE2Rvtl+y07frrX4lZHorau/SVFzAhPPvu4TNTt+Tqn5HzerX6v+vfr/6eOoLNC77nkubopa86xzvzasX/+PU12HQ/bb3AV/eun752yfffR5CeCnupblQ7NTSVOQE08SRaa3WcAmraYYj01qEy0rxARMImbM6hUuNkDmHcGko/ojUdLw3/2MIIel7ByX26Pmd537QNVyaVselr0IIuzqX5kJxPZc2TDANJfYUmqYXJh8MCZewmmSqPz/+VflR+v2zDgHTsH94dFDwUen+/uHRR5K/YPXnSz0qFdlzacMRaY0Cnyz12rtsU+iTJfYuGzDBrFFQT+Zcz0WqsJ5M8T2XNkwwLTKeZkabWjbJfJphaumACaZFpo+w1cMl5P0Im3DpiIDpILOQiRIutQxDhnDpgSNSDxn0ZAb3XKQy6cnQc+mJCaYH7z0HSc9FKoeejPfXPwUCpgfnPRlxz0XKeU+GnssAHJEGcPhkKereZRunT5bYuwzEBDOAo57M6D0XKWc9GXouQkwwQoanGTNTyybGpxmmlhEwwQgZfYRtPlyC7UfYhMtICJgRGAsZF+FSMxgyhMuIOCKNyEBPJlnPRcpIT4aey8iYYEaUuieRsuciZaEnk/r1yxEBM6LEPZnkPRepxD0Zei4KOCIpSPBkydXeZZtET5bYuyhhglEQsSdjruciFbknQ89FGROMMsVpJpupZRPlaYapJQImGGVKj7CzD5eg+wibcImEgIlg5JApIlxqCiFDuETEESmiEXoybnsuUiP1ZOi5RMYEE5G0Z+G55yI1Rk+Gnkt8BExEwp6M+56LlLAnQ88lAY5ICQx4slTU3mWbgU+W2LskwgSTQI+eTHY9F6mePRl6LokxwSS2ZZphamnRMs0wtRjABJPYhkfYhEsHWx5hEy5GEDAGnAkZwqWHNSFDuADrHO/NP6rG/tTX4VH1eTvem/8p9XUAACLhiARADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0ANAQNADQEDQA0BA0DNfwMAAP//98IA4m2bU34AAAAASUVORK5CYII=",
                "swagger": {
                  "swagger": "2.0",
                  "info": {
                    "title": "Default title",
                    "description": "[variables('blanks')]",
                    "version": "1.0"
                  },
                  "host": "$substring([parameters('Service EndPoint')],8 )",
                  "basePath": "/",
                  "schemes": [
                    "https"
                  ],
                  "paths": {
                    "/api": {
                      "get": {
                        "responses": {
                          "default": {
                            "description": "default",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "@status": {
                                  "type": "string",
                                  "description": "status if success or failure",
                                  "title": "@status"
                                },
                                "@code": {
                                  "type": "string",
                                  "description": "status code",
                                  "title": "@code"
                                },
                                "result": {
                                  "type": "object",
                                  "description": "result"
                                }
                              }
                            }
                          }
                        },
                        "summary": "Query Palo Alto XML API",
                        "description": "Quert XML API for PCAPs and Device Info",
                        "operationId": "[[variables('_operationId-Queryxmlapi')]",
                        "x-ms-visibility": "important",
                        "parameters": [
                          {
                            "name": "type",
                            "in": "query",
                            "required": true,
                            "type": "string"
                          },
                          {
                            "name": "category",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "default": "threat-pcap"
                          },
                          {
                            "name": "pcap-id",
                            "in": "query",
                            "required": false,
                            "type": "integer"
                          },
                          {
                            "name": "search-time",
                            "in": "query",
                            "required": false,
                            "type": "string"
                          },
                          {
                            "name": "sessionId",
                            "in": "query",
                            "required": false,
                            "type": "integer"
                          },
                          {
                            "name": "device_name",
                            "in": "query",
                            "required": false,
                            "type": "string"
                          },
                          {
                            "name": "cmd",
                            "in": "query",
                            "required": false,
                            "type": "string",
                            "default": "<show><system><info></info></system></show>"
                          }
                        ]
                      }
                    }
                  },
                  "responses": {
                    "default": {
                      "description": "default"
                    }
                  },
                  "securityDefinitions": {
                    "API Key": {
                      "type": "apiKey",
                      "in": "query",
                      "name": "X-PAN-KEY"
                    }
                  },
                  "security": [
                    {}
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('LogicAppsCustomConnector-', last(split(variables('playbookId'),'/'))))]",
              "properties": {
                "parentId": "[[variables('playbookId')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "LogicAppsCustomConnector",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "comments": "This PaloAlto custom connector uses PAN-OS API to perform different actions on the PAN-OS VM",
            "lastUpdateTime": "2022-07-28T17:54:44.149Z",
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "PaloAlto-PAN-OS-GetSystemInfo playbook",
        "displayName": "PaloAlto-PAN-OS-GetSystemInfo playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName2'),'/',variables('playbookVersion2'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName2'))]"
      ],
      "properties": {
        "description": "PaloAlto-PAN-OS-GetSystemInfo Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "PaloAlto-PAN-OS-GetSystemInfo",
              "type": "String",
              "metadata": {
                "description": "Name of the Logic App/Playbook"
              }
            },
            "CustomConnectorName": {
              "defaultValue": "PAN-OSXmlApiCustomConnector",
              "type": "String",
              "metadata": {
                "description": "Name of the custom connector which interacts with PAN-OS"
              }
            },
            "LogAnalyticsResourceGroup": {
              "type": "string",
              "metadata": {
                "description": "Name of the cLog Analytics Resource group for logging"
              }
            },
            "LogAnalyticsResourceName": {
              "type": "string",
              "metadata": {
                "description": "Name of the Log Analytics instance for logging"
              }
            }
          },
          "variables": {
            "subscriptionId": "[[subscription().subscriptionId]",
            "location": "[[[variables('workspace-location-inline')]",
            "AzureMonitorConnectionName": "[[concat('azuremonitor-', parameters('PlaybookName'))]",
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "PaloAltoConnectorConnectionName": "[[concat('PaloAltoConnector-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('location'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('location'), '/managedApis/azuremonitorlogs')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[parameters('PlaybookName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('PaloAltoConnectorConnectionName')]",
              "location": "[[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureMonitorConnectionName')]",
              "location": "[[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('location')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/subscribe"
                      }
                    }
                  },
                  "actions": {
                    "For_each": {
                      "foreach": "@body('Run_query_and_list_results')?['value']",
                      "actions": {
                        "If_incident_is_a_Palo_Alto_incident": {
                          "actions": {
                            "Add_comment_to_incident_(V3)": {
                              "runAfter": {
                                "Query_Palo_Alto_XML_API": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "incidentArmId": "@triggerBody()?['object']?['id']",
                                  "message": "<p>@{body('Query_Palo_Alto_XML_API')}</p>"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "method": "post",
                                "path": "/Incidents/Comment"
                              }
                            },
                            "Query_Palo_Alto_XML_API": {
                              "type": "ApiConnection",
                              "inputs": {
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['paloaltoconnector']['connectionId']"
                                  }
                                },
                                "method": "get",
                                "path": "/api/",
                                "queries": {
                                  "cmd": "<show><system><info></info></system></show>",
                                  "device_name": "@{items('For_each')['MonitoringDeviceName']}",
                                  "type": "op"
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "contains": [
                                  "@items('For_each')['AlertSource']",
                                  "@string('PaloAlto')"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        }
                      },
                      "runAfter": {
                        "Run_query_and_list_results": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Run_query_and_list_results": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@{triggerBody()?['ExtendedProperties']?['Query']}\n| limit 10",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuremonitorlogs']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/queryData",
                        "queries": {
                          "resourcegroups": "[[parameters('LogAnalyticsResourceGroup')]",
                          "resourcename": "[[parameters('LogAnalyticsResourceName')]",
                          "resourcetype": "Log Analytics Workspace",
                          "subscriptions": "[[variables('subscriptionId')]",
                          "timerange": "Set in query"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuremonitorlogs": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureMonitorConnectionName'))]",
                        "connectionName": "azuremonitorlogs",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId,'/providers/Microsoft.Web/locations/', variables('location'), '/managedApis/azuremonitorlogs')]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "azuresentinel",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('location'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "paloaltoconnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                        "connectionName": "paloaltoconnector",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId,'/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_PaloAltoCustomConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "Get System Info - Palo Alto PAN-OS XML API",
            "description": "This playbook allows us to get System Info of a Palo Alto device for a Sentinel alert.",
            "mainSteps": [
              "When a new Sentinel incident is created, this playbook gets triggered and performs below actions: \n\n 1. Gets the various parameters from the alert \n\n 2. Gets the System Info for the device in the alert. \n\n 3. Creates a Sentinel Incident and updates it with the system info."
            ],
            "prerequisites": [
              "1. PaloAlto connector needs to be deployed prior to the deployment of this playbook under the same subscription. Relevant instructions can be found in the connector doc page. \n\n 2. Generate an API key.[Refer this link on how to generate the API Key](https://paloaltolactest.trafficmanager.net/restapi-doc/#tag/key-generation) \n\n 3. This playbook only works for Palo Alto incidents."
            ],
            "lastUpdateTime": "2022-07-25T00:00:00Z",
            "entities": [
              "Ip"
            ],
            "tags": [
              "Remediation",
              "Response from teams"
            ],
            "postDeployment": "** a. Authorize connections ** Once deployment is complete, you will need to authorize each connection. \n\n 1. Click the Microsoft Sentinel connection resource \n\n 2. Click edit API connection \n\n 3. Click Authorize \n\n 4. Sign in \n\n 5. Click Save \n\n 6. Repeat steps for other connections such as Blob Store connection and PAN-OS API connection (For authorizing the PAN-OS API connection, API Key needs to be provided) \n\n ** b. Configurations in Sentinel ** 1. In Microsoft sentinel analytical rules should be configured to trigger an incident with risky IP \n\n 2. Configure the automation rules to trigger this playbook",
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "Get System Info - Palo Alto PAN-OS XML API",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "PaloAlto-PAN-OS-GetThreatPcap playbook",
        "displayName": "PaloAlto-PAN-OS-GetThreatPcap playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName3'),'/',variables('playbookVersion3'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName3'))]"
      ],
      "properties": {
        "description": "PaloAlto-PAN-OS-GetThreatPcap Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "PaloAlto-PAN-OS-GetThreatPcap",
              "type": "String",
              "metadata": {
                "description": "Name of the Logic App/Playbook"
              }
            },
            "CustomConnectorName": {
              "defaultValue": "PAN-OSXmlApiCustomConnector",
              "type": "String",
              "metadata": {
                "description": "Name of the custom connector which interacts with PAN-OS"
              }
            },
            "LogAnalyticsResourceGroup": {
              "type": "string",
              "metadata": {
                "description": "Name of the cLog Analytics Resource group for logging"
              }
            },
            "LogAnalyticsResourceName": {
              "type": "string",
              "metadata": {
                "description": "Name of the log analytics instance for logging"
              }
            }
          },
          "variables": {
            "AzureBlobConnectionName": "[[concat('azureblob-', parameters('PlaybookName'))]",
            "AzureStorageName": "panosthreatpcapssa",
            "subscriptionId": "[[subscription().subscriptionId]",
            "location": "[[[variables('workspace-location-inline')]",
            "AzureMonitorConnectionName": "[[concat('azuremonitor-', parameters('PlaybookName'))]",
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "ContainerName": "panosthreatpcaps",
            "PaloAltoConnectorConnectionName": "[[concat('PaloAltoConnector-', parameters('PlaybookName'))]",
            "connection-4": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('location'), '/managedApis/azureblob')]",
            "_connection-4": "[[variables('connection-4')]",
            "connection-5": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('location'), '/managedApis/azuresentinel')]",
            "_connection-5": "[[variables('connection-5')]",
            "connection-6": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]",
            "_connection-6": "[[variables('connection-6')]",
            "connection-7": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('location'), '/managedApis/azuremonitorlogs')]",
            "_connection-7": "[[variables('connection-7')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Storage/storageAccounts",
              "apiVersion": "2021-04-01",
              "name": "[[variables('AzureStorageName')]",
              "location": "[[[variables('workspace-location-inline')]",
              "sku": {
                "name": "Standard_LRS",
                "tier": "Standard"
              },
              "kind": "StorageV2",
              "properties": {
                "accessTier": "Hot",
                "minimumTlsVersion": "TLS1_2",
                "supportsHttpsTrafficOnly": "true",
                "allowBlobPublicAccess": "false",
                "allowSharedKeyAccess": "true",
                "networkAcls": {
                  "bypass": "AzureServices",
                  "defaultAction": "Allow"
                }
              }
            },
            {
              "name": "[[concat(variables('AzureStorageName'), '/default')]",
              "type": "Microsoft.Storage/storageAccounts/blobServices",
              "apiVersion": "2021-02-01",
              "dependsOn": [
                "[[concat('Microsoft.Storage/storageAccounts/', variables('AzureStorageName'))]"
              ],
              "properties": {
                "deleteRetentionPolicy": {
                  "enabled": "false"
                }
              }
            },
            {
              "type": "Microsoft.Storage/storageAccounts/blobServices/containers",
              "apiVersion": "2019-06-01",
              "name": "[[concat(variables('AzureStorageName'), '/default/', variables('ContainerName'))]",
              "dependsOn": [
                "[[resourceId('Microsoft.Storage/storageAccounts/blobServices', variables('AzureStorageName'), 'default')]",
                "[[resourceId('Microsoft.Storage/storageAccounts', variables('AzureStorageName'))]"
              ],
              "properties": {
                "publicAccess": "None"
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureBlobConnectionName')]",
              "location": "[[[variables('workspace-location-inline')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Storage/storageAccounts/', variables('AzureStorageName'))]"
              ],
              "properties": {
                "displayName": "[[variables('AzureBlobConnectionName')]",
                "api": {
                  "id": "[[variables('_connection-4')]"
                },
                "parameterValues": {
                  "accountName": "[[variables('AzureStorageName')]",
                  "accessKey": "[[listKeys(resourceId('Microsoft.Storage/storageAccounts', variables('AzureStorageName')), '2021-09-01').keys[0].value]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[parameters('PlaybookName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-5')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('PaloAltoConnectorConnectionName')]",
              "location": "[[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-6')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureMonitorConnectionName')]",
              "location": "[[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-7')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('location')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('AzureBlobConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]"
              ],
              "identity": {
                "type": "SystemAssigned"
              },
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "For_each": {
                      "foreach": "@body('Run_query_and_list_results')?['value']",
                      "actions": {
                        "If_incident_is_a_Palo_Alto_incident": {
                          "actions": {
                            "If_PCAP_ID_Exists": {
                              "actions": {
                                "Add_comment_to_incident_(V3)": {
                                  "runAfter": {
                                    "Create_blob_(V2)": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "message": "<p>@{body('Create_blob_(V2)')?['Path']}</p>"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/Incidents/Comment"
                                  }
                                },
                                "Create_blob_(V2)": {
                                  "runAfter": {
                                    "Query_Palo_Alto_XML_API": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": "@body('Query_Palo_Alto_XML_API')",
                                    "headers": {
                                      "ReadFileMetadataFromServer": true
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azureblob']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/v2/datasets/@{encodeURIComponent(encodeURIComponent('defendpaloaltopcapsdev'))}/files",
                                    "queries": {
                                      "folderPath": "pcapblobs-palo-alto",
                                      "name": "@{concat(string('paloalto',items('For_each')['PcapID']), string(items('For_each')['TimeGenerated']), '.pcap')}",
                                      "queryParametersSingleEncoded": true
                                    }
                                  },
                                  "runtimeConfiguration": {
                                    "contentTransfer": {
                                      "transferMode": "Chunked"
                                    }
                                  }
                                },
                                "Query_Palo_Alto_XML_API": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['paloaltoconnector']['connectionId']"
                                      }
                                    },
                                    "method": "get",
                                    "path": "/api/",
                                    "queries": {
                                      "category": "threat-pcap",
                                      "device_name": "@items('For_each')['MonitoringDeviceName']",
                                      "pcap-id": "@items('For_each')['PcapID']",
                                      "search-time": "@{items('For_each')['TimeGenerated']}",
                                      "sessionId": "@items('For_each')['SessionID']",
                                      "type": "export"
                                    }
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "not": {
                                      "equals": [
                                        "@items('For_each')['PcapID']",
                                        "@null"
                                      ]
                                    }
                                  },
                                  {
                                    "not": {
                                      "equals": [
                                        "@items('For_each')['PcapID']",
                                        0
                                      ]
                                    }
                                  }
                                ]
                              },
                              "type": "If"
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "contains": [
                                  "@items('For_each')['AlertSource']",
                                  "@string('PaloAlto')"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        }
                      },
                      "runAfter": {
                        "Run_query_and_list_results": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "Run_query_and_list_results": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@{triggerBody()?['ExtendedProperties']?['Query']}\n| limit 10",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuremonitorlogs']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/queryData",
                        "queries": {
                          "resourcegroups": "[[parameters('LogAnalyticsResourceGroup')]",
                          "resourcename": "[[parameters('LogAnalyticsResourceName')]",
                          "resourcetype": "Log Analytics Workspace",
                          "subscriptions": "[[variables('subscriptionId')]",
                          "timerange": "Set in query"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azureblob": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureBlobConnectionName'))]",
                        "connectionName": "[[variables('AzureBlobConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId,'/providers/Microsoft.Web/locations/', variables('location'), '/managedApis/azureblob')]"
                      },
                      "azuremonitorlogs": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureMonitorConnectionName'))]",
                        "connectionName": "[[variables('AzureMonitorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuremonitorlogs')]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "paloaltoconnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                        "connectionName": "[[variables('PaloAltoConnectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId,'/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/', parameters('CustomConnectorName'))]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "LogicAppsCustomConnector",
                      "contentId": "[variables('_PaloAltoCustomConnector')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "Get Threat PCAP - Palo Alto PAN-OS XML API",
            "description": "This playbook allows us to get a threat PCAP for a given PCAP ID.",
            "mainSteps": [
              "When a new Sentinel incident is created, this playbook gets triggered and performs below actions: \n\n 1. Gets the various parameters from the alert \n\n 2. Gets the PCAP from the device. \n\n 3. Puts the PCAP in Blob Storage \n\n 4. Creates a Sentinel Incident and updates it with a link to the blob."
            ],
            "prerequisites": [
              "1. PaloAlto connector needs to be deployed prior to the deployment of this playbook under the same subscription. Relevant instructions can be found in the connector doc page. \n\n 2. Generate an API key.[Refer this link on how to generate the API Key](https://paloaltolactest.trafficmanager.net/restapi-doc/#tag/key-generation) \n\n 3. This playbook only works for Palo Alto incidents with a threat PCAP where the PCAP ID is not null or zero."
            ],
            "lastUpdateTime": "2022-07-25T00:00:00Z",
            "entities": [
              "Ip"
            ],
            "tags": [
              "Remediation",
              "Response from teams"
            ],
            "postDeployment": "** a. Authorize connections ** Once deployment is complete, you will need to authorize each connection. \n\n 1. Click the Microsoft Sentinel connection resource \n\n 2. Click edit API connection \n\n 3. Click Authorize \n\n 4. Sign in \n\n 5. Click Save \n\n 6. Repeat steps for other connections such as Blob Store connection and PAN-OS API connection (For authorizing the PAN-OS API connection, API Key needs to be provided) \n\n ** b. Configurations in Sentinel ** 1. In Microsoft sentinel analytical rules should be configured to trigger an incident with risky IP \n\n 2. Configure the automation rules to trigger this playbook",
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "Get Threat PCAP - Palo Alto PAN-OS XML API",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "PaloAlto-PAN-OS-GetURLCategoryInfo playbook",
        "displayName": "PaloAlto-PAN-OS-GetURLCategoryInfo playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName4'),'/',variables('playbookVersion4'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName4'))]"
      ],
      "properties": {
        "description": "PaloAlto-PAN-OS-GetURLCategoryInfo Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion4')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "PaloAlto-PAN-OS-GetURLCategoryInfo",
              "type": "String",
              "metadata": {
                "description": "Name of the Logic App/Playbook"
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "PaloAltoConnectorConnectionName": "[[concat('PaloAltoConnector-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/PaloAltoConnector')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('location'), '/managedApis/azuresentinel')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('PaloAltoConnectorConnectionName')]",
              "location": "[[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[[variables('location')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "When_Azure_Sentinel_incident_creation_rule_was_triggered_(Private_Preview_only)": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Entities_-_Get_URLs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/url"
                      }
                    },
                    "For_each_malicious_URL": {
                      "foreach": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "runAfter": {
                            "Create_HTML_table_for_URL_category_information": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p><strong>PAN-OS Playbook has collected the following information : </strong><br>\n<br>\nGot List of address objects and also got URL filtering category Information:<br>\n<br>\n<strong>Details of address objects:</strong><br>\n<br>\n<strong>name</strong> : &nbsp;@{outputs('Compose_body_of_address_object')?['@name']}<br>\n<strong>location </strong>: &nbsp;@{outputs('Compose_body_of_address_object')?['@location']}<br>\n<strong>vsys</strong> : &nbsp;@{outputs('Compose_body_of_address_object')?['@vsys']}<br>\n<strong>description</strong> : &nbsp;@{outputs('Compose_body_of_address_object')?['description']}<br>\n<strong>fqdn</strong> : &nbsp;@{outputs('Compose_body_of_address_object')?['fqdn']}<br>\n<br>\n<strong>Details of URL filtering category information:<br>\n</strong><br>\n@{body('Create_HTML_table_for_URL_category_information')}<br>\n</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Compose_body_of_address_object": {
                          "runAfter": {
                            "Filter_URL_from_list_of_address_objects": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose",
                          "inputs": "@body('Filter_URL_from_list_of_address_objects')?[0]",
                          "description": "This composes the body of address object where URL is a member"
                        },
                        "Create_HTML_table_for_URL_category_information": {
                          "runAfter": {
                            "Compose_body_of_address_object": [
                              "Succeeded"
                            ]
                          },
                          "type": "Table",
                          "inputs": {
                            "columns": [
                              {
                                "header": "name",
                                "value": "@item()?['@name']"
                              },
                              {
                                "header": "location",
                                "value": "@item()?['@location']"
                              },
                              {
                                "header": "vsys",
                                "value": "@item()?['@vsys']"
                              },
                              {
                                "header": "description",
                                "value": "@item()?['description']"
                              }
                            ],
                            "format": "HTML",
                            "from": "@body('List_custom_url_categories')?['result']?['entry']"
                          },
                          "description": "This creates HTML table for the URL filtering category information"
                        },
                        "Filter_URL_from_list_of_address_objects": {
                          "type": "Query",
                          "inputs": {
                            "from": "@body('List_address_objects')?['result']?['entry']",
                            "where": "@contains(item()?['fqdn'], items('For_each_malicious_URL')?['Url'])"
                          },
                          "description": "This filters the URL from the list of address objects"
                        }
                      },
                      "runAfter": {
                        "List_custom_url_categories": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    },
                    "List_address_objects": {
                      "runAfter": {
                        "Entities_-_Get_URLs": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/restapi/v10.0/Objects/Addresses",
                        "queries": {
                          "location": "vsys",
                          "vsys": "vsys1"
                        }
                      },
                      "description": "This Lists all the address objects present in the PAN-OS"
                    },
                    "List_custom_url_categories": {
                      "runAfter": {
                        "List_address_objects": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/restapi/v10.0/Objects/CustomURLCategories",
                        "queries": {
                          "location": "vsys",
                          "vsys": "vsys1"
                        }
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "PaloAltoConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                        "connectionName": "[[variables('PaloAltoConnectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/PaloAltoConnector')]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId4'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId4')]",
                "contentId": "[variables('_playbookContentId4')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "comments": "This playbook uses the PaloAlto connector to automatically enrich incidents generated by Sentinel for address object details and URL filtering category information from PAN-OS",
            "title": "PaloAlto-PAN-OS-GetURLCategoryInfo",
            "description": " When a new sentinal incident is created, this playbook gets triggered and performs below actions:",
            "mainSteps": [
              "1. Fetches the address group details and URL filtering category information from PAN-OS \n\n 2. Updates all the collected information in incident \n\n ![PaloAlto-PAN-OS-GetURLCategoryInfo](./designerscreenshot.PNG)"
            ],
            "prerequisites": [
              "1. PAN-OS Custom Connector needs to be deployed prior to the deployment of this playbook under the same subscription. \n\n 2. Generate an API key. [Refer this link on how to generate the API Key](https://paloaltolactest.trafficmanager.net/restapi-doc/#tag/key-generation)"
            ],
            "lastUpdateTime": "2022-07-25T00:00:00Z",
            "entities": [],
            "tags": [],
            "postDeployment": "** a. Authorize connections ** Once deployment is complete, you will need to authorize each connection. \n\n 1. Click the Microsoft Sentinel connection resource \n\n 2. Click edit API connection \n\n 3. Click Authorize \n\n 4. Sign in \n\n 5. Click Save \n\n 6. Repeat steps for PAN-OS API Connection (For authorizing the PAN-OS API connection, API Key needs to be provided) \n\n ** b. Configurations in Sentinel ** 1. In Microsoft sentinel analytical rules should be configured to trigger an incident with risky user account \n\n 2. Configure the automation rules to trigger this playbook",
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "PaloAlto-PAN-OS-GetURLCategoryInfo",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "PaloAlto-PAN-OS-BlockIP playbook",
        "displayName": "PaloAlto-PAN-OS-BlockIP playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName5'),'/',variables('playbookVersion5'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName5'))]"
      ],
      "properties": {
        "description": "PaloAlto-PAN-OS-BlockIP Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion5')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "PaloAlto-PAN-OS-BlockIP",
              "type": "String",
              "metadata": {
                "description": "Name of the Logic App/Playbook"
              }
            },
            "Teams GroupId": {
              "defaultValue": "TeamgroupId",
              "type": "String",
              "metadata": {
                "description": "GroupId of the Team channel"
              }
            },
            "Teams ChannelId": {
              "defaultValue": "TeamChannelId",
              "type": "String",
              "metadata": {
                "description": "Team ChannelId"
              }
            },
            "Address Group": {
              "defaultValue": "AddressGroup",
              "type": "String",
              "metadata": {
                "description": "Address Group"
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "TeamsConnectionName": "[[concat('teamsconnector-', parameters('PlaybookName'))]",
            "PaloAltoConnectorConnectionName": "[[concat('PaloAltoConnector-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/PaloAltoConnector')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('location'), '/managedApis/azuresentinel')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('location'), '/managedApis/teams')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('PaloAltoConnectorConnectionName')]",
              "location": "[[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('TeamsConnectionName')]",
              "location": "[[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[[variables('workspace-location-inline')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "When_Azure_Sentinel_incident_creation_rule_was_triggered_(Private_Preview_only)": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Compose_product_name": {
                      "runAfter": {
                        "Select_alert_product_names": [
                          "Succeeded"
                        ]
                      },
                      "type": "Compose",
                      "inputs": "@body('Select_alert_product_names')?[0]?['text']",
                      "description": "compose to select the incident alert product name"
                    },
                    "Condition_based_on_the_incident_configuration_from_adaptive_card": {
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p>PAN-OS Playbook ran and performed the following actions:<br>\n@{variables('IPAddressAction')}<br>\n<br>\n<br>\n<br>\nActions taken on Sentinel : Add comment to incident and closure with classification reason &nbsp;@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['data']['incidentStatus']}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Update_incident": {
                          "runAfter": {
                            "Add_comment_to_incident_(V3)": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "classification": {
                                "ClassificationAndReason": "@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['data']['incidentStatus']}"
                              },
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "severity": "@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['data']['incidentSeverity']}",
                              "status": "Closed"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "put",
                            "path": "/Incidents"
                          }
                        }
                      },
                      "runAfter": {
                        "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['submitActionId']",
                              "Change incident configuration"
                            ]
                          }
                        ]
                      },
                      "type": "If",
                      "description": "This decides the action taken on the summarized adaptive card"
                    },
                    "Entities_-_Get_IPs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/ip"
                      }
                    },
                    "For_each_malicious_IP": {
                      "foreach": "@body('Entities_-_Get_IPs')?['IPs']",
                      "actions": {
                        "Condition_based_on_user_inputs_from_the_adaptive_card": {
                          "actions": {
                            "Condition__to_check_if_user_chosen_Block_IP": {
                              "actions": {
                                "Create_an_address_object": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "entry": {
                                        "@@name": "@items('For_each_malicious_IP')?['Address']",
                                        "description": "@items('For_each_malicious_IP')?['Address']",
                                        "ip-netmask": "@items('For_each_malicious_IP')?['Address']"
                                      }
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/restapi/v10.0/Objects/Addresses",
                                    "queries": {
                                      "address type": "ip-netmask",
                                      "location": "vsys",
                                      "name": "@items('For_each_malicious_IP')?['Address']",
                                      "vsys": "vsys1"
                                    }
                                  },
                                  "description": "This creates a new address object for the malicious IP"
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                      "Block IP ( add to @{outputs('Configured_address_group')} address group )"
                                    ]
                                  },
                                  {
                                    "equals": [
                                      "@length(body('Filter_array_of_Ip_address_from_list_of_address_objects'))",
                                      0
                                    ]
                                  }
                                ]
                              },
                              "type": "If",
                              "description": "This check if user chooses Block IP"
                            },
                            "Condition_to_check_the_edit_an_address_object_group_status": {
                              "actions": {
                                "Condition_to_check_the_action_of_adaptive_card_to_set_the_action_summary": {
                                  "actions": {
                                    "Append_success_status_Blocked_IP_status_to_summary_card": {
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "IPAddressAction",
                                        "value": "IP Address : @{items('For_each_malicious_IP')?['Address']} ,  Action Taken :  Blocked  by               \n                       adding to @{outputs('Configured_address_group')}  ,  Status  :  Success"
                                      },
                                      "description": "append action taken to summarize on the adaptive card"
                                    }
                                  },
                                  "else": {
                                    "actions": {
                                      "Append_success_status_UnBlocked_IP_status_to_summary_card": {
                                        "type": "AppendToArrayVariable",
                                        "inputs": {
                                          "name": "IPAddressAction",
                                          "value": "IP Address : @{items('For_each_malicious_IP')?['Address']} ,  Action Taken :  UnBlocked  by      \n                                  removing from @{outputs('Configured_address_group')}  ,  Status  :  Success"
                                        },
                                        "description": "append action taken to summarize on the adaptive card"
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "equals": [
                                          "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                          "Block IP ( add to @{outputs('Configured_address_group')} address group )"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                }
                              },
                              "runAfter": {
                                "Update_an_address_object_group": [
                                  "Succeeded"
                                ]
                              },
                              "else": {
                                "actions": {
                                  "Append_failure_status_to_summary_card": {
                                    "type": "AppendToArrayVariable",
                                    "inputs": {
                                      "name": "IPAddressAction",
                                      "value": "IP Address : @{items('For_each_malicious_IP')?['Address']} ,  Action Taken :  @{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']} ,  Status         :  Failure"
                                    },
                                    "description": "append action taken to summarize on the adaptive card"
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@body('Update_an_address_object_group')?['@status']",
                                      "success"
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            },
                            "Update_an_address_object_group": {
                              "runAfter": {
                                "Condition__to_check_if_user_chosen_Block_IP": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "entry": {
                                    "@@name": "[[parameters('Address Group')]",
                                    "static": {
                                      "member": "@variables('AddressGroupMembers')"
                                    }
                                  }
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                  }
                                },
                                "method": "put",
                                "path": "/restapi/v10.0/Objects/AddressGroups",
                                "queries": {
                                  "location": "vsys",
                                  "name": "[[parameters('Address Group')]",
                                  "vsys": "vsys1"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Append_to_array_variable_Ip_address_action_chosen": {
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "IPAddressAction",
                                  "value": "IP Address : @{items('For_each_malicious_IP')?['Address']} ,  Action Taken :  @{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']} ,  Status :  Success                                               "
                                },
                                "description": "This appends the action taken on IP to the list of existing actions"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "equals": [
                                    "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                    "Ignore"
                                  ]
                                }
                              }
                            ]
                          },
                          "type": "If",
                          "description": "condition to check the submit action is block / unblock or Ignore"
                        },
                        "Condition_to_check_if_Ip_address_already_present_in_list_of_address_objects": {
                          "actions": {
                            "Condition_to_check_if_Ip_already_present_in_predefined_address_group": {
                              "actions": {
                                "Append_address_group_text": {
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "AdaptiveCardBody",
                                    "value": {
                                      "text": "The IP  @{items('For_each_malicious_IP')?['Address']} is already a member of the blocked address group @{outputs('Configured_address_group')}",
                                      "type": "TextBlock",
                                      "wrap": true
                                    }
                                  },
                                  "description": "append address group text to adaptive card dynamically"
                                },
                                "Filter_array_IP_address_from_the_list_of_address_objects_to_unreference": {
                                  "runAfter": {
                                    "Set_dynamic_action_name": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Query",
                                  "inputs": {
                                    "from": "@variables('AddressGroupMembers')",
                                    "where": "@not(equals(item(), items('For_each_malicious_IP')?['Address']))"
                                  },
                                  "description": "This filters the IP address from predefined address group to unreference/unblock IP"
                                },
                                "Set_dynamic_action_name": {
                                  "runAfter": {
                                    "Append_address_group_text": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "ActionName",
                                    "value": "UnBlock IP"
                                  },
                                  "description": "variable to set action name dynamically"
                                },
                                "unreference_IP_address_from_the_existing_group_members": {
                                  "runAfter": {
                                    "Filter_array_IP_address_from_the_list_of_address_objects_to_unreference": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "AddressGroupMembers",
                                    "value": "@body('Filter_array_IP_address_from_the_list_of_address_objects_to_unreference')"
                                  },
                                  "description": "unreference IP address from the group members and update"
                                }
                              },
                              "else": {
                                "actions": {
                                  "Append_IP_address_to_the_address_group_members": {
                                    "runAfter": {
                                      "Append_address_group_text_to_adaptive_card_body": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "AppendToArrayVariable",
                                    "inputs": {
                                      "name": "AddressGroupMembers",
                                      "value": "@items('For_each_malicious_IP')?['Address']"
                                    },
                                    "description": "append IP address to the address group members"
                                  },
                                  "Append_address_group_text_to_adaptive_card_body": {
                                    "type": "AppendToArrayVariable",
                                    "inputs": {
                                      "name": "AdaptiveCardBody",
                                      "value": {
                                        "text": "The IP  @{items('For_each_malicious_IP')?['Address']} is not a member of the blocked address group @{outputs('Configured_address_group')}",
                                        "type": "TextBlock",
                                        "wrap": true
                                      }
                                    },
                                    "description": "append address group text to adaptive card dynamically"
                                  },
                                  "Set_dynamic_action_name_to_variable_Action_name": {
                                    "runAfter": {
                                      "Append_IP_address_to_the_address_group_members": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "SetVariable",
                                    "inputs": {
                                      "name": "ActionName",
                                      "value": "Block IP"
                                    },
                                    "description": "set action name dynamically"
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "contains": [
                                      "@variables('AddressGroupMembers')",
                                      "@items('For_each_malicious_IP')?['Address']"
                                    ]
                                  }
                                ]
                              },
                              "type": "If",
                              "description": "condition to check the malicious IP address is present in the predefined address group and the IP is part of static member"
                            }
                          },
                          "runAfter": {
                            "Condition_to_check_if_the_IP_is_a_part_of_security_policy_rules": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Append_IP_to_array_of_address_group_members": {
                                "runAfter": {
                                  "Append_to_array_variable_text_if_IP_is_not_a_member_of_blocked_address_group": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "AddressGroupMembers",
                                  "value": "@items('For_each_malicious_IP')?['Address']"
                                },
                                "description": "append the Malicious IP address to the existing group members to block / unblock from the predefined address group"
                              },
                              "Append_to_array_variable_text_if_IP_is_not_a_member_of_blocked_address_group": {
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "AdaptiveCardBody",
                                  "value": {
                                    "text": "The IP  @{items('For_each_malicious_IP')?['Address']} is not a member of the blocked address group @{outputs('Configured_address_group')}",
                                    "type": "TextBlock",
                                    "wrap": true
                                  }
                                },
                                "description": "This appends the text to display If Ip is not a member of security policy rules"
                              },
                              "Set_variable_to_Block_Ip": {
                                "runAfter": {
                                  "Append_IP_to_array_of_address_group_members": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "SetVariable",
                                "inputs": {
                                  "name": "ActionName",
                                  "value": "Block IP"
                                },
                                "description": "This sets the variable block IP"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Filter_array_of_Ip_address_from_list_of_address_objects'))",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If",
                          "description": "This checks if Ip is a member of any of the list of address objects"
                        },
                        "Condition_to_check_if_the_IP_is_a_part_of_security_policy_rules": {
                          "actions": {
                            "Append_policy_text": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "AdaptiveCardBody",
                                "value": {
                                  "text": "It is also member of the following security policy rules",
                                  "type": "TextBlock"
                                }
                              },
                              "description": "dynamic policy text based on security policies"
                            },
                            "Append_security_policies": {
                              "runAfter": {
                                "Append_policy_text": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "AdaptiveCardBody",
                                "value": {
                                  "columns": [
                                    {
                                      "items": "@body('Select_security_policy_rules')",
                                      "type": "Column"
                                    }
                                  ],
                                  "type": "ColumnSet"
                                }
                              },
                              "description": "append security policies which the IP address is exist"
                            }
                          },
                          "runAfter": {
                            "Select_security_policy_rules": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Append_policy_text_to_adaptive_card_body_variable": {
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "AdaptiveCardBody",
                                  "value": {
                                    "text": "It is not a member of any other Policy Rules",
                                    "type": "TextBlock"
                                  }
                                },
                                "description": "dynamic policy text based on security policies"
                              },
                              "Append_security_policies_to_adaptive_card_body_variable": {
                                "runAfter": {
                                  "Append_policy_text_to_adaptive_card_body_variable": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "AdaptiveCardBody"
                                },
                                "description": "append security policies which the IP address is exist"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Select_security_policy_rules'))",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If",
                          "description": "condition to check if the IP address is present in the existing security policy rules to conditionally apply the policy text and security policy rules"
                        },
                        "Configured_address_group": {
                          "runAfter": {
                            "Set_variable_address_group_members": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose",
                          "inputs": "@body('List_address_groups')?['result']?['entry']?[0]?['@name']",
                          "description": "compose predefined address group"
                        },
                        "Filter_array_Ip_from_list_of_security_rules": {
                          "runAfter": {
                            "Configured_address_group": [
                              "Succeeded"
                            ]
                          },
                          "type": "Query",
                          "inputs": {
                            "from": "@body('List_security_rules')?['result']?['entry']",
                            "where": "@contains(item()?['source']?['member'], items('For_each_malicious_IP')?['Address'])"
                          },
                          "description": "This filters all the security rules in which this Ip is a member"
                        },
                        "Filter_array_of_Ip_address_from_list_of_address_objects": {
                          "runAfter": {
                            "Set_variable_adaptive_card_body": [
                              "Succeeded"
                            ]
                          },
                          "type": "Query",
                          "inputs": {
                            "from": "@body('List_address_objects')?['result']?['entry']",
                            "where": "@equals(item()?['ip-netmask'], items('For_each_malicious_IP')?['Address'])"
                          },
                          "description": "This filters the list of address objects in which this Ip is a member "
                        },
                        "List_address_groups": {
                          "runAfter": {
                            "Filter_array_of_Ip_address_from_list_of_address_objects": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/restapi/v10.0/Objects/AddressGroups",
                            "queries": {
                              "location": "vsys",
                              "name": "[[parameters('Address Group')]",
                              "vsys": "vsys1"
                            }
                          },
                          "description": "This gets complete list of address object groups present in the PAN-OS"
                        },
                        "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3": {
                          "runAfter": {
                            "Condition_to_check_if_Ip_address_already_present_in_list_of_address_objects": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnectionWebhook",
                          "inputs": {
                            "body": {
                              "body": {
                                "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\":@{variables('AdaptiveCardBody')} ,\n     \"actions\": [\n  {\n    \"title\": \"@{variables('ActionName')} ( add to @{outputs('Configured_address_group')} address group )\",\n    \"type\": \"Action.Submit\"\n  },\n  {\n    \"title\": \"Ignore\",\n    \"type\": \"Action.Submit\"\n  }\n],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                "recipient": {
                                  "channelId": "[[parameters('Teams ChannelId')]"
                                },
                                "shouldUpdateCard": true
                              },
                              "notificationUrl": "@{listCallbackUrl()}"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['teams']['connectionId']"
                              }
                            },
                            "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                            "queries": {
                              "groupId": "[[parameters('Teams GroupId')]"
                            }
                          }
                        },
                        "Select_security_policy_rules": {
                          "runAfter": {
                            "Filter_array_Ip_from_list_of_security_rules": [
                              "Succeeded"
                            ]
                          },
                          "type": "Select",
                          "inputs": {
                            "from": "@body('Filter_array_Ip_from_list_of_security_rules')",
                            "select": {
                              "text": " @{item()?['@name']}, action :  @{item()?['action']}",
                              "type": "TextBlock",
                              "weight": "bolder"
                            }
                          },
                          "description": "prepare columns list to show the security policy rules in the adaptive card if IP address is present"
                        },
                        "Set_variable_adaptive_card_body": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "AdaptiveCardBody",
                            "value": [
                              {
                                "size": "Large",
                                "text": "Suspicious IP - Microsoft Sentinel",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "Possible Comprised IP @{items('For_each_malicious_IP')?['Address']} detected by the provider  :  @{outputs('Compose_product_name')}",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "text": " @{triggerBody()?['object']?['properties']?['severity']} Incident @{triggerBody()?['object']?['properties']?['title']} ",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": " Incident No : @{triggerBody()?['object']?['properties']?['incidentNumber']}  ",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "Incident description",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "@{triggerBody()?['object']?['properties']?['description']}",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "text": "[[[[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "size": "Medium",
                                "text": "Response in PAN-OS",
                                "type": "TextBlock",
                                "weight": "Bolder"
                              },
                              {
                                "size": "Small",
                                "style": "Person",
                                "type": "Image",
                                "url": "https://avatars2.githubusercontent.com/u/4855743?s=280&v=4"
                              }
                            ]
                          },
                          "description": "variable to hold adaptive card body"
                        },
                        "Set_variable_address_group_members": {
                          "runAfter": {
                            "List_address_groups": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "AddressGroupMembers",
                            "value": "@body('List_address_groups')?['result']?['entry']?[0]?['static']?['member']"
                          },
                          "description": "assign list of address group members"
                        }
                      },
                      "runAfter": {
                        "List_security_rules": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "Initialize_variable_IP_address_action": {
                      "runAfter": {
                        "Initialize_variable_address_group_members": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "IPAddressAction",
                            "type": "array"
                          }
                        ]
                      },
                      "description": "This holds the action taken on each IP "
                    },
                    "Initialize_variable_action_name": {
                      "runAfter": {
                        "Entities_-_Get_IPs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ActionName",
                            "type": "string"
                          }
                        ]
                      },
                      "description": "variable to store action name to be displayed on adaptive card"
                    },
                    "Initialize_variable_adaptive_card_body": {
                      "runAfter": {
                        "Initialize_variable_action_name": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "AdaptiveCardBody",
                            "type": "array"
                          }
                        ]
                      },
                      "description": "variable to store adaptive card body json"
                    },
                    "Initialize_variable_address_group_members": {
                      "runAfter": {
                        "Initialize_variable_adaptive_card_body": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "AddressGroupMembers",
                            "type": "array"
                          }
                        ]
                      },
                      "description": "variable to store the list of address group members"
                    },
                    "List_address_objects": {
                      "runAfter": {
                        "Compose_product_name": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/restapi/v10.0/Objects/Addresses",
                        "queries": {
                          "location": "vsys",
                          "vsys": "vsys1"
                        }
                      },
                      "description": "This gets complete list of address object present in the PAN-OS"
                    },
                    "List_security_rules": {
                      "runAfter": {
                        "List_address_objects": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/restapi/v10.0/Policies/SecurityRules",
                        "queries": {
                          "location": "vsys",
                          "vsys": "vsys1"
                        }
                      },
                      "description": "This gets complete list of security policy rules present in the PAN-OS"
                    },
                    "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response": {
                      "runAfter": {
                        "Set_variable_actions_on_IP_to_be_displayed_on_adaptive_card": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "body": {
                            "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n           \n            \"weight\": \"Bolder\",\n            \"text\": \"Below is the summary of actions taken on IP's by SOC\",\n            \"wrap\": true\n        },\n    {\n  \"columns\": [\n    {\n      \"items\":@{body('Set_variable_actions_on_IP_to_be_displayed_on_adaptive_card')} ,\n      \"type\": \"Column\",\n      \"wrap\": true\n    }\n  ],\n  \"separator\": \"true\",\n  \"type\": \"ColumnSet\",\n  \"width\": \"stretch\"\n},\n {\n    \"text\": \" Incident No : @{triggerBody()?['object']?['properties']?['incidentNumber']}  \",\n    \"type\": \"TextBlock\",\n    \"weight\": \"Bolder\",\n    \"wrap\": true\n  },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})\",\n            \"wrap\": true\n        },\n\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"size\": \"Medium\",\n                            \"weight\": \"Bolder\",\n                            \"text\": \"Incident configuration :\",\n                            \"wrap\": true\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"Image\",\n                            \"style\": \"Person\",\n                            \"url\": \"https://connectoricons-prod.azureedge.net/releases/v1.0.1391/1.0.1391.2130/azuresentinel/icon.png\",\n                            \"size\": \"Small\"\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Close Azure Sentinal incident?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Inaccurate Data\",\n                    \"value\": \"False Positive - Inaccurate Data\"\n                },\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Incorrect Alert Logic\",\n                    \"value\": \"False Positive - Incorrect Alert Logic\"\n                },\n                {\n                    \"title\": \"True Positive - Suspicious Activity\",\n                    \"value\": \"True Positive - Suspicious Activity\"\n                },\n                {\n                    \"title\": \"Benign Positive - Suspicious But Expected\",\n                    \"value\": \"Benign Positive - Suspicious But Expected\"\n                },\n                {\n                    \"title\": \"Undetermined\",\n                    \"value\": \"Undetermined\"\n                }\n            ],\n            \"id\": \"incidentStatus\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"Benign Positive - Suspicious But Expected\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Change Microsoft Sentinel Incident Severity?\"\n        },\n        {\n            \"choices\": [\n                {\n                  \n                    \"title\": \"High\",\n                    \"value\": \"High\"\n                },\n                {\n                    \"title\": \"Medium\",\n                    \"value\": \"Medium\"\n                },\n                {\n                    \"title\": \"Low\",\n                    \"value\": \"Low\"\n                },\n                {\n                    \"title\": \"Don't change\",\n                    \"value\": \"same\"\n                }\n            ],\n            \"id\": \"incidentSeverity\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"@{triggerBody()?['object']?['properties']?['severity']}\"\n        }\n       \n     \n        \n    ],\n\"width\":\"auto\",\n   \"actions\": [\n                    {\n                        \"type\": \"Action.Submit\",\n                        \"title\": \"Change incident configuration\"\n                    },\n{\n                        \"type\": \"Action.Submit\",\n                        \"title\": \"Ignore\"\n                    }\n   ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                            "recipient": {
                              "channelId": "[[parameters('Teams ChannelId')]"
                            },
                            "shouldUpdateCard": true
                          },
                          "notificationUrl": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['teams']['connectionId']"
                          }
                        },
                        "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                        "queries": {
                          "groupId": "[[parameters('Teams GroupId')]"
                        }
                      }
                    },
                    "Select_alert_product_names": {
                      "runAfter": {
                        "Initialize_variable_IP_address_action": [
                          "Succeeded"
                        ]
                      },
                      "type": "Select",
                      "inputs": {
                        "from": "@triggerBody()?['object']?['properties']?['additionalData']?['alertProductNames']",
                        "select": {
                          "text": "@item()"
                        }
                      },
                      "description": "data operator to select the alert product name"
                    },
                    "Set_variable_actions_on_IP_to_be_displayed_on_adaptive_card": {
                      "runAfter": {
                        "For_each_malicious_IP": [
                          "Succeeded"
                        ]
                      },
                      "type": "Select",
                      "inputs": {
                        "from": "@variables('IPAddressAction')",
                        "select": {
                          "text": "@item()",
                          "type": "TextBlock"
                        }
                      },
                      "description": "This is used to compose the list of actions taken by SOC on respective IP addresses"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "PaloAltoConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                        "connectionName": "[[variables('PaloAltoConnectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/PaloAltoConnector')]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('location'), '/managedApis/azuresentinel')]"
                      },
                      "teams": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]",
                        "connectionName": "[[variables('TeamsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('location'), '/managedApis/teams')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId5'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId5')]",
                "contentId": "[variables('_playbookContentId5')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "comments": "This playbook uses the PaloAlto connector to take necessary actions on IP address like Block IP/Unblock IP from predefined address group and also gives an option to close the incident.",
            "title": "PaloAlto-PAN-OS-BlockIP",
            "description": "This playbook allows blocking/unblocking IPs in PaloAlto, using **Address Object Groups**. This allows to make changes on predefined address group, which is attached to predefined security policy rule.",
            "mainSteps": [
              "When a new Sentinel incident is created, this playbook gets triggered and performs below actions: \n\n 1. An adaptive card is sent to the SOC channel providing Incident information, IP address, list of existing security policy rules in which IP is a member of and provides an option to Block/Unblock IP Address to predefined address group or Ignore. \n\n 2. The SOC can take action on risky IP based on the information provided in the adaptive card. \n\n ![PaloAlto-PAN-OS-BlockIP](./designerscreenshot.PNG) \n\n **This is the adaptive card SOC will receive when playbook is triggered for each risky IP for taking actions like block/unblock/ignore:** \n\n ![Adaptive Card example](./AdaptiveCardtoBlockorUnblock.PNG) \n\n **This is the consolidate adaptive card about the summary of actions taken on IP and the incident configuration:** \n\n ![Consolidated Adaptive Card example](./SummarizedAdaptiveCard.PNG)"
            ],
            "prerequisites": [
              "1. PaloAlto connector needs to be deployed prior to the deployment of this playbook under the same subscription. Relevant instructions can be found in the connector doc page. \n\n 2. Generate an API key. [Refer this link on how to generate the API Key](https://docs.paloaltonetworks.com/pan-os/10-1/pan-os-panorama-api/get-started-with-the-pan-os-xml-api/get-your-api-key) \n\n 3. Address group should be created for PAN-OS and this should be used while creating playbooks."
            ],
            "lastUpdateTime": "2022-07-22T00:00:00Z",
            "entities": [
              "Ip"
            ],
            "tags": [
              "Remediation",
              "Response from teams"
            ],
            "postDeployment": [
              "**a. Authorize connections** \n\n Once deployment is complete, you will need to authorize each connection. \n\n 1. Click the Microsoft Sentinel connection resource \n\n 2. Click edit API connection \n\n 3. Click Authorize \n\n 4. Sign in \n\n 5. Click Save \n\n 6. Repeat steps for other connection such as Teams connection and PAN-OS API connection (For authorizing the PAN-OS API connection, API Key needs to be provided) \n\n **b. Configurations in Sentinel** \n\n 1. In Microsoft sentinel analytical rules should be configured to trigger an incident with risky IP \n\n 2. Configure the automation rules to trigger this playbook"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "PaloAlto-PAN-OS-BlockIP",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('playbookTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "properties": {
        "description": "PaloAlto-PAN-OS-BlockURL playbook",
        "displayName": "PaloAlto-PAN-OS-BlockURL playbook"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('playbookTemplateSpecName6'),'/',variables('playbookVersion6'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Playbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('playbookTemplateSpecName6'))]"
      ],
      "properties": {
        "description": "PaloAlto-PAN-OS-BlockURL Playbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion6')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "PaloAlto-PAN-OS-BlockURL",
              "type": "String",
              "metadata": {
                "description": "Name of the Logic App/Playbook"
              }
            },
            "Teams GroupId": {
              "defaultValue": "TeamgroupId",
              "type": "String",
              "metadata": {
                "description": "GroupId of the Team channel"
              }
            },
            "Teams ChannelId": {
              "defaultValue": "TeamChannelId",
              "type": "String",
              "metadata": {
                "description": "Team ChannelId"
              }
            },
            "Address Group": {
              "defaultValue": "AddressGroup",
              "type": "String",
              "metadata": {
                "description": "Address Group"
              }
            }
          },
          "variables": {
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "TeamsConnectionName": "[[concat('teamsconnector-', parameters('PlaybookName'))]",
            "PaloAltoConnectorConnectionName": "[[concat('PaloAltoConnector-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/PaloAltoConnector')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('location'), '/managedApis/azuresentinel')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('location'), '/managedApis/teams')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('PaloAltoConnectorConnectionName')]",
              "location": "[[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('TeamsConnectionName')]",
              "location": "[[[variables('workspace-location-inline')]",
              "properties": {
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[[variables('workspace-location-inline')]",
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "When_Azure_Sentinel_incident_creation_rule_was_triggered_(Private_Preview_only)": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Compose_product_name": {
                      "runAfter": {
                        "Select_alert_product_names": [
                          "Succeeded"
                        ]
                      },
                      "type": "Compose",
                      "inputs": "@body('Select_alert_product_names')?[0]?['text']",
                      "description": "compose to select the incident alert product name"
                    },
                    "Condition_based_on_the_incident_configuration_from_adaptive_card": {
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p>PAN-OS Playbook ran and performed the following actions:<br>\n@{variables('URLAddressAction')}<br>\n<br>\n<br>\n<br>\nActions taken on Sentinel : Add comment to incident and closure with classification reason &nbsp;@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['data']?['incidentStatus']}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Update_incident": {
                          "runAfter": {
                            "Add_comment_to_incident_(V3)": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "classification": {
                                "ClassificationAndReason": "@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['data']?['incidentStatus']}"
                              },
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "severity": "@{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['data']?['incidentSeverity']}",
                              "status": "Closed"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "put",
                            "path": "/Incidents"
                          }
                        }
                      },
                      "runAfter": {
                        "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response')['submitActionId']",
                              "Change incident configuration"
                            ]
                          }
                        ]
                      },
                      "type": "If",
                      "description": "This decides the action taken on the summarized adaptive card"
                    },
                    "Entities_-_Get_URLs": {
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/url"
                      }
                    },
                    "For_each_malicious_URL": {
                      "foreach": "@body('Entities_-_Get_URLs')?['URLs']",
                      "actions": {
                        "Condition_based_on_user_inputs_from_the_adaptive_card": {
                          "actions": {
                            "Condition__to_check_if_user_chosen_Block": {
                              "actions": {
                                "Create_an_address_object": {
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "entry": [
                                        {
                                          "@@name": "@items('For_each_malicious_URL')?['Url']",
                                          "description": "@items('For_each_malicious_URL')?['Url']",
                                          "fqdn": "@items('For_each_malicious_URL')?['Url']"
                                        }
                                      ]
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/restapi/v10.0/Objects/Addresses",
                                    "queries": {
                                      "address type": "[variables('blanks')]",
                                      "location": "vsys",
                                      "name": "@items('For_each_malicious_URL')?['Url']",
                                      "vsys": "vsys1"
                                    }
                                  },
                                  "description": "This creates a new address object for the malicious URL"
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                      "Block URL ( add to @{outputs('Configured_address_group')} address group )"
                                    ]
                                  },
                                  {
                                    "equals": [
                                      "@length(body('Filter_array_of_URL_address_from_list_of_address_objects'))",
                                      0
                                    ]
                                  }
                                ]
                              },
                              "type": "If",
                              "description": "This check if user chooses Block URL"
                            },
                            "Condition_to_check_the_edit_an_address_object_group_status": {
                              "actions": {
                                "Condition_to_check_the_action_of_adaptive_card_to_set_the_action_summary": {
                                  "actions": {
                                    "Append_success_status_Blocked_URL_status_to_summary_card": {
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "URLAddressAction",
                                        "value": "URL Address : @{items('For_each_malicious_URL')?['Url']} ,  Action Taken :  Blocked  by               \n                       adding to @{outputs('Configured_address_group')}  ,  Status  :  Success"
                                      },
                                      "description": "append action taken to summarize on the adaptive card"
                                    }
                                  },
                                  "else": {
                                    "actions": {
                                      "Append_success_status_UnBlocked_URL_status_to_summary_card": {
                                        "type": "AppendToArrayVariable",
                                        "inputs": {
                                          "name": "URLAddressAction",
                                          "value": "URL Address : @{items('For_each_malicious_URL')?['Url']} ,  Action Taken :  UnBlocked  by               \n                       adding to @{outputs('Configured_address_group')}  ,  Status  :  Success"
                                        },
                                        "description": "append action taken to summarize on the adaptive card"
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "equals": [
                                          "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                          "Block URL ( add to @{outputs('Configured_address_group')} address group )"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                }
                              },
                              "runAfter": {
                                "Update_an_address_object_group": [
                                  "Succeeded"
                                ]
                              },
                              "else": {
                                "actions": {
                                  "Append_failure_status_to_summary_card": {
                                    "type": "AppendToArrayVariable",
                                    "inputs": {
                                      "name": "URLAddressAction",
                                      "value": "URL Address : @{items('For_each_malicious_URL')?['Url']}  ,  Action Taken :  @{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']} ,  Status :  Failure"
                                    },
                                    "description": "append action taken to summarize on the adaptive card"
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "equals": [
                                      "@body('Update_an_address_object_group')?['@status']",
                                      "success"
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            },
                            "Update_an_address_object_group": {
                              "runAfter": {
                                "Condition__to_check_if_user_chosen_Block": [
                                  "Succeeded"
                                ]
                              },
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "entry": {
                                    "@@name": "[[parameters('Address Group')]",
                                    "static": {
                                      "member": "@{variables('AddressGroupMembers')}"
                                    }
                                  }
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                                  }
                                },
                                "method": "put",
                                "path": "/restapi/v10.0/Objects/AddressGroups",
                                "queries": {
                                  "location": "vsys",
                                  "name": "[[parameters('Address Group')]",
                                  "vsys": "vsys1"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Append_to_array_variable_URL_address_action_chosen": {
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "URLAddressAction",
                                  "value": "URL Address : @{items('For_each_malicious_URL')?['Url']},  Action Taken :  @{body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']} ,  Status :  Success                                               "
                                },
                                "description": "This appends the action taken on URL to the list of existing actions"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "equals": [
                                    "@body('Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3')['submitActionId']",
                                    "Ignore"
                                  ]
                                }
                              }
                            ]
                          },
                          "type": "If",
                          "description": "condition to check the submit action is block / unblock or Ignore"
                        },
                        "Condition_to_check_if_URL_address_already_present_in_list_of_address_objects": {
                          "actions": {
                            "Condition_to_check_if_URL_already_present_in_predefined_address_group": {
                              "actions": {
                                "Append_address_group_text": {
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "AdaptiveCardBody",
                                    "value": {
                                      "text": "The URL @{items('For_each_malicious_URL')?['Url']}  is already a member of the blocked address group @{outputs('Configured_address_group')}",
                                      "type": "TextBlock",
                                      "wrap": true
                                    }
                                  },
                                  "description": "append address group text to adaptive card dynamically"
                                },
                                "Filter_array_URL_address_from_the_list_of_address_objects_to_unreference": {
                                  "runAfter": {
                                    "Set_dynamic_action_name": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Query",
                                  "inputs": {
                                    "from": "@variables('AddressGroupMembers')",
                                    "where": "@not(equals(item(), items('For_each_malicious_URL')?['Url']))"
                                  },
                                  "description": "This filters the URL address from predefined address group to unreference/unblock URL"
                                },
                                "Set_dynamic_action_name": {
                                  "runAfter": {
                                    "Append_address_group_text": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "ActionName",
                                    "value": "UnBlock URL"
                                  },
                                  "description": "variable to set action name dynamically"
                                },
                                "unreference_URL_address_from_the_existing_group_members": {
                                  "runAfter": {
                                    "Filter_array_URL_address_from_the_list_of_address_objects_to_unreference": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "AddressGroupMembers",
                                    "value": "@body('Filter_array_URL_address_from_the_list_of_address_objects_to_unreference')"
                                  },
                                  "description": "unreference URL address from the group members and update"
                                }
                              },
                              "else": {
                                "actions": {
                                  "Append_URL_address_to_the_address_group_members": {
                                    "runAfter": {
                                      "Append_address_group_text_to_adaptive_card_body": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "AppendToArrayVariable",
                                    "inputs": {
                                      "name": "AddressGroupMembers",
                                      "value": "@items('For_each_malicious_URL')?['Url']"
                                    },
                                    "description": "append URL address to the address group members"
                                  },
                                  "Append_address_group_text_to_adaptive_card_body": {
                                    "type": "AppendToArrayVariable",
                                    "inputs": {
                                      "name": "AdaptiveCardBody",
                                      "value": {
                                        "text": "The URL @{items('For_each_malicious_URL')?['Url']}  is not a member of the blocked address group @{outputs('Configured_address_group')}",
                                        "type": "TextBlock",
                                        "wrap": true
                                      }
                                    },
                                    "description": "append address group text to adaptive card dynamically"
                                  },
                                  "Set_dynamic_action_name_to_variable_Action_name": {
                                    "runAfter": {
                                      "Append_URL_address_to_the_address_group_members": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "SetVariable",
                                    "inputs": {
                                      "name": "ActionName",
                                      "value": "Block URL"
                                    },
                                    "description": "set action name dynamically"
                                  }
                                }
                              },
                              "expression": {
                                "and": [
                                  {
                                    "contains": [
                                      "@variables('AddressGroupMembers')",
                                      "@items('For_each_malicious_URL')?['Url']"
                                    ]
                                  }
                                ]
                              },
                              "type": "If",
                              "description": "condition to check the malicious URL address is present in the predefined address group and the URL is part of static member"
                            }
                          },
                          "runAfter": {
                            "Condition_to_check_if_the_URL_is_a_part_of_security_policy_rules": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Append_URL_to_array_of_address_group_members": {
                                "runAfter": {
                                  "Append_to_array_variable_text_if_URL_is_not_a_member_of_blocked_address_group": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "AddressGroupMembers",
                                  "value": "@items('For_each_malicious_URL')?['Url']"
                                },
                                "description": "append the Malicious URL address to the existing group members to block / unblock from the predefined address group"
                              },
                              "Append_to_array_variable_text_if_URL_is_not_a_member_of_blocked_address_group": {
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "AdaptiveCardBody",
                                  "value": {
                                    "text": "The URL @{items('For_each_malicious_URL')?['Url']}  is not a member of the blocked address group @{outputs('Configured_address_group')}",
                                    "type": "TextBlock",
                                    "wrap": true
                                  }
                                },
                                "description": "This appends the text to display If URL is not a member of security policy rules"
                              },
                              "Set_variable_to_Block_URL": {
                                "runAfter": {
                                  "Append_URL_to_array_of_address_group_members": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "SetVariable",
                                "inputs": {
                                  "name": "ActionName",
                                  "value": "Block URL"
                                },
                                "description": "This sets the variable block URL"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Filter_array_of_URL_address_from_list_of_address_objects'))",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If",
                          "description": "This checks if URL is a member of any of the list of address objects"
                        },
                        "Condition_to_check_if_the_URL_is_a_part_of_security_policy_rules": {
                          "actions": {
                            "Append_policy_text": {
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "AdaptiveCardBody",
                                "value": {
                                  "text": "It is also member of the following security policy rules",
                                  "type": "TextBlock"
                                }
                              },
                              "description": "dynamic policy text based on security policies"
                            },
                            "Append_security_policies": {
                              "runAfter": {
                                "Append_policy_text": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "AdaptiveCardBody",
                                "value": {
                                  "columns": [
                                    {
                                      "items": "@body('Select_security_policy_rules')",
                                      "type": "Column"
                                    }
                                  ],
                                  "type": "ColumnSet"
                                }
                              },
                              "description": "append security policies which the URL address is exist"
                            }
                          },
                          "runAfter": {
                            "Select_security_policy_rules": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Append_policy_text_to_adaptive_card_body_variable": {
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "AdaptiveCardBody",
                                  "value": {
                                    "text": "It is not a member of any other Policy Rules",
                                    "type": "TextBlock"
                                  }
                                },
                                "description": "dynamic policy text based on security policies"
                              },
                              "Append_security_policies_to_adaptive_card_body_variable": {
                                "runAfter": {
                                  "Append_policy_text_to_adaptive_card_body_variable": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "AppendToArrayVariable",
                                "inputs": {
                                  "name": "AdaptiveCardBody"
                                },
                                "description": "append security policies which the URL address is exist"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Select_security_policy_rules'))",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If",
                          "description": "condition to check if the URL address is present in the existing security policy rules to conditionally apply the policy text and security policy rules"
                        },
                        "Configured_address_group": {
                          "runAfter": {
                            "Set_variable_address_group_members": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose",
                          "inputs": "@body('List_address_groups')?['result']?['entry']?[0]?['@name']",
                          "description": "compose predefined address group"
                        },
                        "Filter_array_URL_from_list_of_security_rules": {
                          "runAfter": {
                            "Configured_address_group": [
                              "Succeeded"
                            ]
                          },
                          "type": "Query",
                          "inputs": {
                            "from": "@body('List_security_rules')?['result']?['entry']",
                            "where": "@contains(item()?['destination']?['member'], items('For_each_malicious_URL')?['Url'])"
                          },
                          "description": "This filters all the security rules in which this URL is a member"
                        },
                        "Filter_array_of_URL_address_from_list_of_address_objects": {
                          "runAfter": {
                            "Set_variable_adaptive_card_body": [
                              "Succeeded"
                            ]
                          },
                          "type": "Query",
                          "inputs": {
                            "from": "@body('List_address_objects')?['result']?['entry']",
                            "where": "@equals(item()?['fqdn'], items('For_each_malicious_URL')?['Url'])"
                          },
                          "description": "This filters the list of address objects in which this URL is a member "
                        },
                        "List_address_groups": {
                          "runAfter": {
                            "Filter_array_of_URL_address_from_list_of_address_objects": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                              }
                            },
                            "method": "get",
                            "path": "/restapi/v10.0/Objects/AddressGroups",
                            "queries": {
                              "location": "vsys",
                              "name": "[[parameters('Address Group')]",
                              "vsys": "vsys1"
                            }
                          },
                          "description": "This gets complete list of address object groups present in the PAN-OS"
                        },
                        "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response_3": {
                          "runAfter": {
                            "Condition_to_check_if_URL_address_already_present_in_list_of_address_objects": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnectionWebhook",
                          "inputs": {
                            "body": {
                              "body": {
                                "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\":@{variables('AdaptiveCardBody')} ,\n     \"actions\": [\n  {\n    \"title\": \"@{variables('ActionName')} ( add to @{outputs('Configured_address_group')} address group )\",\n    \"type\": \"Action.Submit\"\n  },\n  {\n    \"title\": \"Ignore\",\n    \"type\": \"Action.Submit\"\n  }\n],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                                "recipient": {
                                  "channelId": "[[parameters('Teams ChannelId')]"
                                },
                                "shouldUpdateCard": true
                              },
                              "notificationUrl": "@{listCallbackUrl()}"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['teams']['connectionId']"
                              }
                            },
                            "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                            "queries": {
                              "groupId": "[[parameters('Teams GroupId')]"
                            }
                          }
                        },
                        "Select_security_policy_rules": {
                          "runAfter": {
                            "Filter_array_URL_from_list_of_security_rules": [
                              "Succeeded"
                            ]
                          },
                          "type": "Select",
                          "inputs": {
                            "from": "@body('Filter_array_URL_from_list_of_security_rules')",
                            "select": {
                              "text": " @{item()?['@name']}, action :  @{item()?['action']}",
                              "type": "TextBlock",
                              "weight": "bolder"
                            }
                          },
                          "description": "prepare columns list to show the security policy rules in the adaptive card if URL address is present"
                        },
                        "Set_variable_adaptive_card_body": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "AdaptiveCardBody",
                            "value": [
                              {
                                "size": "Large",
                                "text": "Suspicious URL - Microsoft Sentinel",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "Possible Comprised URL @{items('For_each_malicious_URL')?['Url']} detected by the provider : @{outputs('Compose_product_name')}",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "text": "@{triggerBody()?['object']?['properties']?['severity']}  Incident  @{triggerBody()?['object']?['properties']?['title']}",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": " Incident No : @{triggerBody()?['object']?['properties']?['incidentNumber']}  ",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "Incident description",
                                "type": "TextBlock",
                                "weight": "Bolder",
                                "wrap": true
                              },
                              {
                                "text": "@{triggerBody()?['object']?['properties']?['description']}",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "text": "[[[[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})",
                                "type": "TextBlock",
                                "wrap": true
                              },
                              {
                                "size": "Medium",
                                "text": "Response in PAN-OS",
                                "type": "TextBlock",
                                "weight": "Bolder"
                              },
                              {
                                "size": "Small",
                                "style": "Person",
                                "type": "Image",
                                "url": "https://avatars2.githubusercontent.com/u/4855743?s=280&v=4"
                              }
                            ]
                          },
                          "description": "variable to hold adaptive card body"
                        },
                        "Set_variable_address_group_members": {
                          "runAfter": {
                            "List_address_groups": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "AddressGroupMembers",
                            "value": "@body('List_address_groups')?['result']?['entry']?[0]?['static']?['member']"
                          },
                          "description": "assign list of address group members"
                        }
                      },
                      "runAfter": {
                        "List_security_rules": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "Initialize_variable_URL_address_action": {
                      "runAfter": {
                        "Initialize_variable_address_group_members": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "URLAddressAction",
                            "type": "array"
                          }
                        ]
                      },
                      "description": "This holds the action taken on each URL "
                    },
                    "Initialize_variable_action_name": {
                      "runAfter": {
                        "Entities_-_Get_URLs": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ActionName",
                            "type": "string"
                          }
                        ]
                      },
                      "description": "variable to store action name to be displayed on adaptive card"
                    },
                    "Initialize_variable_adaptive_card_body": {
                      "runAfter": {
                        "Initialize_variable_action_name": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "AdaptiveCardBody",
                            "type": "array"
                          }
                        ]
                      },
                      "description": "variable to store adaptive card body json"
                    },
                    "Initialize_variable_address_group_members": {
                      "runAfter": {
                        "Initialize_variable_adaptive_card_body": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "AddressGroupMembers",
                            "type": "array"
                          }
                        ]
                      },
                      "description": "variable to store the list of address group members"
                    },
                    "List_address_objects": {
                      "runAfter": {
                        "Compose_product_name": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/restapi/v10.0/Objects/Addresses",
                        "queries": {
                          "location": "vsys",
                          "vsys": "vsys1"
                        }
                      },
                      "description": "This gets complete list of address object present in the PAN-OS"
                    },
                    "List_security_rules": {
                      "runAfter": {
                        "List_address_objects": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['PaloAltoConnector']['connectionId']"
                          }
                        },
                        "method": "get",
                        "path": "/restapi/v10.0/Policies/SecurityRules",
                        "queries": {
                          "location": "vsys",
                          "vsys": "vsys1"
                        }
                      },
                      "description": "This gets complete list of security policy rules present in the PAN-OS"
                    },
                    "Post_an_Adaptive_Card_to_a_Teams_channel_and_wait_for_a_response": {
                      "runAfter": {
                        "Set_variable_actions_on_URL_to_be_displayed_on_adaptive_card": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "body": {
                            "messageBody": "{\n    \"type\": \"AdaptiveCard\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n           \n            \"weight\": \"Bolder\",\n            \"text\": \"Below is the summary of actions taken on URL's by SOC\",\n            \"wrap\": true\n        },\n    {\n  \"columns\": [\n    {\n      \"items\":@{body('Set_variable_actions_on_URL_to_be_displayed_on_adaptive_card')} ,\n      \"type\": \"Column\",\n      \"wrap\": true\n    }\n  ],\n  \"separator\": \"true\",\n  \"type\": \"ColumnSet\",\n  \"width\": \"stretch\"\n},\n {\n    \"text\": \" Incident No : @{triggerBody()?['object']?['properties']?['incidentNumber']}  \",\n    \"type\": \"TextBlock\",\n    \"weight\": \"Bolder\",\n    \"wrap\": true\n  },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"[Click here to view the Incident](@{triggerBody()?['object']?['properties']?['incidentUrl']})\",\n            \"wrap\": true\n        },\n\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"size\": \"Medium\",\n                            \"weight\": \"Bolder\",\n                            \"text\": \"Incident configuration :\",\n                            \"wrap\": true\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"Image\",\n                            \"style\": \"Person\",\n                            \"url\": \"https://connectoricons-prod.azureedge.net/releases/v1.0.1391/1.0.1391.2130/azuresentinel/icon.png\",\n                            \"size\": \"Small\"\n                        }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Close Azure Sentinal incident?\"\n        },\n        {\n            \"choices\": [\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Inaccurate Data\",\n                    \"value\": \"False Positive - Inaccurate Data\"\n                },\n                {\n                    \"isSelected\": true,\n                    \"title\": \"False Positive - Incorrect Alert Logic\",\n                    \"value\": \"False Positive - Incorrect Alert Logic\"\n                },\n                {\n                    \"title\": \"True Positive - Suspicious Activity\",\n                    \"value\": \"True Positive - Suspicious Activity\"\n                },\n                {\n                    \"title\": \"Benign Positive - Suspicious But Expected\",\n                    \"value\": \"Benign Positive - Suspicious But Expected\"\n                },\n                {\n                    \"title\": \"Undetermined\",\n                    \"value\": \"Undetermined\"\n                }\n            ],\n            \"id\": \"incidentStatus\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"Benign Positive - Suspicious But Expected\"\n        },\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"Change Microsoft Sentinel Incident Severity?\"\n        },\n        {\n            \"choices\": [\n                {\n                  \n                    \"title\": \"High\",\n                    \"value\": \"High\"\n                },\n                {\n                    \"title\": \"Medium\",\n                    \"value\": \"Medium\"\n                },\n                {\n                    \"title\": \"Low\",\n                    \"value\": \"Low\"\n                },\n                {\n                    \"title\": \"Don't change\",\n                    \"value\": \"same\"\n                }\n            ],\n            \"id\": \"incidentSeverity\",\n            \"style\": \"compact\",\n            \"type\": \"Input.ChoiceSet\",\n            \"value\": \"@{triggerBody()?['object']?['properties']?['severity']}\"\n        }\n       \n     \n        \n    ],\n\"width\":\"auto\",\n   \"actions\": [\n                    {\n                        \"type\": \"Action.Submit\",\n                        \"title\": \"Change incident configuration\"\n                    },\n  {\n                        \"type\": \"Action.Submit\",\n                        \"title\": \"Ignore\"\n                    }\n   ],\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"version\": \"1.2\"\n}",
                            "recipient": {
                              "channelId": "[[parameters('Teams ChannelId')]"
                            },
                            "shouldUpdateCard": true
                          },
                          "notificationUrl": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['teams']['connectionId']"
                          }
                        },
                        "path": "/flowbot/actions/flowcontinuation/recipienttypes/channel/$subscriptions",
                        "queries": {
                          "groupId": "[[parameters('Teams GroupId')]"
                        }
                      }
                    },
                    "Select_alert_product_names": {
                      "runAfter": {
                        "Initialize_variable_URL_address_action": [
                          "Succeeded"
                        ]
                      },
                      "type": "Select",
                      "inputs": {
                        "from": "@triggerBody()?['object']?['properties']?['additionalData']?['alertProductNames']",
                        "select": {
                          "text": "@item()"
                        }
                      },
                      "description": "data operator to select the alert product name"
                    },
                    "Set_variable_actions_on_URL_to_be_displayed_on_adaptive_card": {
                      "runAfter": {
                        "For_each_malicious_URL": [
                          "Succeeded"
                        ]
                      },
                      "type": "Select",
                      "inputs": {
                        "from": "@variables('URLAddressAction')",
                        "select": {
                          "text": "@item()",
                          "type": "TextBlock"
                        }
                      },
                      "description": "This is used to compose the list of actions taken by SOC on respective URL addresses"
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "PaloAltoConnector": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('PaloAltoConnectorConnectionName'))]",
                        "connectionName": "[[variables('PaloAltoConnectorConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/customApis/PaloAltoConnector')]"
                      },
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('location'), '/managedApis/azuresentinel')]"
                      },
                      "teams": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('TeamsConnectionName'))]",
                        "connectionName": "[[variables('TeamsConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('location'), '/managedApis/teams')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId6'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId6')]",
                "contentId": "[variables('_playbookContentId6')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "PaloAlto-PAN-OS",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ],
          "metadata": {
            "comments": "This playbook uses the PaloAlto connector to take necessary actions on URL address like Block URL/Unblock URL from predefined address group and also gives an option to close the incident.",
            "title": "PaloAlto-PAN-OS-BlockURL",
            "description": "This playbook allows blocking/unblocking URLs in PaloAlto, using **predefined address group**. This allows to make changes on predefined address group, which is attached to security policy rule.",
            "prerequisites": [
              "1. PaloAlto connector needs to be deployed prior to the deployment of this playbook under the same subscription. Relevant instructions can be found in the connector doc page. \n\n 2. Generate an API key.[Refer this link on how to generate the API Key](https://paloaltolactest.trafficmanager.net/restapi-doc/#tag/key-generation) \n\n 3. Address group should be created for PAN-OS and this should be used while creating playbooks."
            ],
            "mainSteps": [
              "When a new Sentinel incident is created, this playbook gets triggered and performs below actions: \n\n 1. An adaptive card is sent to the SOC channel providing Incident information, URL address, list of existing security policy rules in which URL is a member of and provides an option to Block/Unblock URL Address by adding/removing it to/from the predefined address group. \n\n 2. The SOC can act on risky URL based on the information provided in the adaptive card, or ignore. \n\n ![PaloAlto-PAN-OS-BlockURL](./designerScreenshot.PNG) \n\n **This is the adaptive card SOC will receive when playbook is triggered for each risky URL for taking actions like block/unblock/ignore ::** \n\n ![Adaptive Card example](./AdaptiveCardtoBlockorUnblock.PNG) \n\n **This is the consolidate adaptive card about the summary of actions taken on URL and the incident configuration ::** \n\n ![Consolidated Adaptive Card example](./SummarizedAdaptiveCard.PNG)"
            ],
            "lastUpdateTime": "2022-07-22T00:00:00Z",
            "entities": [
              "Url"
            ],
            "tags": [
              "Remediation",
              "Response from teams"
            ],
            "postDeployment": [
              "**a. Authorize connections** \n\n Once deployment is complete, you will need to authorize each connection. \n\n 1. Click the Microsoft Sentinel connection resource \n\n 2. Click edit API connection \n\n 3. Click Authorize \n\n 4. Sign in \n\n 5. Click Save \n\n 6. Repeat steps for other connection such as Teams connection and PAN-OS API connection (For authorizing the PAN-OS API connection, API Key needs to be provided) \n\n **b. Configurations in Sentinel** \n\n 1. In Microsoft sentinel analytical rules should be configured to trigger an incident with risky URL \n\n 2. Configure the automation rules to trigger this playbook"
            ],
            "releaseNotes": [
              {
                "version": "1.0.0",
                "title": "PaloAlto-PAN-OS-BlockURL",
                "notes": [
                  "Initial version"
                ]
              }
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "2.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "2.0.0",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "PaloAlto-PAN-OS",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "LogicAppsCustomConnector",
              "contentId": "[variables('_PaloAltoCustomConnector')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_PaloAlto-PAN-OS-GetSystemInfo')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_PaloAlto-PAN-OS-GetThreatPCAP')]",
              "version": "[variables('playbookVersion3')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_PaloAlto-PAN-OS-GetURLCategoryInfo')]",
              "version": "[variables('playbookVersion4')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_PaloAlto-PAN-OS-BlockIP')]",
              "version": "[variables('playbookVersion5')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_PaloAlto-PAN-OS-BlockURL')]",
              "version": "[variables('playbookVersion6')]"
            }
          ]
        },
        "firstPublishDate": "2021-08-09",
        "lastPublishDate": "2021-09-20",
        "providers": [
          "Palo Alto Networks"
        ],
        "categories": {
          "domains": [
            "Security – Automation (SOAR)",
            "Security – Network"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
