{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "isWizard": false,
      "basics": {
        "description": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/cisco-logo-72px.svg\" width=\"75px\" height=\"75px\">\n\n**Important:** _This Azure Sentinel Solution is currently in public preview. This feature is provided without a service level agreement, and it's not recommended for production workloads. Certain features might not be supported or might have constrained capabilities. For more information, see [Supplemental Terms of Use for Microsoft Azure Previews](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)._\n\n**Note:** _There may be [known issues](https://aka.ms/sentinelsolutionsknownissues) pertaining to this Solution, please refer to them before installing._\n\nThe [Cisco ASA](https://www.cisco.com/c/en/us/products/security/adaptive-security-appliance-asa-software/index.html) Family of security devices protects corporate networks and data centers of all sizes. It provides users with highly secure access to data and network resources - anytime, anywhere, using any device.\n\nAzure Sentinel Solutions provide a consolidated way to acquire Azure Sentinel content like data connectors, workbooks, analytics, and automations in your workspace with a single deployment step.\n\n**Custom Azure Logic Apps Connectors:** 1, **Playbooks:** 3\n\n[Learn more about Azure Sentinel](https://aka.ms/azuresentinel) | [Learn more about Solutions](https://aka.ms/azuresentinelsolutionsdoc)",
        "subscription": {
          "resourceProviders": [
            "Microsoft.OperationsManagement/solutions",
            "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "Microsoft.Insights/workbooks",
            "Microsoft.Logic/workflows"
          ]
        },
        "location": {
          "metadata": {
            "hidden": "Hiding location, we get it from the log analytics workspace"
          },
          "visible": false
        },
        "resourceGroup": {
          "allowExisting": true
        }
      }
    },
    "basics": [
      {
        "name": "getLAWorkspace",
        "type": "Microsoft.Solutions.ArmApiControl",
        "toolTip": "This filters by workspaces that exist in the Resource Group selected",
        "condition": "[greater(length(resourceGroup().name),0)]",
        "request": {
          "method": "GET",
          "path": "[concat(subscription().id,'/providers/Microsoft.OperationalInsights/workspaces?api-version=2020-08-01')]"
        }
      },
      {
        "name": "workspace",
        "type": "Microsoft.Common.DropDown",
        "label": "Workspace",
        "placeholder": "Select a workspace",
        "toolTip": "This dropdown will list only workspace that exists in the Resource Group selected",
        "constraints": {
          "allowedValues": "[map(filter(basics('getLAWorkspace').value, (filter) => contains(filter.id, toLower(resourceGroup().name))), (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
          "required": true
        },
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "playbooks",
        "label": "Playbooks",
        "subLabel": {
          "preValidation": "Configure the playbooks",
          "postValidation": "Done"
        },
        "bladeTitle": "Playbooks",
        "elements": [
          {
            "name": "playbooks-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This solution installs playbook resources.  A security playbook is a collection of procedures that can be run from Azure Sentinel in response to an alert. A security playbook can help automate and orchestrate your response, and can be run manually or set to run automatically when specific alerts are triggered. Security playbooks in Azure Sentinel are based on Azure Logic Apps, which means that you get all the power, customizability, and built-in templates of Logic Apps. Each playbook is created for the specific subscription you choose, but when you look at the Playbooks page, you will see all the playbooks across any selected subscriptions.",
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/tutorial-respond-threats-playbook?WT.mc_id=Portal-Microsoft_Azure_CreateUIDef"
              }
            }
          },
          {
            "name": "customconnector",
            "type": "Microsoft.Common.Section",
            "label": "CiscoASAConnector",
            "elements": [
              {
                "name": "customconnector-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This playbook ingests events from CiscoASA into Log Analytics using the API."
                }
              },
              {
                "name": "customconnector-name",
                "type": "Microsoft.Common.TextBox",
                "label": "Custom Connector Name",
                "defaultValue": "CiscoASAConnector",
                "toolTip": "Name of the Azure Firewall Connector",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Name of the Azure Firewall Connector"
                }
              },
              {
                "name": "customconnector-serviceendpoint",
                "type": "Microsoft.Common.TextBox",
                "label": "Service Endpoint",
                "defaultValue": "",
                "toolTip": "URL of the Cisco ASA REST API",
                "constraints": {
                  "required": true,
                  "regex": "[\\w\\W]{1,256}$",
                  "validationMessage": "Please enter the Service Endpoint URL"
                }
              }
            ]
          },
          {
            "name": "playbook1",
            "type": "Microsoft.Common.Section",
            "label": "CiscoASA-AddIPtoNetworkObjectGroup",
            "elements": [
              {
                "name": "playbook1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This playbook allows blocking/allowing of IPs in Cisco ASA, using a Network Object Group. This allows making changes to a Network Object Group members, instead of making Access Control Entries. The Network Object Group itself should be part of an Access Control Entry."
                }
              },
              {
                "name": "playbook1-Playbook_Name",
                "type": "Microsoft.Common.TextBox",
                "label": "Playbook Name",
                "defaultValue": "CiscoASA-AddIPtoNetworkObjectGroup",
                "toolTip": "Please enter Playbook Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Playbook Name"
                }
              },
              {
                "name": "playbook1-Network_Object_Group_object_ID",
                "type": "Microsoft.Common.TextBox",
                "label": "Network Object Group object ID",
                "defaultValue": "",
                "toolTip": "Please enter Network Object Group object ID",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Network Object Group object ID"
                }
              }
            ]
          },
          {
            "name": "playbook2",
            "type": "Microsoft.Common.Section",
            "label": "CiscoASA-CreateACEInACL",
            "elements": [
              {
                "name": "playbook2-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This playbook allows blocking/unblocking of IPs in Cisco ASA, using Access Control Entries which will be created in an access control list."
                }
              },
              {
                "name": "playbook2-Playbook_Name",
                "type": "Microsoft.Common.TextBox",
                "label": "Playbook Name",
                "defaultValue": "CiscoASA-CreateACEInACL",
                "toolTip": "Please enter Playbook Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Playbook Name"
                }
              },
              {
                "name": "playbook2-ACL_Name",
                "type": "Microsoft.Common.TextBox",
                "label": "ACL Name",
                "defaultValue": "",
                "toolTip": "Please enter ACL Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the ACL Name"
                }
              }
            ]
          },
          {
            "name": "playbook3",
            "type": "Microsoft.Common.Section",
            "label": "CiscoASA-CreateInboundAccessRuleOnInterface",
            "elements": [
              {
                "name": "playbook3-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This playbook allows blocking/unblocking of IPs in Cisco ASA, using Access Rules which will be created on an interface."
                }
              },
              {
                "name": "playbook3-Playbook_Name",
                "type": "Microsoft.Common.TextBox",
                "label": "Playbook Name",
                "defaultValue": "CiscoASA-CreateInboundAccessRuleOnInterface",
                "toolTip": "Please enter Playbook Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Playbook Name"
                }
              },
              {
                "name": "playbook3-Interface_ID",
                "type": "Microsoft.Common.TextBox",
                "label": "Interface ID",
                "defaultValue": "",
                "toolTip": "Please enter Interface ID",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Interface ID"
                }
              }
            ]
          }
        ]
      }
    ],
    "outputs": {
	  "workspace-location": "[resourceGroup().location]",
      "location": "[location()]",
      "workspace": "[basics('workspace')]",
      "Custom Connector name": "[steps('playbooks').customconnector.customconnector-name]",
      "Service Endpoint": "[steps('playbooks').customconnector.customconnector-serviceendpoint]",
      "playbook1-Playbook Name": "[steps('playbooks').playbook1.playbook1-Playbook_Name]",
      "playbook1-Network Object Group object ID": "[steps('playbooks').playbook1.playbook1-Network_Object_Group_object_ID]",
      "playbook2-Playbook Name": "[steps('playbooks').playbook2.playbook2-Playbook_Name]",
      "playbook2-ACL Name": "[steps('playbooks').playbook2.playbook2-ACL_Name]",
      "playbook3-Playbook Name": "[steps('playbooks').playbook3.playbook3-Playbook_Name]",
      "playbook3-Interface ID": "[steps('playbooks').playbook3.playbook3-Interface_ID]"
    }
  }
}
