id: 2e629769-60eb-4a14-8bfc-bde9be66ebeb
name: Darktrace System Status
description: |
  'This rule creates Microsoft Sentinel Alerts based on Darktrace system status alerts for health monitoring, fetched every 5 minutes.'
severity: Informational
requiredDataConnectors:
  - connectorId: DarktraceRESTConnector
    dataTypes:
      - darktrace_model_alerts_CL
queryFrequency: 5m
queryPeriod: 5m 
triggerOperator: gt
triggerThreshold: 0
tactics: # none
relevantTechniques: # none
query: |
  darktrace_model_alerts_CL
  | where dtProduct_s =="System Alert"
  | extend EventVendor = "Darktrace"
  | extend EventProduct = "Darktrace DETECT"
  | project-rename ThreatCategory=dtProduct_s
  | project-rename EventStartTime=time_s
  | project-rename NetworkRuleName=friendlyName_s
  | project-rename SrcIpAddr=deviceIP_s
  | project-rename SrcHostname=hostname_s
  | project-rename ThreatRiskLevel=priority_code_d
  | project-rename ThreatRiskCategory=priority_s
  | project-rename DtSeverity=Severity
  | project-rename DtName=name_s
  | project-rename DtStatus=status_s
  | project-rename DtMessage=Message
  | project-rename DtURL=url_s
  | project-rename DtUUID=uuid_g
eventGroupingSettings:
  aggregationKind: AlertPerResult
entityMappings:
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: SrcHostname
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: SrcIPAddr
customDetails:
  EventStartTime: EventStartTime
  NetworkRuleName: NetworkRuleName
  ThreatRiskLevel: ThreatRiskLevel
  ThreatRiskCategory: ThreatRiskCategory
  DtSeverity: DtSeverity
  DtName: DtName
  DtStatus: DtStatus
  DtMessage: DtMessage
  DtURL: DtURL
  SrcIpAddr: SrcIpAddr
  SrcHostname: SrcHostname
alertDetailsOverride:
  alertDisplayNameFormat: 'Darktrace: {{{NetworkRuleName}}'
  alertDescriptionFormat: '{{DtMessage}}''
  alertTacticsColumnName: # none
  alertSeverityColumnName: # none 
version: 1.1.0
kind: scheduled
