id: 05f5cccd-ee93-4293-b7ad-05820aaa54a4
name: Kali Linux UserAgent Detected (ASIM Web Session)
description: |
  'This rule helps to detect usage of Kali Linux in your environment'
tags:
  - Schema: WebSession
    SchemaVersion: 0.2.6
requiredDataConnectors: []
tactics:
  - Exfiltration
relevantTechniques:
  - T1048.003
query: |
  let lookback = 1d;
  _Im_WebSession (starttime=ago(lookback))
  | project HttpUserAgent, SrcIpAddr, SrcUsername, SrcHostname, Url, TimeGenerated
  | where HttpUserAgent matches regex "(?i).*Linux.*Kali.*|.*Kali.*Linux.*"
  | summarize EventCount=count(), EventStartTime=min(TimeGenerated), EventEndTime = max(TimeGenerated), URLs = make_set(Url,100) by HttpUserAgent, SrcIpAddr, SrcUsername, SrcHostname
  | extend Address_0_SrcIpAddr = SrcIpAddr,
  | extend Account_0_Name = SrcUsername,
  | extend Host_0_HostName = SrcHostname
entityMappings:
  - entityType: URL
    fieldMappings:
      - identifier: Url
        columnName: Url
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: SrcIpAddr
  - entityType: Account
    fieldMappings:
      - identifier: Name
        columnName: SrcUsername
version: 1.0.0