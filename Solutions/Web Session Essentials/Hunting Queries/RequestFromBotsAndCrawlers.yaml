id: b653c2e0-ae0f-490b-9b2e-836858d28976
name: Request from bots and crawlers (ASIM Web Session)
description: |
  'This query searches for requests from bots and crawlers.'
tags:
  - Schema: WebSession
    SchemaVersion: 0.2.6
requiredDataConnectors: []
tactics:
  - InitialAccess
relevantTechniques:
  - T1190
  - T1133
query: |
  // You can add or remove items from this list as per your requirement.
  let BotandCrawlersList = dynamic (['bot','crawler','baiduspider','80legs','ia_archiver','voyager','wget','yahoo','slurp','mediapartners-google','facebookexternalhit','facebookcatalog','okhttp','cURL','Bytespider']);
  _Im_WebSession (starttime=ago(1d),httpuseragent_has_any= BotandCrawlersList)
  | summarize EventCount = count(), USerAgentList = make_set(HttpUserAgent,100), URLs = make_set(Url,100)
  | extend Address_0_SrcIpAddr = SrcIpAddr,
  | extend Account_0_Name = SrcUsername,
  | extend Host_0_HostName = SrcHostname by SrcIpAddr, SrcUsername, SrcHostname
  | order by EventCount desc
entityMappings:
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: SrcHostname
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: SrcIpAddr
  - entityType: Account
    fieldMappings:
      - identifier: Name
        columnName: SrcUsername
customDetails:
  EventCount: EventCount
  Urls: Urls
version: 1.0.0