{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "isWizard": false,
      "basics": {
        "description": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/cisco-logo-72px.svg\" width=\"75px\" height=\"75px\">\n\n**Note:** _There may be [known issues](https://aka.ms/sentinelsolutionsknownissues) pertaining to this Solution, please refer to them before installing._\n\nThe [Cisco Umbrella](https://umbrella.cisco.com/) solution for Microsoft Sentinel enables you to ingest [Cisco Umbrella events](https://docs.umbrella.com/deployment-umbrella/docs/log-formats-and-versioning) stored in Amazon S3 into Microsoft Sentinel using the Amazon S3 REST API.\n\n  **Underlying Microsoft Technologies used:**\n\nThis solution takes a dependency on the following technologies, and some of these dependencies either may be in [Preview](https://azure.microsoft.com/en-us/support/legal/preview-supplemental-terms/) state or might result in additional ingestion or operational costs:\n  a. [Azure Monitor HTTP Data Collector API](https://docs.microsoft.com/en-us/azure/azure-monitor/logs/data-collector-api)\n  b. [Azure Functions](https://azure.microsoft.com/en-us/services/functions/#overview)  \n\n**Playbooks:** 4\n\n[Learn more about Microsoft Sentinel](https://aka.ms/azuresentinel) | [Learn more about Solutions](https://aka.ms/azuresentinelsolutionsdoc)",
        "subscription": {
          "resourceProviders": [
            "Microsoft.OperationsManagement/solutions",
            "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "Microsoft.Insights/workbooks",
            "Microsoft.Logic/workflows"
          ]
        },
        "location": {
          "metadata": {
            "hidden": "Hiding location, we get it from the log analytics workspace"
          },
          "visible": false
        },
        "resourceGroup": {
          "allowExisting": true
        }
      }
    },
    "basics": [
      {
        "name": "getLAWorkspace",
        "type": "Microsoft.Solutions.ArmApiControl",
        "toolTip": "This filters by workspaces that exist in the Resource Group selected",
        "condition": "[greater(length(resourceGroup().name),0)]",
        "request": {
          "method": "GET",
          "path": "[concat(subscription().id,'/providers/Microsoft.OperationalInsights/workspaces?api-version=2020-08-01')]"
        }
      },
      {
        "name": "workspace",
        "type": "Microsoft.Common.DropDown",
        "label": "Workspace",
        "placeholder": "Select a workspace",
        "toolTip": "This dropdown will list only workspace that exists in the Resource Group selected",
        "constraints": {
          "allowedValues": "[map(filter(basics('getLAWorkspace').value, (filter) => contains(toLower(filter.id), toLower(resourceGroup().name))), (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
          "required": true
        },
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "playbooks",
        "label": "Playbooks",
        "subLabel": {
          "preValidation": "Configure the playbooks",
          "postValidation": "Done"
        },
        "bladeTitle": "Playbooks",
        "elements": [
          {
            "name": "playbooks-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This solution installs the following Playbook templates. After installing the solution, playbooks can be managed in the Manage solution view. "
            }
          },
          {
            "name": "playbooks-link",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/tutorial-respond-threats-playbook?WT.mc_id=Portal-Microsoft_Azure_CreateUIDef"
              }
            }
          },
          {
            "name": "playbook1",
            "type": "Microsoft.Common.Section",
            "label": "OktaCustomConnector",
            "elements": [
              {
                "name": "playbook1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This OKTA connector uses okta API to perform different actions on the user accounts."
                }
              },
              {
                "name": "CustomConnectorName",
                "type": "Microsoft.Common.TextBox",
                "label": "Custom Connector Name",
                "defaultValue": "OktaCustomConnector",
                "toolTip": "Please enter Custom Connector Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Custom Connector Name"
                }
              },
              {
                "name": "Service EndPoint",
                "type": "Microsoft.Common.TextBox",
                "label": "Service  End Point",
                "defaultValue": "https://{yourOktaDomain}",
                "toolTip": "Please enter Service  End Point",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Service  End Point"
                }
              }
            ]
          },
          {
            "name": "playbook2",
            "type": "Microsoft.Common.Section",
            "label": "Okta-EnrichIncidentWithUserDetails",
            "elements": [
              {
                "name": "playbook2-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This playbook ingests events from Okta Single Sign-On into Log Analytics using the API."
                }
              },
              {
                "name": "PlaybookName",
                "type": "Microsoft.Common.TextBox",
                "label": "Playbook Name",
                "defaultValue": "Okta-EnrichIncidentWithUserDetails",
                "toolTip": "Resource name for the logic app playbook.  No spaces are allowed",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter a playbook resource name"
                }
              },
              {
                "name": "CustomConnectorName",
                "type": "Microsoft.Common.TextBox",
                "label": "Custom Connector Name",
                "defaultValue": "OktaCustomConnector",
                "toolTip": "Please enter Custom Connector Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Custom Connector Name"
                }
              }
            ]
          },
          {
            "name": "playbook3",
            "type": "Microsoft.Common.Section",
            "label": "Okta-PromptUser",
            "elements": [
              {
                "name": "playbook3-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This playbook ingests events from Okta Single Sign-On into Log Analytics using the API."
                }
              },
              {
                "name": "PlaybookName",
                "type": "Microsoft.Common.TextBox",
                "label": "Playbook Name",
                "defaultValue": "Okta-PromptUser",
                "toolTip": "Resource name for the logic app playbook.  No spaces are allowed",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter a playbook resource name"
                }
              },
              {
                "name": "Teams GroupId",
                "type": "Microsoft.Common.TextBox",
                "label": "Teams  Group Id",
                "defaultValue": "TeamgroupId",
                "toolTip": "Please enter Teams  Group Id",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Teams  Group Id"
                }
              },
              {
                "name": "Teams ChannelId",
                "type": "Microsoft.Common.TextBox",
                "label": "Teams  Channel Id",
                "defaultValue": "TeamChannelId",
                "toolTip": "Please enter Teams  Channel Id",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Teams  Channel Id"
                }
              },
              {
                "name": "CustomConnectorName",
                "type": "Microsoft.Common.TextBox",
                "label": "Custom Connector Name",
                "defaultValue": "OktaCustomConnector",
                "toolTip": "Please enter Custom Connector Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Custom Connector Name"
                }
              }
            ]
          },
          {
            "name": "playbook4",
            "type": "Microsoft.Common.Section",
            "label": "Okta-ResponseFromTeams",
            "elements": [
              {
                "name": "playbook4-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This playbook ingests events from Okta Single Sign-On into Log Analytics using the API."
                }
              },
              {
                "name": "PlaybookName",
                "type": "Microsoft.Common.TextBox",
                "label": "Playbook Name",
                "defaultValue": "Okta-ResponseFromTeams",
                "toolTip": "Resource name for the logic app playbook.  No spaces are allowed",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter a playbook resource name"
                }
              },
              {
                "name": "SOC Email",
                "type": "Microsoft.Common.TextBox",
                "label": "S O C  Email",
                "defaultValue": "",
                "toolTip": "Please enter S O C  Email",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the S O C  Email"
                }
              },
              {
                "name": "Teams GroupId",
                "type": "Microsoft.Common.TextBox",
                "label": "Teams  Group Id",
                "defaultValue": "TeamgroupId",
                "toolTip": "Please enter Teams  Group Id",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Teams  Group Id"
                }
              },
              {
                "name": "Teams ChannelId",
                "type": "Microsoft.Common.TextBox",
                "label": "Teams  Channel Id",
                "defaultValue": "TeamChannelId",
                "toolTip": "Please enter Teams  Channel Id",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Teams  Channel Id"
                }
              },
              {
                "name": "CustomConnectorName",
                "type": "Microsoft.Common.TextBox",
                "label": "Custom Connector Name",
                "defaultValue": "OktaCustomConnector",
                "toolTip": "Please enter Custom Connector Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Custom Connector Name"
                }
              }
            ]
          }
        ]
      }
    ],
    "outputs": {
      "workspace-location": "[first(map(filter(basics('getLAWorkspace').value, (filter) => and(contains(toLower(filter.id), toLower(resourceGroup().name)),equals(filter.name,basics('workspace')))), (item) => item.location))]",
      "location": "[location()]",
      "workspace": "[basics('workspace')]"
    }
  }
}
