// Usage Instruction : 
// Paste below query in log analytics, click on Save button and select as Function from drop down by specifying function name and alias (e.g. VectraAccountDetection).
// Function usually takes 10-15 minutes to activate. You can then use function alias from any other queries (e.g. VectraAccountDetection | take 10).
// References : 
// Using functions in Azure monitor log queries : https://docs.microsoft.com/azure/azure-monitor/log-query/functions
// Tech Community Blog on KQL Functions : https://techcommunity.microsoft.com/t5/Azure-Sentinel/Using-KQL-functions-to-speed-up-analysis-in-Azure-Sentinel/ba-p/712381
//
let VectraAccountDetection_view  = view () { 
    Account_Detection_Data_CL
    | extend 
                EventVendor="VectraAccountDetection",
                EventProduct="VectraAccountDetection",
                ID = column_ifexists('id_d', ''),
                Category = column_ifexists('Category', ''),
                Threat = column_ifexists('threat_d', ''),
                Certainty = column_ifexists('certainty_d', ''),
                Triaged = column_ifexists('triaged_b', ''),
                ["Detection Type"] = column_ifexists('detection_type_s', ''),
                ["D Type Vname"] = column_ifexists('d_type_vname_s', ''),
                ["Detection ID"] = column_ifexists('detection_id_d', ''),
                ["Detection href"] = column_ifexists('detection_href_s', ''),
                ["Account ID"] = column_ifexists('account_id_d', ''),
                ["Account href"] = column_ifexists('account_href_s', ''),
                href = column_ifexists('href_s', ''),
                ["Account UID"] = column_ifexists('account_uid_s', ''),
                ["Src Account"] = column_ifexists('src_account_s', ''),
                ["Event Timestamp"] = column_ifexists('event_timestamp_t', ''),
                IP = column_ifexists('ip_s', ''),
                Details = column_ifexists('detail_s', ''),
                Severity = column_ifexists('Severity', '')
    | project
                TimeGenerated,
				EventVendor,
                EventProduct,
                ID,
                Category,
                Threat,
                Certainty,
                Triaged,
                ["Detection Type"],
                ["D Type Vname"],
                ["Detection ID"],
                ["Detection href"],
                ["Account ID"],
                ["Account href"],
                href,
                ["Account UID"],
                ["Src Account"],
                ["Event Timestamp"],
                IP,
                Details,
                Severity
};
VectraAccountDetection_view