// Usage Instruction : 
// Paste below query in log analytics, click on Save button and select as Function from drop down by specifying function name and alias (e.g. BitSightWorkFromHome).
// Function usually takes 10-15 minutes to activate. You can then use function alias from any other queries (e.g. BitSightWorkFromHome | take 10).
// References : 
// Using functions in Azure monitor log queries : https://docs.microsoft.com/azure/azure-monitor/log-query/functions
// Tech Community Blog on KQL Functions : https://techcommunity.microsoft.com/t5/Azure-Sentinel/Using-KQL-functions-to-speed-up-analysis-in-Azure-Sentinel/ba-p/712381
//
let WorkFromHome_view  = view () {
    BitSight_WFH_data_CL   
    | extend 
            EventVendor ="WFHBitSight",
            EventProduct ="WFHBitSight",
            RiskType = column_ifexists('results_risk_type_s', ''),
            ObservationID = column_ifexists('results_observation_id_s', ''),
            CollectionDate = column_ifexists('results_collection_date_s', ''),
            EventDate = column_ifexists('results_event_date_s', ''),
            OccurrencesEventDate = column_ifexists('results_occurrences_event_date_s', ''),
            OccurrencesRepresentativeTimestamp = column_ifexists('results_occurrences_representative_timestamp_s', ''),
            OccurrencesCount = column_ifexists('results_occurrences_count_d', ''),
            ForensicsHostIP = column_ifexists('results_forensics_host_ip_s', ''),
            ForensicsHostPort = column_ifexists('results_forensics_host_port_d', ''),
            CompanyName = column_ifexists('results_country_name_s', ''),
            CountryCode = column_ifexists('results_country_code_s', ''),
            DetailsGrade = column_ifexists('results_details_grade_grade_s', ''),
            DetailsResponse = column_ifexists('results_details_response_s', ''),
            DetailsService = column_ifexists('results_details_service_s', ''),
            DetailsMessage = column_ifexists('results_details_message_s', ''),
            DetailsLowVulnerabilities = column_ifexists('results_details_low_vulnerabilities_s', ''),
            DetailsInfection = column_ifexists('results_details_infection_s', ''),
            DetailsDetectionMethod = column_ifexists('results_details_detection_method_s', ''),
            ServiceProviders = column_ifexists('service_providers_s', ''),
            Type = column_ifexists('Type', '')
    | project
            TimeGenerated,
            EventVendor,
            EventProduct,
            RiskType,
            ObservationID,
            CollectionDate,
            EventDate,
            OccurrencesEventDate,
            OccurrencesRepresentativeTimestamp,
            OccurrencesCount,
            ForensicsHostIP,
            ForensicsHostPort,
            CompanyName,
            CountryCode,
            DetailsGrade,
            DetailsResponse,
            DetailsService,
            DetailsMessage,
            DetailsLowVulnerabilities,
            DetailsInfection,
            DetailsDetectionMethod,
            ServiceProviders,
            Type
};
WorkFromHome_view
