id: a1275c5e-0ff4-4d15-a7b7-96018cd979f5
name: Alert when there is a new alert from BitSight
description: |
  'Creates an incident whenever there is a new alert from BitSight.'
severity: High
status: Available
requiredDataConnectors:
  - connectorId: BitSight
    dataTypes:
      - BitSightAlerts
queryFrequency: 1d
queryPeriod: 14d
triggerOperator: GreaterThan
triggerThreshold: 0
query: |
    let timeframe = 24h;
    BitSightAlerts
    | where ingestion_time() > ago(timeframe)
    | extend Severity = case( Severity contains "INFORMATIONAL", 0,
                              Severity contains "INCREASE", 1,
                              Severity contains "WARN" or Severity contains "DECREASE", 2,
                              Severity contains "CRITICAL", 3,
                              0)
    | extend CompanyURL = strcat("https://service.bitsighttech.com/app/spm",CompanyURL)
    | project CompanyName, Severity, Trigger, CompanyURL, AlertDate, GUID
incidentConfiguration:
    createIncident: true
    groupingConfiguration:
      enabled: false
      reopenClosedIncident: false
      lookbackDuration: 5h
      matchingMethod: AllEntities
eventGroupingSettings:
    aggregationKind: AlertPerResult
alertDetailsOverride:
    alertDisplayNameFormat: 'BitSight: Alert for {{Trigger}} in {{CompanyName}} from bitsight.'
    alertDescriptionFormat: 'Alert generated on {{AlertDate}} in BitSight.\n\nCompany URL: {{CompanyURL}}\nAlert GUID: {{GUID}}'
    alertSeverityColumnName: Severity
version: 1.0.1
kind: Scheduled
