id: d8844f11-3a36-4b97-9062-1e6d57c00e37
name: Alert when there is a drop of 10% or more
description: |
  'Creates an incident when there is a drop of 10% or more in BitSight company ratings.'
severity: High
query: |
    let timeframe = 24h;
    GraphData_view
    | where ingestion_time() > ago(timeframe)and toint(RatingDifferance) < 0
    | extend percentage = -(toreal(RatingDifferance)/toreal(Rating))*100
    | where percentage >= 10
    | project RatingDate, Rating, CompanyName, percentage
queryFrequency: 1d
queryPeriod: 14d
triggerOperator: GreaterThan
triggerThreshold: 0
incidentConfiguration:
    createIncident: true
    groupingConfiguration:
      enabled: false
      reopenClosedIncident: false
      lookbackDuration: 5h
      matchingMethod: AllEntities
      groupByEntities: []
      groupByAlertDetails: []
      groupByCustomDetails: []
eventGroupingSettings:
    aggregationKind: AlertPerResult
alertDetailsOverride:
    alertDisplayNameFormat: 'BitSight : Alert for >10% drop in ratings of {{CompanyName}}.'
    alertDescriptionFormat: "Alert is generated for {{CompanyName}}.\n\nRating Date: {{RatingDate}}\nPercentage Drop: {{percentage}}% "
    alertDynamicProperties: []
version: 1.0.1
kind: Scheduled
