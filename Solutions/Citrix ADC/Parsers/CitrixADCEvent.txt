// Usage Instructions: 
// Paste below query in log analytics, click on Save button and select as Function from drop down by specifying function name as CitrixADCEvent and specifying Legacy Category.
// This function maps Citrix ADC (former NetScaler) events to Advanced Security Information Model (ASIM) (https://docs.microsoft.com/azure/sentinel/normalization).
// Function usually takes 10-15 minutes to activate. You can then use function alias from any other queries (e.g. CitrixADCEvent | take 10).
// Reference : Using functions in Azure monitor log queries : https://docs.microsoft.com/azure/azure-monitor/log-query/functions
// Please update ComputerName with with Computer.
let EventData = Syslog
| where Computer in ("10.93.91.136");
let NotFound = EventData
| where SyslogMessage  contains "NotFound"
| parse SyslogMessage with * "SessionId: " SessionId" - " *
| parse SyslogMessage with * "User " User" :" *
| parse SyslogMessage with * "Group(s) " Group" :" *
| parse SyslogMessage with * "Vserver " Vserver" -" *;
let Found = EventData
| where SyslogMessage  contains "Access Allowed"
| parse-kv SyslogMessage as (User:string, Client_ip:string, Nat_ip:string, Vserver:string, Destination:string, Start_time:string, End_time:int, Duration:int, Total_bytes_send:int, Total_bytes_recv:int, Total_compressedbytes_send:int, Total_compressedbytes_recv:int, Compression_ratio_send:int, Compression_ratio_recv:int, Access:string) with (pair_delimiter=' - ', kv_delimiter=' ');
let data = union Found, NotFound;
data