{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "Microsoft - support@microsoft.com",
    "comments": "Solution template for Cisco Meraki Security Event"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": null,
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "solutionId": "azuresentinel.azure-sentinel-solution-ciscomerakinativepoller",
    "_solutionId": "[variables('solutionId')]",
    "email": "support@microsoft.com",
    "_email": "[variables('email')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "uiConfigId1": "CiscoMerakiNativePolling",
    "_uiConfigId1": "[variables('uiConfigId1')]",
    "dataConnectorContentId1": "CiscoMerakiNativePolling",
    "_dataConnectorContentId1": "[variables('dataConnectorContentId1')]",
    "dataConnectorId1": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
    "_dataConnectorId1": "[variables('dataConnectorId1')]",
    "dataConnectorTemplateSpecName1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentId1')))]",
    "dataConnectorVersion1": "1.0.0",
    "parserVersion1": "2.0.0",
    "parserContentId1": "CiscoMeraki-Parser",
    "_parserContentId1": "[variables('parserContentId1')]",
    "parserName1": "cisco meraki data parser",
    "_parserName1": "[concat(parameters('workspace'),'/',variables('parserName1'))]",
    "parserId1": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
    "_parserId1": "[variables('parserId1')]",
    "parserTemplateSpecName1": "[concat(parameters('workspace'),'-pr-',uniquestring(variables('_parserContentId1')))]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "CiscoMerakiWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1')))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "dataCollectionRuleId": "CiscoMerakiRule",
    "logAnalyticsTableId": "CiscoMerakiNativePoller_CL",
    "streamName": "MyTableRawData"
  },
  "resources": [
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('dataConnectorTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "properties": {
        "description": "Cisco Meraki Security Event data connector with template",
        "displayName": "Cisco Meraki Security Event template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('dataConnectorTemplateSpecName1'),'/',variables('dataConnectorVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "DataConnector"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('dataConnectorTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "Cisco Meraki Security Event data connector with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
              "apiVersion": "2021-03-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "APIPolling",
              "properties": {
                "connectorUiConfig": {
                  "id": "[variables('_uiConfigId1')]",
                  "title": "Cisco Meraki (using REST API)",
                  "publisher": "Microsoft",
                  "descriptionMarkdown": "The [Cisco Meraki](https://aka.ms/ciscomeraki) connector allows you to easily connect your Cisco Meraki MX [security events](https://aka.ms/ciscomerakisecurityevents) to Microsoft Sentinel. The data connector uses [Cisco Meraki REST API](https://developer.cisco.com/meraki/api-v1/#!get-organization-appliance-security-events) to fetch security events and supports DCR-based [ingestion time transformations](https://docs.microsoft.com/azure/azure-monitor/logs/custom-logs-overview) that parses the received security event data into a custom columns so that queries don't need to parse it again, thus resulting in better performance.\n\n **Supported ASIM schema:** \n 1. Network Session",
                  "graphQueriesTableName": "[variables('logAnalyticsTableId')]",
                  "graphQueries": [
                    {
                      "metricName": "Total events received",
                      "legend": "Cisco Meraki Security Events",
                      "baseQuery": "{{graphQueriesTableName}}"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "Get Sample of Cisco Meraki Security Events",
                      "query": "{{graphQueriesTableName}}\n | take 10"
                    },
                    {
                      "description": "Total Events by Event Type",
                      "query": "{{graphQueriesTableName}}\n | summarize count() by EventOriginalType"
                    },
                    {
                      "description": "Get Rest API Data from Query Time Parser",
                      "query": "CiscoMeraki\n| where Type == \"{{graphQueriesTableName}}\""
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "{{graphQueriesTableName}}",
                      "lastDataReceivedQuery": "{{graphQueriesTableName}}\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriterias": [
                    {
                      "type": "SentinelKindsV2",
                      "value": []
                    }
                  ],
                  "availability": {
                    "status": 1,
                    "isPreview": false
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "Read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key)",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Cisco Meraki REST API Key",
                        "description": "Enable API access in Cisco Meraki and generate API Key. Please refer to Cisco Meraki official [documentation](https://aka.ms/ciscomerakiapikey) for more information."
                      },
                      {
                        "name": "Cisco Meraki Organization Id",
                        "description": "Obtain your Cisco Meraki organization id to fetch security events. Follow the steps in the [documentation](https://aka.ms/ciscomerakifindorg) to obtain the Organization Id using the Meraki API Key obtained in previous step."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "description": "To enable Cisco Meraki Security Events for Microsoft Sentinel, provide the required information below and click on Connect.\n>This data connector depends on a parser based on a Kusto Function to render the content. [**CiscoMeraki**](https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/CiscoMeraki/Parsers/CiscoMeraki.txt) Parser currently support only \"**IDS Alert**\" and \"**File Scanned**\" Events.",
                      "instructions": [
                        {
                          "parameters": {
                            "enable": "true",
                            "userRequestPlaceHoldersInput": [
                              {
                                "displayText": "Organization Id",
                                "requestObjectKey": "apiEndpoint",
                                "placeHolderName": "{{organization}}"
                              }
                            ],
                            "transformation": {
                              "transformationType": "predefinedTransformation",
                              "outputStream": "[concat('Custom-', variables('streamName'))]",
                              "dataCollectionRuleTemplateSpecName": "[variables('dataCollectionRuleId')]",
                              "logAnalyticsTableTemplateSpecName": "[variables('logAnalyticsTableId')]"
                            }
                          },
                          "type": "APIKey"
                        }
                      ],
                      "title": "Connect Cisco Meraki Security Events to Microsoft Sentinel"
                    }
                  ]
                },
                "pollingConfig": {
                  "owner": "ASI",
                  "version": "2.0",
                  "source": "PaaS",
                  "templateFilePath": "",
                  "templateFileName": "",
                  "auth": {
                    "authType": "APIKey",
                    "APIKeyName": "X-Cisco-Meraki-API-Key",
                    "IsAPIKeyInPostPayload": false
                  },
                  "request": {
                    "apiEndpoint": "https://api.meraki.com/api/v1/organizations/{{organization}}/appliance/security/events",
                    "rateLimitQPS": 10,
                    "queryWindowInMin": 5,
                    "httpMethod": "GET",
                    "queryTimeFormat": "UnixTimestamp",
                    "startTimeAttributeName": "t0",
                    "endTimeAttributeName": "t1",
                    "queryParameters": {
                      "perPage": 1000
                    },
                    "retryCount": 3,
                    "timeoutInSeconds": 60,
                    "headers": {
                      "Accept": "application/json",
                      "User-Agent": "Scuba"
                    }
                  },
                  "paging": {
                    "pagingType": "LinkHeader"
                  },
                  "response": {
                    "eventsJsonPaths": [
                      "$"
                    ]
                  }
                }
              }
            },
            {
              "name": "[variables('logAnalyticsTableId')]",
              "type": "Microsoft.OperationalInsights/workspaces",
              "apiVersion": "2021-03-01-privatepreview",
              "location": "[parameters('workspace-location')]",
              "tags": {},
              "properties": {
                "schema": {
                  "name": "[variables('logAnalyticsTableId')]",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "DateTime",
                      "isDefaultDisplay": true,
                      "description": "The timestamp (UTC) reflecting the time in which the event was generated."
                    },
                    {
                      "name": "EventCount",
                      "type": "Int",
                      "description": "This value is used when the source supports aggregation, and a single record may represent multiple events."
                    },
                    {
                      "name": "EventSchemaVersion",
                      "type": "String",
                      "description": "The version of the schema."
                    },
                    {
                      "name": "EventSchema",
                      "type": "String",
                      "description": "The name of the schema."
                    },
                    {
                      "name": "DvcAction",
                      "type": "String",
                      "description": "The action taken on the network session."
                    },
                    {
                      "name": "EventMessage",
                      "type": "String",
                      "description": "A general message or description."
                    },
                    {
                      "name": "EventSeverity",
                      "type": "String",
                      "description": "The severity of the event. Valid values are: Informational, Low, Medium, or High."
                    },
                    {
                      "name": "EventStartTime",
                      "type": "DateTime",
                      "description": "The time in which the event started. If the source supports aggregation and the record represents multiple events, the time that the first event was generated. If not provided by the source record, this field aliases the TimeGenerated field."
                    },
                    {
                      "name": "EventEndTime",
                      "type": "DateTime",
                      "description": "The time in which the event ended. If the source supports aggregation and the record represents multiple events, the time that the last event was generated. If not provided by the source record, this field aliases the TimeGenerated field."
                    },
                    {
                      "name": "DvcMacAddr",
                      "type": "String",
                      "description": "The MAC address of the device on which the event occurred or which reported the event. Example: 00:1B:44:11:3A:B7"
                    },
                    {
                      "name": "Dvc",
                      "type": "String",
                      "description": "A unique identifier of the device on which the event occurred or which reported the event."
                    },
                    {
                      "name": "DvcZone",
                      "type": "String",
                      "description": "The network on which the event occurred or which reported the event. The zone is defined by the reporting device."
                    },
                    {
                      "name": "EventProductVersion",
                      "type": "String",
                      "description": "The version of the product generating the event."
                    },
                    {
                      "name": "DvcOriginalAction",
                      "type": "String",
                      "description": "The original DvcAction as provided by the reporting device."
                    },
                    {
                      "name": "DvcInterface",
                      "type": "String",
                      "description": "The network interface on which data was captured. This field is typically relevant to network related activity which is captured by an intermediate or tap device."
                    },
                    {
                      "name": "DvcSubscriptionId",
                      "type": "String",
                      "description": "The cloud platform subscription ID the device belongs to. DvcSubscriptionId map to a subscription ID on Azure and to an account ID on AWS."
                    },
                    {
                      "name": "EventOriginalSeverity",
                      "type": "String",
                      "description": "The original severity as provided by the reporting device. This value is used to derive EventSeverity."
                    },
                    {
                      "name": "EventOriginalSubType",
                      "type": "String",
                      "description": "The original event subtype or ID, if provided by the source. For example, this field will be used to store the original Windows logon type. This value is used to derive EventSubType, which should have only one of the values documented for each schema."
                    },
                    {
                      "name": "NetworkApplicationProtocol",
                      "type": "String",
                      "description": "The application layer protocol used by the connection or session."
                    },
                    {
                      "name": "NetworkProtocolVersion",
                      "type": "String",
                      "description": "The version of NetworkProtocol."
                    },
                    {
                      "name": "NetworkDirection",
                      "type": "String",
                      "description": "The direction of the connection or session."
                    },
                    {
                      "name": "NetworkIcmpCode",
                      "type": "Int",
                      "description": "For an ICMP message, the ICMP message type numeric value as described in RFC 2780 for IPv4 network connections, or in RFC 4443 for IPv6 network connections."
                    },
                    {
                      "name": "NetworkIcmpType",
                      "type": "String",
                      "description": "For an ICMP message, the ICMP message type text representation, as described in RFC 2780 for IPv4 network connections, or in RFC 4443 for IPv6 network connections."
                    },
                    {
                      "name": "NetworkConnectionHistory",
                      "type": "String",
                      "description": "TCP flags and other potential IP header information."
                    },
                    {
                      "name": "DstBytes",
                      "type": "Long",
                      "description": "The number of bytes sent from the destination to the source for the connection or session. If the event is aggregated, DstBytes is the sum over all aggregated sessions."
                    },
                    {
                      "name": "SrcBytes",
                      "type": "Long",
                      "description": "The number of bytes sent from the source to the destination for the connection or session. If the event is aggregated, SrcBytes is the sum over all aggregated sessions."
                    },
                    {
                      "name": "NetworkBytes",
                      "type": "Long",
                      "description": "Number of bytes sent in both directions. If both BytesReceived and BytesSent exist, BytesTotal should equal their sum. If the event is aggregated, NetworkBytes is the sum over all aggregated sessions."
                    },
                    {
                      "name": "DstPackets",
                      "type": "Long",
                      "description": "The number of packets sent from the destination to the source for the connection or session. The meaning of a packet is defined by the reporting device. If the event is aggregated, DstPackets is the sum over all aggregated sessions."
                    },
                    {
                      "name": "SrcPackets",
                      "type": "Long",
                      "description": "The number of packets sent from the source to the destination for the connection or session. The meaning of a packet is defined by the reporting device. If the event is aggregated, SrcPackets is the sum over all aggregated sessions."
                    },
                    {
                      "name": "NetworkPackets",
                      "type": "Long",
                      "description": "The number of packets sent in both directions. If both PacketsReceived and PacketsSent exist, BytesTotal should equal their sum. The meaning of a packet is defined by the reporting device. If the event is aggregated, NetworkPackets is the sum over all aggregated sessions."
                    },
                    {
                      "name": "NetworkSessionId",
                      "type": "String",
                      "description": "The session identifier as reported by the reporting device."
                    },
                    {
                      "name": "DstZone",
                      "type": "String",
                      "description": "The network zone of the destination, as defined by the reporting device."
                    },
                    {
                      "name": "DstInterfaceName",
                      "type": "String",
                      "description": "The network interface used for the connection or session by the destination device."
                    },
                    {
                      "name": "DstInterfaceGuid",
                      "type": "String",
                      "description": "The GUID of the network interface used on the destination device.",
                      "dataTypeHint": "GUID"
                    },
                    {
                      "name": "DstMacAddr",
                      "type": "String",
                      "description": "The MAC address of the network interface used for the connection or session by the destination device."
                    },
                    {
                      "name": "DstVlanId",
                      "type": "String",
                      "description": "The VLAN ID related to the destination device."
                    },
                    {
                      "name": "DstSubscriptionId",
                      "type": "String",
                      "description": "The cloud platform subscription ID the destination device belongs to. DstSubscriptionId map to a subscription ID on Azure and to an account ID on AWS."
                    },
                    {
                      "name": "DstGeoCountry",
                      "type": "String",
                      "description": "The country associated with the destination IP address."
                    },
                    {
                      "name": "DstGeoRegion",
                      "type": "String",
                      "description": "The region, or state, within a country associated with the destination IP address."
                    },
                    {
                      "name": "DstGeoCity",
                      "type": "String",
                      "description": "The city associated with the destination IP address."
                    },
                    {
                      "name": "DstGeoLatitude",
                      "type": "Double",
                      "description": "The latitude of the geographical coordinate associated with the destination IP address."
                    },
                    {
                      "name": "DstGeoLongitude",
                      "type": "Double",
                      "description": "The longitude of the geographical coordinate associated with the destination IP address."
                    },
                    {
                      "name": "DstUserId",
                      "type": "String",
                      "description": "A machine-readable, alphanumeric, unique representation of the destination user."
                    },
                    {
                      "name": "DstUserIdType",
                      "type": "String",
                      "description": "The type of the ID stored in the DstUserId field."
                    },
                    {
                      "name": "DstUsername",
                      "type": "String",
                      "description": "The destination username, including domain information when available. Use the simple form only if domain information isn't available."
                    },
                    {
                      "name": "DstUsernameType",
                      "type": "String",
                      "description": "Specifies the type of the username stored in the DstUsername field."
                    },
                    {
                      "name": "DstUserType",
                      "type": "String",
                      "description": "The type of destination user."
                    },
                    {
                      "name": "DstOriginalUserType",
                      "type": "String",
                      "description": "The original destination user type, if provided by the source."
                    },
                    {
                      "name": "DstAppName",
                      "type": "String",
                      "description": "The name of the destination application."
                    },
                    {
                      "name": "DstAppId",
                      "type": "String",
                      "description": "The ID of the destination application, as reported by the reporting device."
                    },
                    {
                      "name": "DstAppType",
                      "type": "String",
                      "description": "The type of the destination application."
                    },
                    {
                      "name": "SrcZone",
                      "type": "String",
                      "description": "The network zone of the source, as defined by the reporting device."
                    },
                    {
                      "name": "SrcInterfaceName",
                      "type": "String",
                      "description": "The network interface used for the connection or session by the source device."
                    },
                    {
                      "name": "SrcInterfaceGuid",
                      "type": "String",
                      "description": "The GUID of the network interface used on the source device.",
                      "dataTypeHint": "GUID"
                    },
                    {
                      "name": "SrcMacAddr",
                      "type": "String",
                      "description": "The MAC address of the network interface from which the connection or session originated."
                    },
                    {
                      "name": "SrcVlanId",
                      "type": "String",
                      "description": "The VLAN ID related to the source device."
                    },
                    {
                      "name": "SrcSubscriptionId",
                      "type": "String",
                      "description": "The cloud platform subscription ID the source device belongs to. SrcSubscriptionId map to a subscription ID on Azure and to an account ID on AWS."
                    },
                    {
                      "name": "SrcGeoCountry",
                      "type": "String",
                      "description": "The country associated with the source IP address."
                    },
                    {
                      "name": "SrcGeoRegion",
                      "type": "String",
                      "description": "The region within a country associated with the source IP address."
                    },
                    {
                      "name": "SrcGeoCity",
                      "type": "String",
                      "description": "The city associated with the source IP address."
                    },
                    {
                      "name": "SrcGeoLatitude",
                      "type": "Double",
                      "description": "The latitude of the geographical coordinate associated with the source IP address."
                    },
                    {
                      "name": "SrcGeoLongitude",
                      "type": "Double",
                      "description": "The longitude of the geographical coordinate associated with the source IP address."
                    },
                    {
                      "name": "SrcAppName",
                      "type": "String",
                      "description": "The name of the source application."
                    },
                    {
                      "name": "SrcAppId",
                      "type": "String",
                      "description": "The ID of the source application, as reported by the reporting device."
                    },
                    {
                      "name": "SrcAppType",
                      "type": "String",
                      "description": "The type of the source application."
                    },
                    {
                      "name": "DstNatIpAddr",
                      "type": "String",
                      "description": "The DstNatIpAddr represents either of: The original address of the destination device if network address translation was used or the IP address used by the intermediary device for communication with the source."
                    },
                    {
                      "name": "DstNatPortNumber",
                      "type": "Int",
                      "description": "If reported by an intermediary NAT device, the port used by the NAT device for communication with the source."
                    },
                    {
                      "name": "SrcNatIpAddr",
                      "type": "String",
                      "description": "The SrcNatIpAddr represents either of: The original address of the source device if network address translation was used or the IP address used by the intermediary device for communication with the destination.",
                      "dataTypeHint": "IP"
                    },
                    {
                      "name": "SrcNatPortNumber",
                      "type": "Int",
                      "description": "If reported by an intermediary NAT device, the port used by the NAT device for communication with the destination."
                    },
                    {
                      "name": "DvcInboundInterface",
                      "type": "String",
                      "description": "If reported by an intermediary device, the network interface used by the NAT device for the connection to the source device."
                    },
                    {
                      "name": "DvcOutboundInterface",
                      "type": "String",
                      "description": "If reported by an intermediary device, the network interface used by the NAT device for the connection to the destination device."
                    },
                    {
                      "name": "NetworkRuleName",
                      "type": "String",
                      "description": "The name or ID of the rule by which DvcAction was decided upon."
                    },
                    {
                      "name": "NetworkRuleNumber",
                      "type": "Int",
                      "description": "The number of the rule by which DvcAction was decided upon."
                    },
                    {
                      "name": "ThreatId",
                      "type": "String",
                      "description": "The ID of the threat or malware identified in the network session."
                    },
                    {
                      "name": "ThreatName",
                      "type": "String",
                      "description": "The name of the threat or malware identified in the network session."
                    },
                    {
                      "name": "ThreatCategory",
                      "type": "String",
                      "description": "The category of the threat or malware identified in the network session."
                    },
                    {
                      "name": "ThreatRiskLevel",
                      "type": "Int",
                      "description": "The risk level associated with the session. The level is a number between 0 and 100."
                    },
                    {
                      "name": "ThreatRiskLevelOriginal",
                      "type": "String",
                      "description": "The risk level as reported by the reporting device."
                    },
                    {
                      "name": "EventType",
                      "type": "String",
                      "description": "The operation reported by the record."
                    },
                    {
                      "name": "EventSubType",
                      "type": "String",
                      "description": "Additional description of the event type, if applicable."
                    },
                    {
                      "name": "EventResult",
                      "type": "String",
                      "description": "The outcome of the event, represented by one of the following values: Success, Partial, Failure, NA (Not Applicable). The value may not be provided directly by the sources, in which case it is derived from other event fields, for example, the EventResultDetails field."
                    },
                    {
                      "name": "EventResultDetails",
                      "type": "String",
                      "description": "Reason or details for the result reported in the EventResult field."
                    },
                    {
                      "name": "EventOriginalType",
                      "type": "String",
                      "isDefaultDisplay": true,
                      "description": "The original event type or ID, if provided by the source."
                    },
                    {
                      "name": "EventProduct",
                      "type": "String",
                      "description": "The product generating the event."
                    },
                    {
                      "name": "EventVendor",
                      "type": "String",
                      "description": "The vendor of the product generating the event."
                    },
                    {
                      "name": "DvcIpAddr",
                      "type": "String",
                      "dataTypeHint": "IP",
                      "description": "The IP Address of the device reporting the event."
                    },
                    {
                      "name": "DvcHostname",
                      "type": "String",
                      "description": "The hostname of the device reporting the event."
                    },
                    {
                      "name": "DvcDomain",
                      "type": "String",
                      "description": "The domain of the device reporting the event."
                    },
                    {
                      "name": "DvcDomainType",
                      "type": "String",
                      "description": "The type of DvcDomain. Possible values include 'Windows' and 'FQDN'."
                    },
                    {
                      "name": "DvcOs",
                      "type": "String",
                      "description": "The operating system running on the device reporting the event."
                    },
                    {
                      "name": "DvcOsVersion",
                      "type": "String",
                      "description": "The version of the operating system on the device reporting the event."
                    },
                    {
                      "name": "AdditionalFields",
                      "type": "Dynamic",
                      "description": "Additional information, represented using key/value pairs provided by the source which do not map to ASim."
                    },
                    {
                      "name": "SrcIpAddr",
                      "type": "String",
                      "isDefaultDisplay": true,
                      "dataTypeHint": "IP",
                      "description": "The IP address from which the connection or session originated."
                    },
                    {
                      "name": "SrcPortNumber",
                      "type": "Int",
                      "description": "The IP port from which the connection originated. Might not be relevant for a session comprising multiple connections."
                    },
                    {
                      "name": "DstIpAddr",
                      "type": "String",
                      "isDefaultDisplay": true,
                      "dataTypeHint": "IP",
                      "description": "The IP address of the connection or session destination."
                    },
                    {
                      "name": "NetworkProtocol",
                      "type": "String",
                      "description": "The IP protocol used by the connection or session as listed in IANA protocol assignment, which is typically TCP, UDP, or ICMP."
                    },
                    {
                      "name": "EventOriginalUid",
                      "type": "String",
                      "description": "A unique ID of the original record, if provided by the source."
                    },
                    {
                      "name": "EventReportUrl",
                      "type": "String",
                      "dataTypeHint": "URI",
                      "description": "A URL provided in the event for a resource that provides more information about the event."
                    },
                    {
                      "name": "DvcFQDN",
                      "type": "String",
                      "description": "The hostname of the device on which the event occurred or which reported the event."
                    },
                    {
                      "name": "DvcId",
                      "type": "String",
                      "description": "The unique ID of the device on which the event occurred or which reported the event."
                    },
                    {
                      "name": "DvcIdType",
                      "type": "String",
                      "description": "The type of DvcId."
                    },
                    {
                      "name": "SrcHostname",
                      "type": "String",
                      "description": "The source device hostname, excluding domain information. If no device name is available, may store the relevant IP address."
                    },
                    {
                      "name": "SrcDomain",
                      "type": "String",
                      "description": "The domain of the source device."
                    },
                    {
                      "name": "SrcDomainType",
                      "type": "String",
                      "description": "The type of SrcDomain."
                    },
                    {
                      "name": "SrcFQDN",
                      "type": "String",
                      "description": "The source device hostname, including domain information when available."
                    },
                    {
                      "name": "SrcDvcId",
                      "type": "String",
                      "description": "The ID of the source device."
                    },
                    {
                      "name": "SrcDvcIdType",
                      "type": "String",
                      "description": "The type of SrcDvcId."
                    },
                    {
                      "name": "SrcDeviceType",
                      "type": "String",
                      "description": "The type of the source device."
                    },
                    {
                      "name": "SrcUserId",
                      "type": "String",
                      "description": "A machine-readable, alphanumeric, unique representation of the source user."
                    },
                    {
                      "name": "SrcUserIdType",
                      "type": "String",
                      "description": "The type of the ID stored in the SrcUserId field."
                    },
                    {
                      "name": "SrcUsername",
                      "type": "String",
                      "description": "The source username, including domain information when available."
                    },
                    {
                      "name": "SrcUsernameType",
                      "type": "String",
                      "description": "Specifies the type of the username stored in the SrcUsername field."
                    },
                    {
                      "name": "SrcUserType",
                      "type": "String",
                      "description": "The type of the source user."
                    },
                    {
                      "name": "SrcOriginalUserType",
                      "type": "String",
                      "description": "The original destination user type, if provided by the by the reporting device."
                    },
                    {
                      "name": "DstPortNumber",
                      "type": "Int",
                      "description": "The destination IP port."
                    },
                    {
                      "name": "DstHostname",
                      "type": "String",
                      "description": "The destination device hostname, excluding domain information."
                    },
                    {
                      "name": "DstDomain",
                      "type": "String",
                      "description": "The domain of the destination device."
                    },
                    {
                      "name": "DstDomainType",
                      "type": "String",
                      "description": "The type of DstDomain."
                    },
                    {
                      "name": "DstFQDN",
                      "type": "String",
                      "description": "The destination device hostname, including domain information when available."
                    },
                    {
                      "name": "DstDvcId",
                      "type": "String",
                      "description": "The ID of the destination device."
                    },
                    {
                      "name": "DstDvcIdType",
                      "type": "String",
                      "description": "The type of DstDvcId."
                    },
                    {
                      "name": "DstDeviceType",
                      "type": "String",
                      "description": "The type of the destination device."
                    },
                    {
                      "name": "Url",
                      "type": "String",
                      "description": "The full HTTP request URL, including parameters."
                    },
                    {
                      "name": "UrlCategory",
                      "type": "String",
                      "description": "The defined grouping of a URL or the domain part of the URL. The category is commonly provided by web security gateways and is based on the content of the site the URL points to."
                    },
                    {
                      "name": "UrlOriginal",
                      "type": "String",
                      "description": "The original value of the URL, when the URL was modified by the reporting device and both values are provided."
                    },
                    {
                      "name": "HttpVersion",
                      "type": "String",
                      "description": "The HTTP Request Version."
                    },
                    {
                      "name": "HttpRequestMethod",
                      "type": "String",
                      "description": "The HTTP Method. The values are as defined in RFC 7231 and RFC 5789, and include GET, HEAD, POST, PUT, DELETE, CONNECT, OPTIONS, TRACE, and PATCH."
                    },
                    {
                      "name": "HttpStatusCode",
                      "type": "String",
                      "description": "The HTTP Status Code. Alias to EventResultDetails."
                    },
                    {
                      "name": "HttpContentType",
                      "type": "String",
                      "description": "The HTTP Response content type header."
                    },
                    {
                      "name": "HttpContentFormat",
                      "type": "String",
                      "description": "The content format part of the HttpContentType"
                    },
                    {
                      "name": "HttpReferrer",
                      "type": "String",
                      "description": "The HTTP referrer header."
                    },
                    {
                      "name": "HttpUserAgent",
                      "type": "String",
                      "description": "The HTTP user agent header."
                    },
                    {
                      "name": "UserAgent",
                      "type": "String",
                      "description": "Alias to HttpUserAgent"
                    },
                    {
                      "name": "HttpRequestXff",
                      "type": "String",
                      "description": "The HTTP X-Forwarded-For header."
                    },
                    {
                      "name": "HttpRequestTime",
                      "type": "Int",
                      "description": "The amount of time, in milliseconds, it took to send the request to the server, if applicable."
                    },
                    {
                      "name": "HttpResponseTime",
                      "type": "Int",
                      "description": "The amount of time, in milliseconds, it took to receive a response in the server, if applicable."
                    },
                    {
                      "name": "FileName",
                      "type": "String",
                      "description": "For HTTP uploads, the name of the uploaded file."
                    },
                    {
                      "name": "FileMD5",
                      "type": "String",
                      "description": "For HTTP uploads, the MD5 hash of the uploaded file."
                    },
                    {
                      "name": "FileSHA1",
                      "type": "String",
                      "description": "For HTTP uploads, the SHA1 hash of the uploaded file."
                    },
                    {
                      "name": "FileSHA256",
                      "type": "String",
                      "description": "For HTTP uploads, the SHA256 hash of the uploaded file."
                    },
                    {
                      "name": "FileSHA512",
                      "type": "String",
                      "description": "For HTTP uploads, the SHA512 hash of the uploaded file."
                    },
                    {
                      "name": "Hash",
                      "type": "String",
                      "description": "Alias to the available Hash field."
                    },
                    {
                      "name": "FileHashType",
                      "type": "String",
                      "description": "The type of the hash in the Hash field. Possible values include: MD5, SHA1, SHA256, and SHA512."
                    },
                    {
                      "name": "FileSize",
                      "type": "Int",
                      "description": "For HTTP uploads, the size in bytes of the uploaded file."
                    },
                    {
                      "name": "FileContentType",
                      "type": "String",
                      "description": "For HTTP uploads, the content type of the uploaded file."
                    },
                    {
                      "name": "RuleName",
                      "type": "String",
                      "description": "The name or ID of the rule by which DvcAction was decided upon."
                    },
                    {
                      "name": "RuleNumber",
                      "type": "Int",
                      "description": "The number of the rule by which DvcAction was decided upon."
                    },
                    {
                      "name": "Rule",
                      "type": "String",
                      "description": "Either NetworkRuleName or NetworkRuleNumber"
                    },
                    {
                      "name": "NetworkDuration",
                      "type": "Int",
                      "description": "Duration of the network"
                    },
                    {
                      "name": "IpAddr",
                      "type": "String",
                      "description": "Alias for SrcIpAddr"
                    }
                  ]
                }
              }
            },
            {
              "name": "[variables('dataCollectionRuleId')]",
              "apiVersion": "2021-09-01-preview",
              "type": "Microsoft.Insights/dataCollectionRules",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "streamDeclarations": {
                  "[concat('Custom-', variables('streamName'))]": {
                    "columns": [
                      {
                        "name": "ts",
                        "type": "datetime",
                        "description": "The time at which the data was generated"
                      },
                      {
                        "name": "eventType",
                        "type": "string",
                        "description": "Event Type of the security event."
                      },
                      {
                        "name": "deviceMac",
                        "type": "string",
                        "description": "MAC address of Device"
                      },
                      {
                        "name": "clientName",
                        "type": "string",
                        "description": "Client Machine name"
                      },
                      {
                        "name": "clientMac",
                        "type": "string",
                        "description": "MAC address of Client"
                      },
                      {
                        "name": "clientIp",
                        "type": "string",
                        "description": "Client IP Address"
                      },
                      {
                        "name": "srcIp",
                        "type": "string",
                        "description": "Source IP Address"
                      },
                      {
                        "name": "destIp",
                        "type": "string",
                        "description": "Destination IP Address"
                      },
                      {
                        "name": "protocol",
                        "type": "string",
                        "description": "Protocol used"
                      },
                      {
                        "name": "priority",
                        "type": "string",
                        "description": "Priority of the Security Event"
                      },
                      {
                        "name": "uri",
                        "type": "string",
                        "description": "URI of the compromised entity"
                      },
                      {
                        "name": "classification",
                        "type": "string",
                        "description": "Classification of the Security Event"
                      },
                      {
                        "name": "canonicalName",
                        "type": "string",
                        "description": "Canonical Name of the Client Machine"
                      },
                      {
                        "name": "destinationPort",
                        "type": "int",
                        "description": "Destination Port"
                      },
                      {
                        "name": "blocked",
                        "type": "boolean",
                        "description": "If the action was blocked or not"
                      },
                      {
                        "name": "message",
                        "type": "string",
                        "description": "Security Event message"
                      },
                      {
                        "name": "signature",
                        "type": "string",
                        "description": "Signature used in the action"
                      },
                      {
                        "name": "sigSource",
                        "type": "string",
                        "description": "Source of the signature"
                      },
                      {
                        "name": "ruleId",
                        "type": "string",
                        "description": "RuleId in use"
                      },
                      {
                        "name": "fileHash",
                        "type": "string",
                        "description": "File Hash of the Scanned File"
                      },
                      {
                        "name": "fileType",
                        "type": "string",
                        "description": "File Type of the Scanned File"
                      },
                      {
                        "name": "fileSizeBytes",
                        "type": "int",
                        "description": "File Size of the Scanned File"
                      },
                      {
                        "name": "disposition",
                        "type": "string",
                        "description": "Disposition of the Scanned File"
                      },
                      {
                        "name": "action",
                        "type": "string",
                        "description": "Action performed"
                      }
                    ]
                  }
                },
                "destinations": {
                  "logAnalytics": [
                    {
                      "workspaceResourceId": "[variables('workspaceResourceId')]",
                      "name": "clv2ws1"
                    }
                  ]
                },
                "dataFlows": [
                  {
                    "streams": [
                      "[concat('Custom-', variables('streamName'))]"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source \r\n    | extend srcIpSplit = split(srcIp,':'), dstIpSplit = split(destIp,':')\r\n    | extend \r\n        TimeGenerated = ts, \r\n        EventCount = toint(1), \r\n        EventResult = \"NA\", \r\n        EventResultDetails = \"NA\", \r\n        EventProduct = \"Meraki MX\", \r\n        EventVendor = \"Cisco\", \r\n        Dvc = \"Meraki MX\",\r\n        EventType = case(\r\n                            eventType == \"IDS Alert\", \"Notable\",\r\n                            \"\"\r\n                      ),\r\n        EventSchema = case(\r\n                            eventType == \"IDS Alert\", \"NetworkSession\",\r\n                            \"\"\r\n                      ), \r\n        EventSchemaVersion = case(\r\n                            eventType == \"IDS Alert\", \"0.2.2\",\r\n                            \"\"\r\n                      ),  \r\n        EventOriginalType = eventType, \r\n        DvcMacAddr = deviceMac, \r\n        SrcMacAddr = clientMac, \r\n        SrcIpAddr = iff(isnotempty(tostring(srcIpSplit[0])),tostring(srcIpSplit[0]),clientIp), \r\n        SrcPortNumber = iif(array_length(srcIpSplit) == 2, toint(srcIpSplit[1]), int(null)), \r\n        DstIpAddr = tostring(dstIpSplit[0]), \r\n        DstPortNumber = iff(array_length(dstIpSplit) == 2,toint(dstIpSplit[1]),toint(destinationPort)), \r\n        NetworkProtocol = iif(eventType == \"IDS Alert\", iif(protocol == \"tcp\/ip\", \"TCP\", \"UDP\"), \"\"), \r\n        NetworkApplicationProtocol = iif(eventType == \"File Scanned\", protocol, \"\"), \r\n        EventOriginalSeverity = iff(isnotempty(priority), tostring(priority), disposition), \r\n        EventSeverity = case(priority == \"0\", \"High\",\r\n                             priority == \"1\", \"Medium\",\r\n                             priority == \"2\", \"Low\",\r\n                             priority == \"3\", \"Informational\", \r\n                             disposition == \"Malicious\", \"High\",\r\n                             disposition == \"Clean\", \"Informational\", \r\n                             \"Low\"),\r\n        EventMessage = message, \r\n        DvcAction = case(\r\n                          eventType == \"File Scanned\" and action == \"Blocked\", \"Deny\",\r\n                          eventType == \"IDS Alert\" and blocked, \"Deny\",\r\n                          eventType == \"IDS Alert\" and not(blocked), \"Allow\",\r\n                          \"Allow\"\r\n                        ),\r\n        NetworkRuleName = ruleId, \r\n        SrcHostname = clientName, \r\n        Url = uri, \r\n        FileHashType = \"SHA256\", \r\n        Hash = fileHash, \r\n        FileContentType = fileType, \r\n        FileSize = fileSizeBytes, \r\n        AdditionalFields = strcat(\r\n                            iff(isnotempty(canonicalName),strcat(\"canonicalName=\",canonicalName,\";\"),\"\"),\r\n                            iff(isnotempty(classification),strcat(\"classification=\",classification,\";\"),\"\"),\r\n                            iff(isnotempty(signature),strcat(\"signature=\",signature,\";\"),\"\"),\r\n                            iff(isnotempty(sigSource),strcat(\"sigSource=\",sigSource,\";\"),\"\")\r\n                        )\r\n    | extend \r\n        Rule = NetworkRuleName, \r\n        EventStartTime = TimeGenerated, \r\n        EventEndTime = TimeGenerated\r\n    | project-away \r\n        srcIpSplit, dstIpSplit",
                    "outputStream": "[concat('Custom-', variables('logAnalyticsTableId'))]"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
                "contentId": "[variables('_dataConnectorContentId1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Meraki Security Event",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', last(split(variables('_dataConnectorId1'),'/'))))]",
      "dependsOn": [
        "[variables('_dataConnectorId1')]"
      ],
      "location": "[parameters('workspace-location')]",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentId1'))]",
        "contentId": "[variables('_dataConnectorContentId1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "Cisco Meraki Security Event",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentId1'))]",
      "apiVersion": "2021-03-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
      "location": "[parameters('workspace-location')]",
      "kind": "APIPolling",
      "properties": {
        "connectorUiConfig": {
          "id": "[variables('_uiConfigId1')]",
          "title": "Cisco Meraki (using REST API)",
          "publisher": "Microsoft",
          "descriptionMarkdown": "The [Cisco Meraki](https://aka.ms/ciscomeraki) connector allows you to easily connect your Cisco Meraki MX [security events](https://aka.ms/ciscomerakisecurityevents) to Microsoft Sentinel. The data connector uses [Cisco Meraki REST API](https://developer.cisco.com/meraki/api-v1/#!get-organization-appliance-security-events) to fetch security events and supports DCR-based [ingestion time transformations](https://docs.microsoft.com/azure/azure-monitor/logs/custom-logs-overview) that parses the received security event data into a custom columns so that queries don't need to parse it again, thus resulting in better performance.\n\n **Supported ASIM schema:** \n 1. Network Session",
          "graphQueriesTableName": "[variables('logAnalyticsTableId')]",
          "graphQueries": [
            {
              "metricName": "Total events received",
              "legend": "Cisco Meraki Security Events",
              "baseQuery": "{{graphQueriesTableName}}"
            }
          ],
          "sampleQueries": [
            {
              "description": "Get Sample of Cisco Meraki Security Events",
              "query": "{{graphQueriesTableName}}\n | take 10"
            },
            {
              "description": "Total Events by Event Type",
              "query": "{{graphQueriesTableName}}\n | summarize count() by EventOriginalType"
            },
            {
              "description": "Get Rest API Data from Query Time Parser",
              "query": "CiscoMeraki\n| where Type == \"{{graphQueriesTableName}}\""
            }
          ],
          "dataTypes": [
            {
              "name": "{{graphQueriesTableName}}",
              "lastDataReceivedQuery": "{{graphQueriesTableName}}\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
            }
          ],
          "connectivityCriterias": [
            {
              "type": "SentinelKindsV2",
              "value": []
            }
          ],
          "availability": {
            "status": 1,
            "isPreview": false
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "Read and Write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "Read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key)",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ],
            "customs": [
              {
                "name": "Cisco Meraki REST API Key",
                "description": "Enable API access in Cisco Meraki and generate API Key. Please refer to Cisco Meraki official [documentation](https://aka.ms/ciscomerakiapikey) for more information."
              },
              {
                "name": "Cisco Meraki Organization Id",
                "description": "Obtain your Cisco Meraki organization id to fetch security events. Follow the steps in the [documentation](https://aka.ms/ciscomerakifindorg) to obtain the Organization Id using the Meraki API Key obtained in previous step."
              }
            ]
          },
          "instructionSteps": [
            {
              "description": "To enable Cisco Meraki Security Events for Microsoft Sentinel, provide the required information below and click on Connect.\n>This data connector depends on a parser based on a Kusto Function to render the content. [**CiscoMeraki**](https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/CiscoMeraki/Parsers/CiscoMeraki.txt) Parser currently support only \"**IDS Alert**\" and \"**File Scanned**\" Events.",
              "instructions": [
                {
                  "parameters": {
                    "enable": "true",
                    "userRequestPlaceHoldersInput": [
                      {
                        "displayText": "Organization Id",
                        "requestObjectKey": "apiEndpoint",
                        "placeHolderName": "{{organization}}"
                      }
                    ],
                    "transformation": {
                      "transformationType": "predefinedTransformation",
                      "outputStream": "[concat('Custom-', variables('streamName'))]",
                      "dataCollectionRuleTemplateSpecName": "[variables('dataCollectionRuleId')]",
                      "logAnalyticsTableTemplateSpecName": "[variables('logAnalyticsTableId')]"
                    }
                  },
                  "type": "APIKey"
                }
              ],
              "title": "Connect Cisco Meraki Security Events to Microsoft Sentinel"
            }
          ]
        },
        "pollingConfig": {
          "owner": "ASI",
          "version": "2.0",
          "source": "PaaS",
          "templateFilePath": "",
          "templateFileName": "",
          "auth": {
            "authType": "APIKey",
            "APIKeyName": "X-Cisco-Meraki-API-Key",
            "IsAPIKeyInPostPayload": false
          },
          "request": {
            "apiEndpoint": "https://api.meraki.com/api/v1/organizations/{{organization}}/appliance/security/events",
            "rateLimitQPS": 10,
            "queryWindowInMin": 5,
            "httpMethod": "GET",
            "queryTimeFormat": "UnixTimestamp",
            "startTimeAttributeName": "t0",
            "endTimeAttributeName": "t1",
            "queryParameters": {
              "perPage": 1000
            },
            "retryCount": 3,
            "timeoutInSeconds": 60,
            "headers": {
              "Accept": "application/json",
              "User-Agent": "Scuba"
            }
          },
          "paging": {
            "pagingType": "LinkHeader"
          },
          "response": {
            "eventsJsonPaths": [
              "$"
            ]
          }
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('parserTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "properties": {
        "description": "CiscoMeraki Data Parser with template",
        "displayName": "CiscoMeraki Data Parser template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('parserTemplateSpecName1'),'/',variables('parserVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Parser"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('parserTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "CiscoMeraki Data Parser with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('parserVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[variables('_parserName1')]",
              "apiVersion": "2020-08-01",
              "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
              "location": "[parameters('workspace-location')]",
              "properties": {
                "eTag": "*",
                "displayName": "CiscoMeraki",
                "category": "Samples",
                "functionAlias": "CiscoMeraki",
                "query": "\nlet MerakiSyslogDevices = pack_array(\"server1\", \"server2\"); // replace server1 and server2 with your actual Cisco Meraki device(s) and add more with comma separated\r\nunion isfuzzy=true \r\n        (\r\n\t\t\tmeraki_CL\r\n\t\t\t| project-rename LogMessage =  Message\r\n        ), \r\n        (\r\n\t\t\tSyslog\r\n\t\t\t| where Computer in (MerakiSyslogDevices)\r\n\t\t\t| project-rename LogMessage =  SyslogMessage\r\n        ),\r\n        (\r\n            CiscoMerakiNativePoller_CL\r\n            | extend LogMessage = \"\"\r\n            | extend \r\n                     Action = DvcAction, \r\n                     Message = EventMessage, \r\n                     NetworkProtocol = coalesce(NetworkProtocol, NetworkApplicationProtocol),\r\n                     Sha256 = Hash\r\n            | extend Signature = extract(@\"signature=(\\S+);\",1,tostring(AdditionalFields)),\r\n                     LogType = iff(EventOriginalType == \"IDS Alert\", \"ids-alerts\", \"security_event\")\r\n        )\r\n| extend Parser = extract_all(@\"(\\d+.\\d+)\\s([\\w\\-\\_]+)\\s([\\w\\-\\_]+)\\s([\\S\\s]+)$\", dynamic([1, 2, 3, 4]), LogMessage)[0]\r\n| extend Epoch = tostring(Parser[0]),\r\n        DeviceName = coalesce(tostring(Parser[1]),SrcHostname),\r\n        LogType = coalesce(LogType,tostring(Parser[2])),\r\n        Substring = tostring(Parser[3])        \r\n| extend EpochTimestamp = split(Epoch,\".\")\r\n| extend EventTimestamp = unixtime_seconds_todatetime(tolong(EpochTimestamp[0]))\r\n| extend EventStartTime = coalesce(EventTimestamp,EventStartTime), \r\n         EventEndTime = coalesce(unixtime_seconds_todatetime(tolong(EpochTimestamp[1])), EventEndTime)\r\n| extend SrcIpAddr = case(\r\n                        isnotempty(SrcIpAddr), SrcIpAddr,\r\n                        LogType has \"urls\", extract(@\"src=([0-9\\.]+)\\:\",1,Substring),\r\n                        LogType has \"flows\", extract(@\"src=([0-9\\.]+)\\s\",1,Substring), \r\n                        LogType has \"security_event\", extract(@\"src=([0-9\\.]+)\\:\",1,Substring), \r\n                        LogType has \"ids-alerts\", extract(@\"src=([0-9\\.]+)\\:\",1,Substring), \r\n                        LogType has \"events\", extract(@\"(peer_contact|ip_src)=\\'([0-9\\.]+)\\:\",2,Substring),\r\n                        \"\"\r\n                    ),\r\n\t\t SrcPortNumber = case(\r\n                            isnotnull(SrcPortNumber), SrcPortNumber,\r\n                            LogType has \"urls\", toint(extract(@\"src=([0-9\\.]+)\\:(\\d+)\\s\",2,Substring)),\r\n                            LogType has \"flows\", toint(extract(@\"sport=(\\S+)\",1,Substring)), \r\n                            LogType has \"security_event\", toint(extract(@\"src=([0-9\\.]+)\\:(\\d+)\",2,Substring)),\r\n                            LogType has \"ids-alerts\", toint(extract(@\"src=([0-9\\.]+)\\:(\\d+)\",2,Substring)), \r\n                            LogType has \"events\", toint(extract(@\"(peer_contact|ip_src)=\\'([0-9\\.]+)\\:(\\d+)\\'\",3,Substring)), \r\n                            int(null)\r\n                        ),\r\n\t\t DstIpAddr = case(\r\n                        isnotempty(DstIpAddr), DstIpAddr,\r\n                        LogType has \"urls\",extract(@\"dst=([0-9\\.]+)\\:\",1,Substring),\r\n                        LogType has \"flows\", extract(@\"dst=([0-9\\.]+)\\s\",1,Substring), \r\n                        LogType has \"security_event\", extract(@\"dst=([0-9\\.]+)\\:\",1,Substring),\r\n                        \"\"\r\n                    ),\r\n\t\t DstPortNumber = case(\r\n                            isnotnull(DstPortNumber), DstPortNumber,\r\n                            LogType has \"urls\", toint(extract(@\"dst=([0-9\\.]+)\\:(\\d+)\\s\",2,Substring)),\r\n                            LogType has \"flows\", toint(extract(@\"dport=(\\S+)\",1,Substring)), \r\n                            LogType has \"security_event\", toint(extract(@\"dst=([0-9\\.]+)\\:(\\d+)\",2,Substring)),\r\n                            int(null)\r\n                        ),\r\n\t\t HttpRequestMethod = iff(LogType has \"urls\", extract(@\"request: (\\w+)\\s\",1,Substring), dynamic(\"\")),   \r\n\t\t Url = case(\r\n                    isnotempty(Url), Url,\r\n                    LogType has \"urls\", extract(@\"request: (\\w+)\\s(\\S+)\",2,Substring),\r\n                    LogType has \"security_event\", tostring(extract(@\"url=(\\S+)\\s\",1,Substring)), \r\n                    \"\"),  \r\n\t\t SrcMacAddr = case(\r\n                        isnotempty(SrcMacAddr), SrcMacAddr,\r\n                        LogType has \"airmarshal_events\", tostring(extract(@\"src=\\'(\\S+)\\'\",1,Substring)),\r\n                        LogType has \"flows\", tostring(extract(@\"mac=(\\S+)\\s\",1,Substring)), \r\n                        LogType has \"security_event\", tostring(extract(@\"shost=(\\S+)\\s\",1,Substring)), \r\n                        \"\"\r\n                    ),\r\n\t\t NetworkProtocol = case(\r\n                            isnotempty(NetworkProtocol), NetworkProtocol,\r\n                            LogType has \"ids-alerts\", tostring(extract(@\"protocol=(\\w+)\\s\",1,Substring)),\r\n                            LogType has \"flows\", extract(@\"protocol=(\\w+)\\s\",1,Substring),\r\n                            LogType has \"security_event\", tostring(extract(@\"protocol=(\\w+)\\s\",1,Substring)), \r\n                            \"\"\r\n                        ),\r\n\t\t Pattern = iff(LogType has \"flows\", extract(@\"pattern\\: ([\\S\\s]+)\",1,Substring), dynamic(\"\")),   \r\n\t\t EventType = case(\r\n                        isnotempty(EventOriginalType), EventOriginalType,\r\n                        LogType has \"airmarshal_events\", tostring(extract(@\"type= (\\S+)\",1,Substring)),\r\n                        LogType has \"events\", tostring(extract(@\"type=(\\S+)\",1,Substring)), \r\n                        LogType has \"security_event\", tostring(extract(@\"^(\\S+)\\s\\w+\\:\",1,Substring)), \r\n                        \"\"\r\n                    ),\r\n\t\t Ssid = iff(LogType has \"airmarshal_events\", tostring(extract(@\"ssid=\\'(\\S+)\\'\",1,Substring)),dynamic(\"\")),  \r\n\t\t Vap = case(\r\n                    LogType has \"airmarshal_events\", toint(extract(@\"vap=\\'(\\S+)\\'\\s\",1,Substring)),\r\n                    LogType has \"events\", toint(extract(@\"vap=\\'(\\S+)\\'\\s\",1,Substring)), \r\n                    dynamic(\"\")\r\n                ),\r\n\t\t Bssid = iff(LogType has \"airmarshal_events\",tostring(extract(@\"bssid=\\'(\\S+)\\'\",1,Substring)),dynamic(\"\")),   \r\n\t\t DstMacAddr = case(\r\n                        LogType has \"airmarshal_events\", tostring(extract(@\"dst=\\'(\\S+)\\'\",1,Substring)),\r\n                        LogType has \"security_event\", tostring(extract(@\"dhost=(\\S+)\\s\",1,Substring)), \r\n                        \"\"\r\n                    ),\r\n\t\t WiredMacAddr = iff(LogType has \"airmarshal_events\", tostring(extract(@\"wired_mac=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),  \r\n\t\t Channel = case(\r\n                    LogType has \"airmarshal_events\", toint(extract(@\"channel=\\'(\\d+)\\'\",1,Substring)),\r\n                    LogType has \"events\", toint(extract(@\"channel=\\'(\\S+)\\'\",1,Substring)), \r\n                    dynamic(\"\")\r\n                ),\r\n\t\t VlanId = iff(LogType has \"airmarshal_events\", toint(extract(@\"vlan_id=\\'(\\d+)\\'\",1,Substring)), dynamic(\"\")),  \r\n\t\t Rssi = iff(LogType has \"airmarshal_events\" or LogType has \"events\", toint(extract(@\"rssi=\\'(\\d+)\\'\",1,Substring)), int(null)), \r\n\t\t FcType = iff(LogType has \"airmarshal_events\", toint(extract(@\"fc_type=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),  \r\n\t\t FcSubType = iff(LogType has \"airmarshal_events\", toint(extract(@\"fc_subtype=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t Signature = case(\r\n                    isnotempty(Signature), Signature,\r\n                    LogType has \"security_event\", tostring(extract(@\"signature=(\\S+)\\s\",1,Substring)),\r\n                    LogType has \"ids-alerts\", tostring(extract(@\"signature=(\\S+)\\s\",1,Substring)), \r\n                    \"\"\r\n                ),\r\n\t\t Priority = case(\r\n                    LogType has \"security_event\", toint(extract(@\"priority=(\\d+)\\s\",1,Substring)),\r\n                    LogType has \"ids-alerts\", toint(extract(@\"priority=(\\d+)\\s\",1,Substring)), \r\n                    dynamic(\"\")\r\n                ),\r\n\t\t EventEpoch = case(\r\n                        LogType has \"security_event\", tostring(extract(@\"timestamp=(\\S+)\\s\",1,Substring)),\r\n                        LogType has \"ids-alerts\", tostring(extract(@\"timestamp=(\\S+)\\s\",1,Substring)), \r\n                        \"\"\r\n                    ),\r\n\t\t NetworkDirection = case(\r\n                            LogType has \"security_event\", tostring(extract(@\"direction=(\\S+)\",1,Substring)),\r\n                            LogType has \"ids-alerts\", tostring(extract(@\"direction=(\\S+)\",1,Substring)), \r\n                            \"\"\r\n                        ),\r\n\t\t Action = case(\r\n                            isnotempty(Action), Action,\r\n                            LogType has \"security_event\", tostring(extract(@\"action=(\\w+)\",1,Substring)),\r\n                            \"\"\r\n                    ),\r\n\t\t Message = iff(LogType has \"security_event\", tostring(extract(@\"message: ([\\w\\.\\-\\+\\,\\s]+)(\\s\\w+\\=)?\",1,Substring)), Message),\r\n\t\t VpnType = iff(LogType has \"events\",  tostring(extract(@\"vpn_type=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t PeerIdentity = iff(LogType has \"events\",  tostring(extract(@\"peer_ident=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t Radio = iff(LogType has \"events\",  toint(extract(@\"radio=\\'(\\d+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t Group = iff(LogType has \"events\",  toint(extract(@\"group=\\'(\\S+)?\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t Attribute = iff(LogType has \"events\",  toint(extract(@\"attr=\\'(\\S+)?\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t ClientMacAddr = case(\r\n                        isnotempty(SrcMacAddr), SrcMacAddr,\r\n                        LogType has \"events\",  tostring(extract(@\"client_mac=\\'(\\S+)\\'\",1,Substring)),\r\n                        \"\"\r\n                ),\r\n\t\t Reason = iff(LogType has \"events\",  toint(extract(@\"reason=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t AppleDaReason = iff(LogType has \"events\",  toint(extract(@\"apple_da_reason=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t Duration = iff(LogType has \"events\",  tostring(extract(@\"duration=\\'(\\S+)\\'\",1,Substring)), \"\"),\r\n\t\t FullConn = iff(LogType has \"events\",  tostring(extract(@\"full_conn=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t IpResp = iff(LogType has \"events\",  tostring(extract(@\"ip_resp=\\'(\\S+)\\'\\s\",1,Substring)), dynamic(\"\")),\r\n\t\t HttpResp = iff(LogType has \"events\",  tostring(extract(@\"http_resp=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t ArpResp = iff(LogType has \"events\",  tostring(extract(@\"arp_resp=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t ArpSrcIpAddr = case(\r\n                        isnotempty(SrcIpAddr), SrcIpAddr,\r\n                        LogType has \"events\",  tostring(extract(@\"arp_src=\\'(\\S+)\\'\",1,Substring)),\r\n                        \"\"\r\n                ),\r\n\t\t Connectivity = iff(LogType has \"events\",  tostring(extract(@\"connectivity=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t Rtt = iff(LogType has \"events\",  tostring(extract(@\"rtt=\\'([\\w+\\.\\s]+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t UserName = iff(LogType has \"events\",  tostring(extract(@\"identity=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t Aid = iff(LogType has \"events\",  tostring(extract(@\"aid=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t Spi = iff(LogType has \"events\",  tostring(extract(@\"spi=(\\S+)$\",1,Substring)), dynamic(\"\")),\r\n\t\t DvcMacAddr = case(\r\n                        isnotempty(DvcMacAddr), DvcMacAddr,\r\n                        LogType has \"events\",  tostring(extract(@\"device=\\'(\\S+)\\'\",1,Substring)),\r\n                        \"\"\r\n                ),\r\n\t\t State = iff(LogType has \"events\",  tostring(extract(@\"state=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t AlarmId = iff(LogType has \"events\",  toint(extract(@\"alarm_id=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t DosCount = iff(LogType has \"events\",  tostring(extract(@\"dos_count=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t InterArrival = iff(LogType has \"events\",  tostring(extract(@\"inter_arrival=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t LogTimestamp = case(\r\n                            isnotnull(EventStartTime), EventStartTime,\r\n                            LogType has \"security_event\", unixtime_seconds_todatetime(tolong(split(tostring(extract(@\"timestamp=(\\S+)\\s\",1,Substring)),\".\")[0])),\r\n                            LogType has \"ids-alerts\", unixtime_seconds_todatetime(tolong(split(tostring(extract(@\"timestamp=(\\S+)\\s\",1,Substring)),\".\")[0])), \r\n                            datetime(null)\r\n                        ),\r\n\t\t IpAddr = iff(LogType has \"events\", tostring(extract(@\"dhcp lease of ip ([\\d\\.]+)\", 1, Substring)), dynamic(\"\")),\r\n\t\t ServerMacAddr = iff(LogType has \"events\", tostring(extract(@\"server mac ([\\w\\:]+)\", 1, Substring)), dynamic(\"\")),\r\n\t\t RouterIpAddr = iff(LogType has \"events\", tostring(extract(@\"router ([\\d\\.]+)\", 1, Substring)), dynamic(\"\")),\r\n\t\t Subnet = iff(LogType has \"events\",  tostring(extract(@\"subnet ([\\d\\.]+)\", 1, Substring)), dynamic(\"\")),\r\n\t\t Dns = iff(LogType has \"events\",  split(extract(@\"dns ([\\d\\.\\,\\:\\s]+)\", 1, Substring), \", \"), dynamic(\"\"))\r\n| extend \r\n            ClientMacAddr = iif(isempty(ClientMacAddr), tostring(extract(@\"client mac ([\\w\\:]+)\", 1, Substring)), ClientMacAddr),\r\n\t\t    SrcPortNumber = iif(isempty(SrcPortNumber), toint(extract(@\"port=\\'(\\S+)\\'\",1,Substring)), SrcPortNumber), \r\n            Dns = iif(Dns[0] == \"\", \"\", Dns)\r\n| extend LogType = case(\r\n                    isnotempty(LogType), LogType,\r\n                    LogType !in (\"urls\", \"airmarshal_events\",\"security_event\",\"ids-alerts\", \"events\") and LogType !contains \"flows\", iif(isempty(LogType), \"\", LogType), \r\n                    \"\"\r\n                ),\r\n         NetworkProtocol = case(NetworkProtocol has \"tcp\", \"TCP\",\r\n                                NetworkProtocol has \"udp\", \"UDP\",\r\n                                \"\"),\r\n         EventSeverity = case(\r\n                             isnotempty(EventSeverity), EventSeverity,\r\n                              Priority == 1, \"High\",\r\n                              Priority == 2, \"Medium\",\r\n                              Priority == 3, \"Low\",\r\n                              Priority == 4, \"Infomational\",\r\n                              \"\"),\r\n        Disposition = case(\r\n                            EventType contains \"File Scanned\", tolower(EventOriginalSeverity),\r\n                            LogType has \"security_event\", tostring(extract(@\"disposition=(\\w+)\",1,Substring)),\r\n                            \"\"\r\n                        ),\r\n        Sha256 = case (\r\n                            EventType == \"File Scanned\", Sha256,\r\n                            LogType has \"security_event\",  tostring(extract(@\"sha256=(\\S+)?\",1,Substring)),\r\n                            \"\"\r\n                        ),\r\n        Action = case(\r\n                            Action == \"block\", \"deny\",\r\n                            tolower(Action)\r\n            )\r\n| project-away Substring, Parser",
                "version": 2,
                "tags": [
                  {
                    "name": "description",
                    "value": "CiscoMeraki"
                  }
                ]
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId1'),'/'))))]",
              "dependsOn": [
                "[variables('_parserName1')]"
              ],
              "properties": {
                "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
                "contentId": "[variables('_parserContentId1')]",
                "kind": "Parser",
                "version": "[variables('parserVersion1')]",
                "source": {
                  "name": "Cisco Meraki Security Event",
                  "kind": "Solution",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2021-06-01",
      "name": "[variables('_parserName1')]",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "eTag": "*",
        "displayName": "Cisco Meraki Data Parser",
        "category": "Samples",
        "functionAlias": "CiscoMeraki",
        "query": "\nlet MerakiSyslogDevices = pack_array(\"server1\", \"server2\"); // replace server1 and server2 with your actual Cisco Meraki device(s) and add more with comma separated\r\nunion isfuzzy=true \r\n        (\r\n\t\t\tmeraki_CL\r\n\t\t\t| project-rename LogMessage =  Message\r\n        ), \r\n        (\r\n\t\t\tSyslog\r\n\t\t\t| where Computer in (MerakiSyslogDevices)\r\n\t\t\t| project-rename LogMessage =  SyslogMessage\r\n        ),\r\n        (\r\n            CiscoMerakiNativePoller_CL\r\n            | extend LogMessage = \"\"\r\n            | extend \r\n                     Action = DvcAction, \r\n                     Message = EventMessage, \r\n                     NetworkProtocol = coalesce(NetworkProtocol, NetworkApplicationProtocol),\r\n                     Sha256 = Hash\r\n            | extend Signature = extract(@\"signature=(\\S+);\",1,tostring(AdditionalFields)),\r\n                     LogType = iff(EventOriginalType == \"IDS Alert\", \"ids-alerts\", \"security_event\")\r\n        )\r\n| extend Parser = extract_all(@\"(\\d+.\\d+)\\s([\\w\\-\\_]+)\\s([\\w\\-\\_]+)\\s([\\S\\s]+)$\", dynamic([1, 2, 3, 4]), LogMessage)[0]\r\n| extend Epoch = tostring(Parser[0]),\r\n        DeviceName = coalesce(tostring(Parser[1]),SrcHostname),\r\n        LogType = coalesce(LogType,tostring(Parser[2])),\r\n        Substring = tostring(Parser[3])        \r\n| extend EpochTimestamp = split(Epoch,\".\")\r\n| extend EventTimestamp = unixtime_seconds_todatetime(tolong(EpochTimestamp[0]))\r\n| extend EventStartTime = coalesce(EventTimestamp,EventStartTime), \r\n         EventEndTime = coalesce(unixtime_seconds_todatetime(tolong(EpochTimestamp[1])), EventEndTime)\r\n| extend SrcIpAddr = case(\r\n                        isnotempty(SrcIpAddr), SrcIpAddr,\r\n                        LogType has \"urls\", extract(@\"src=([0-9\\.]+)\\:\",1,Substring),\r\n                        LogType has \"flows\", extract(@\"src=([0-9\\.]+)\\s\",1,Substring), \r\n                        LogType has \"security_event\", extract(@\"src=([0-9\\.]+)\\:\",1,Substring), \r\n                        LogType has \"ids-alerts\", extract(@\"src=([0-9\\.]+)\\:\",1,Substring), \r\n                        LogType has \"events\", extract(@\"(peer_contact|ip_src)=\\'([0-9\\.]+)\\:\",2,Substring),\r\n                        \"\"\r\n                    ),\r\n\t\t SrcPortNumber = case(\r\n                            isnotnull(SrcPortNumber), SrcPortNumber,\r\n                            LogType has \"urls\", toint(extract(@\"src=([0-9\\.]+)\\:(\\d+)\\s\",2,Substring)),\r\n                            LogType has \"flows\", toint(extract(@\"sport=(\\S+)\",1,Substring)), \r\n                            LogType has \"security_event\", toint(extract(@\"src=([0-9\\.]+)\\:(\\d+)\",2,Substring)),\r\n                            LogType has \"ids-alerts\", toint(extract(@\"src=([0-9\\.]+)\\:(\\d+)\",2,Substring)), \r\n                            LogType has \"events\", toint(extract(@\"(peer_contact|ip_src)=\\'([0-9\\.]+)\\:(\\d+)\\'\",3,Substring)), \r\n                            int(null)\r\n                        ),\r\n\t\t DstIpAddr = case(\r\n                        isnotempty(DstIpAddr), DstIpAddr,\r\n                        LogType has \"urls\",extract(@\"dst=([0-9\\.]+)\\:\",1,Substring),\r\n                        LogType has \"flows\", extract(@\"dst=([0-9\\.]+)\\s\",1,Substring), \r\n                        LogType has \"security_event\", extract(@\"dst=([0-9\\.]+)\\:\",1,Substring),\r\n                        \"\"\r\n                    ),\r\n\t\t DstPortNumber = case(\r\n                            isnotnull(DstPortNumber), DstPortNumber,\r\n                            LogType has \"urls\", toint(extract(@\"dst=([0-9\\.]+)\\:(\\d+)\\s\",2,Substring)),\r\n                            LogType has \"flows\", toint(extract(@\"dport=(\\S+)\",1,Substring)), \r\n                            LogType has \"security_event\", toint(extract(@\"dst=([0-9\\.]+)\\:(\\d+)\",2,Substring)),\r\n                            int(null)\r\n                        ),\r\n\t\t HttpRequestMethod = iff(LogType has \"urls\", extract(@\"request: (\\w+)\\s\",1,Substring), dynamic(\"\")),   \r\n\t\t Url = case(\r\n                    isnotempty(Url), Url,\r\n                    LogType has \"urls\", extract(@\"request: (\\w+)\\s(\\S+)\",2,Substring),\r\n                    LogType has \"security_event\", tostring(extract(@\"url=(\\S+)\\s\",1,Substring)), \r\n                    \"\"),  \r\n\t\t SrcMacAddr = case(\r\n                        isnotempty(SrcMacAddr), SrcMacAddr,\r\n                        LogType has \"airmarshal_events\", tostring(extract(@\"src=\\'(\\S+)\\'\",1,Substring)),\r\n                        LogType has \"flows\", tostring(extract(@\"mac=(\\S+)\\s\",1,Substring)), \r\n                        LogType has \"security_event\", tostring(extract(@\"shost=(\\S+)\\s\",1,Substring)), \r\n                        \"\"\r\n                    ),\r\n\t\t NetworkProtocol = case(\r\n                            isnotempty(NetworkProtocol), NetworkProtocol,\r\n                            LogType has \"ids-alerts\", tostring(extract(@\"protocol=(\\w+)\\s\",1,Substring)),\r\n                            LogType has \"flows\", extract(@\"protocol=(\\w+)\\s\",1,Substring),\r\n                            LogType has \"security_event\", tostring(extract(@\"protocol=(\\w+)\\s\",1,Substring)), \r\n                            \"\"\r\n                        ),\r\n\t\t Pattern = iff(LogType has \"flows\", extract(@\"pattern\\: ([\\S\\s]+)\",1,Substring), dynamic(\"\")),   \r\n\t\t EventType = case(\r\n                        isnotempty(EventOriginalType), EventOriginalType,\r\n                        LogType has \"airmarshal_events\", tostring(extract(@\"type= (\\S+)\",1,Substring)),\r\n                        LogType has \"events\", tostring(extract(@\"type=(\\S+)\",1,Substring)), \r\n                        LogType has \"security_event\", tostring(extract(@\"^(\\S+)\\s\\w+\\:\",1,Substring)), \r\n                        \"\"\r\n                    ),\r\n\t\t Ssid = iff(LogType has \"airmarshal_events\", tostring(extract(@\"ssid=\\'(\\S+)\\'\",1,Substring)),dynamic(\"\")),  \r\n\t\t Vap = case(\r\n                    LogType has \"airmarshal_events\", toint(extract(@\"vap=\\'(\\S+)\\'\\s\",1,Substring)),\r\n                    LogType has \"events\", toint(extract(@\"vap=\\'(\\S+)\\'\\s\",1,Substring)), \r\n                    dynamic(\"\")\r\n                ),\r\n\t\t Bssid = iff(LogType has \"airmarshal_events\",tostring(extract(@\"bssid=\\'(\\S+)\\'\",1,Substring)),dynamic(\"\")),   \r\n\t\t DstMacAddr = case(\r\n                        LogType has \"airmarshal_events\", tostring(extract(@\"dst=\\'(\\S+)\\'\",1,Substring)),\r\n                        LogType has \"security_event\", tostring(extract(@\"dhost=(\\S+)\\s\",1,Substring)), \r\n                        \"\"\r\n                    ),\r\n\t\t WiredMacAddr = iff(LogType has \"airmarshal_events\", tostring(extract(@\"wired_mac=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),  \r\n\t\t Channel = case(\r\n                    LogType has \"airmarshal_events\", toint(extract(@\"channel=\\'(\\d+)\\'\",1,Substring)),\r\n                    LogType has \"events\", toint(extract(@\"channel=\\'(\\S+)\\'\",1,Substring)), \r\n                    dynamic(\"\")\r\n                ),\r\n\t\t VlanId = iff(LogType has \"airmarshal_events\", toint(extract(@\"vlan_id=\\'(\\d+)\\'\",1,Substring)), dynamic(\"\")),  \r\n\t\t Rssi = iff(LogType has \"airmarshal_events\" or LogType has \"events\", toint(extract(@\"rssi=\\'(\\d+)\\'\",1,Substring)), int(null)), \r\n\t\t FcType = iff(LogType has \"airmarshal_events\", toint(extract(@\"fc_type=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),  \r\n\t\t FcSubType = iff(LogType has \"airmarshal_events\", toint(extract(@\"fc_subtype=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t Signature = case(\r\n                    isnotempty(Signature), Signature,\r\n                    LogType has \"security_event\", tostring(extract(@\"signature=(\\S+)\\s\",1,Substring)),\r\n                    LogType has \"ids-alerts\", tostring(extract(@\"signature=(\\S+)\\s\",1,Substring)), \r\n                    \"\"\r\n                ),\r\n\t\t Priority = case(\r\n                    LogType has \"security_event\", toint(extract(@\"priority=(\\d+)\\s\",1,Substring)),\r\n                    LogType has \"ids-alerts\", toint(extract(@\"priority=(\\d+)\\s\",1,Substring)), \r\n                    dynamic(\"\")\r\n                ),\r\n\t\t EventEpoch = case(\r\n                        LogType has \"security_event\", tostring(extract(@\"timestamp=(\\S+)\\s\",1,Substring)),\r\n                        LogType has \"ids-alerts\", tostring(extract(@\"timestamp=(\\S+)\\s\",1,Substring)), \r\n                        \"\"\r\n                    ),\r\n\t\t NetworkDirection = case(\r\n                            LogType has \"security_event\", tostring(extract(@\"direction=(\\S+)\",1,Substring)),\r\n                            LogType has \"ids-alerts\", tostring(extract(@\"direction=(\\S+)\",1,Substring)), \r\n                            \"\"\r\n                        ),\r\n\t\t Action = case(\r\n                            isnotempty(Action), Action,\r\n                            LogType has \"security_event\", tostring(extract(@\"action=(\\w+)\",1,Substring)),\r\n                            \"\"\r\n                    ),\r\n\t\t Message = iff(LogType has \"security_event\", tostring(extract(@\"message: ([\\w\\.\\-\\+\\,\\s]+)(\\s\\w+\\=)?\",1,Substring)), Message),\r\n\t\t VpnType = iff(LogType has \"events\",  tostring(extract(@\"vpn_type=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t PeerIdentity = iff(LogType has \"events\",  tostring(extract(@\"peer_ident=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t Radio = iff(LogType has \"events\",  toint(extract(@\"radio=\\'(\\d+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t Group = iff(LogType has \"events\",  toint(extract(@\"group=\\'(\\S+)?\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t Attribute = iff(LogType has \"events\",  toint(extract(@\"attr=\\'(\\S+)?\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t ClientMacAddr = case(\r\n                        isnotempty(SrcMacAddr), SrcMacAddr,\r\n                        LogType has \"events\",  tostring(extract(@\"client_mac=\\'(\\S+)\\'\",1,Substring)),\r\n                        \"\"\r\n                ),\r\n\t\t Reason = iff(LogType has \"events\",  toint(extract(@\"reason=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t AppleDaReason = iff(LogType has \"events\",  toint(extract(@\"apple_da_reason=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t Duration = iff(LogType has \"events\",  tostring(extract(@\"duration=\\'(\\S+)\\'\",1,Substring)), \"\"),\r\n\t\t FullConn = iff(LogType has \"events\",  tostring(extract(@\"full_conn=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t IpResp = iff(LogType has \"events\",  tostring(extract(@\"ip_resp=\\'(\\S+)\\'\\s\",1,Substring)), dynamic(\"\")),\r\n\t\t HttpResp = iff(LogType has \"events\",  tostring(extract(@\"http_resp=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t ArpResp = iff(LogType has \"events\",  tostring(extract(@\"arp_resp=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t ArpSrcIpAddr = case(\r\n                        isnotempty(SrcIpAddr), SrcIpAddr,\r\n                        LogType has \"events\",  tostring(extract(@\"arp_src=\\'(\\S+)\\'\",1,Substring)),\r\n                        \"\"\r\n                ),\r\n\t\t Connectivity = iff(LogType has \"events\",  tostring(extract(@\"connectivity=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t Rtt = iff(LogType has \"events\",  tostring(extract(@\"rtt=\\'([\\w+\\.\\s]+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t UserName = iff(LogType has \"events\",  tostring(extract(@\"identity=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t Aid = iff(LogType has \"events\",  tostring(extract(@\"aid=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t Spi = iff(LogType has \"events\",  tostring(extract(@\"spi=(\\S+)$\",1,Substring)), dynamic(\"\")),\r\n\t\t DvcMacAddr = case(\r\n                        isnotempty(DvcMacAddr), DvcMacAddr,\r\n                        LogType has \"events\",  tostring(extract(@\"device=\\'(\\S+)\\'\",1,Substring)),\r\n                        \"\"\r\n                ),\r\n\t\t State = iff(LogType has \"events\",  tostring(extract(@\"state=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t AlarmId = iff(LogType has \"events\",  toint(extract(@\"alarm_id=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t DosCount = iff(LogType has \"events\",  tostring(extract(@\"dos_count=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t InterArrival = iff(LogType has \"events\",  tostring(extract(@\"inter_arrival=\\'(\\S+)\\'\",1,Substring)), dynamic(\"\")),\r\n\t\t LogTimestamp = case(\r\n                            isnotnull(EventStartTime), EventStartTime,\r\n                            LogType has \"security_event\", unixtime_seconds_todatetime(tolong(split(tostring(extract(@\"timestamp=(\\S+)\\s\",1,Substring)),\".\")[0])),\r\n                            LogType has \"ids-alerts\", unixtime_seconds_todatetime(tolong(split(tostring(extract(@\"timestamp=(\\S+)\\s\",1,Substring)),\".\")[0])), \r\n                            datetime(null)\r\n                        ),\r\n\t\t IpAddr = iff(LogType has \"events\", tostring(extract(@\"dhcp lease of ip ([\\d\\.]+)\", 1, Substring)), dynamic(\"\")),\r\n\t\t ServerMacAddr = iff(LogType has \"events\", tostring(extract(@\"server mac ([\\w\\:]+)\", 1, Substring)), dynamic(\"\")),\r\n\t\t RouterIpAddr = iff(LogType has \"events\", tostring(extract(@\"router ([\\d\\.]+)\", 1, Substring)), dynamic(\"\")),\r\n\t\t Subnet = iff(LogType has \"events\",  tostring(extract(@\"subnet ([\\d\\.]+)\", 1, Substring)), dynamic(\"\")),\r\n\t\t Dns = iff(LogType has \"events\",  split(extract(@\"dns ([\\d\\.\\,\\:\\s]+)\", 1, Substring), \", \"), dynamic(\"\"))\r\n| extend \r\n            ClientMacAddr = iif(isempty(ClientMacAddr), tostring(extract(@\"client mac ([\\w\\:]+)\", 1, Substring)), ClientMacAddr),\r\n\t\t    SrcPortNumber = iif(isempty(SrcPortNumber), toint(extract(@\"port=\\'(\\S+)\\'\",1,Substring)), SrcPortNumber), \r\n            Dns = iif(Dns[0] == \"\", \"\", Dns)\r\n| extend LogType = case(\r\n                    isnotempty(LogType), LogType,\r\n                    LogType !in (\"urls\", \"airmarshal_events\",\"security_event\",\"ids-alerts\", \"events\") and LogType !contains \"flows\", iif(isempty(LogType), \"\", LogType), \r\n                    \"\"\r\n                ),\r\n         NetworkProtocol = case(NetworkProtocol has \"tcp\", \"TCP\",\r\n                                NetworkProtocol has \"udp\", \"UDP\",\r\n                                \"\"),\r\n         EventSeverity = case(\r\n                             isnotempty(EventSeverity), EventSeverity,\r\n                              Priority == 1, \"High\",\r\n                              Priority == 2, \"Medium\",\r\n                              Priority == 3, \"Low\",\r\n                              Priority == 4, \"Infomational\",\r\n                              \"\"),\r\n        Disposition = case(\r\n                            EventType contains \"File Scanned\", tolower(EventOriginalSeverity),\r\n                            LogType has \"security_event\", tostring(extract(@\"disposition=(\\w+)\",1,Substring)),\r\n                            \"\"\r\n                        ),\r\n        Sha256 = case (\r\n                            EventType == \"File Scanned\", Sha256,\r\n                            LogType has \"security_event\",  tostring(extract(@\"sha256=(\\S+)?\",1,Substring)),\r\n                            \"\"\r\n                        ),\r\n        Action = case(\r\n                            Action == \"block\", \"deny\",\r\n                            tolower(Action)\r\n            )\r\n| project-away Substring, Parser",
        "version": 2
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Parser-', last(split(variables('_parserId1'),'/'))))]",
      "dependsOn": [
        "[variables('_parserId1')]"
      ],
      "properties": {
        "parentId": "[resourceId('Microsoft.OperationalInsights/workspaces/savedSearches', parameters('workspace'), variables('parserName1'))]",
        "contentId": "[variables('_parserContentId1')]",
        "kind": "Parser",
        "version": "[variables('parserVersion1')]",
        "source": {
          "kind": "Solution",
          "name": "Cisco Meraki Security Event",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        }
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs",
      "apiVersion": "2021-05-01",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Workbook"
      },
      "properties": {
        "description": "Cisco Meraki Security Event Workbook with template",
        "displayName": "Cisco Meraki Security Event workbook template"
      }
    },
    {
      "type": "Microsoft.Resources/templateSpecs/versions",
      "apiVersion": "2021-05-01",
      "name": "[concat(variables('workbookTemplateSpecName1'),'/',variables('workbookVersion1'))]",
      "location": "[parameters('workspace-location')]",
      "tags": {
        "hidden-sentinelWorkspaceId": "[variables('workspaceResourceId')]",
        "hidden-sentinelContentType": "Workbook"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Resources/templateSpecs', variables('workbookTemplateSpecName1'))]"
      ],
      "properties": {
        "description": "CiscoMerakiWorkbookWorkbook Workbook with template version 2.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Gain insights into the Events from Cisco Meraki Solution and analyzing all the different types of Security Events. This workbook also helps in identifying the Events from affected devices, IPs and the nodes where malware was successfully detected.\n IP data received in Events is correlated with Threat Intelligence to identify if the reported IP address is known bad based on threat intelligence data."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Cisco Meraki\"},\"name\":\"textWorkbookTitle\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"c3f513c2-4160-4261-9ac0-d98aa05599bd\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"label\":\"Subscription Name\",\"type\":6,\"description\":\"Select the Subscription Name that will be used for the queries\",\"isRequired\":true,\"typeSettings\":{\"includeAll\":true,\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"d13a868b-818e-483a-b601-81ff9bee3097\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"description\":\"Select the Workspce Name that will be used for the queries.\",\"isRequired\":true,\"typeSettings\":{\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"1e854ea2-2ffd-4cb0-a63b-e941b422f752\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"description\":\"Select the Time Range that will be used for the queries.\",\"isRequired\":true,\"value\":{\"durationMs\":2592000000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parametersAllTabs\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"570639ed-d7a3-4fca-86be-4b2b28cf39c1\",\"cellValue\":\"VisibleTabName\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Summary\",\"subTarget\":\"summary\",\"style\":\"link\"},{\"id\":\"79a2acf6-7858-4a8d-ad27-cf84211b3505\",\"cellValue\":\"VisibleTabName\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Events from Device\",\"subTarget\":\"DeviceThreats\",\"style\":\"link\"},{\"id\":\"f767421e-ac72-46a5-b33a-1ea6bd24db09\",\"cellValue\":\"VisibleTabName\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Events from IP\",\"subTarget\":\"IPThreats\",\"style\":\"link\"},{\"id\":\"7573a16c-8c26-4d4c-9b51-53b527bc4e78\",\"cellValue\":\"VisibleTabName\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Malware Detected\",\"subTarget\":\"MalwareThreats\",\"style\":\"link\"},{\"id\":\"9be11d6c-f6f7-4e9c-b1ba-33b8c377aa37\",\"cellValue\":\"VisibleTabName\",\"linkTarget\":\"parameter\",\"linkLabel\":\"All Events\",\"subTarget\":\"allEvents\",\"style\":\"link\"}]},\"name\":\"tabs\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"4ebf255c-233d-44bc-9cfb-7d21559344fa\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SelectLogType\",\"label\":\"Log Types\",\"type\":2,\"description\":\"Select the Log Type to filter the data\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"\\\"\",\"delimiter\":\",\",\"query\":\"CiscoMeraki\\r\\n| distinct LogType\\r\\n| extend LogType = iff(isempty(LogType),\\\"empty\\\",LogType)\\r\\n| sort by LogType asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"2158e08c-7ff7-435a-8ab6-d84bac37ca69\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SelectNetworkDirection\",\"label\":\"Network Direction\",\"type\":2,\"description\":\"Select the Network Direction to filter the data\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"\\\"\",\"delimiter\":\",\",\"query\":\"CiscoMeraki\\r\\n| distinct NetworkDirection\\r\\n| extend NetworkDirection = iif(isempty(NetworkDirection),\\\"empty\\\",NetworkDirection)\\r\\n| order by NetworkDirection asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parametersSummaryTab\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoMeraki\\r\\n| extend LogType = iif(isempty(LogType),\\\"empty\\\",LogType)\\r\\n| where LogType in ('' {SelectLogType})\\r\\n| extend NetworkDirection = iif(isempty(NetworkDirection),\\\"empty\\\",NetworkDirection)\\r\\n| where NetworkDirection in ('' {SelectNetworkDirection})\\r\\n| make-series Trend = count() default = 0 on TimeGenerated step 1h by LogType\",\"size\":0,\"title\":\"Total Events by Log Type\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"timeBrushParameterName\":\"TimeRangeLogType\",\"exportFieldName\":\"LogType\",\"exportParameterName\":\"SelectedLogType\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\",\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"timelineLogType\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoMeraki\\r\\n| where bin(TimeGenerated,1h) {TimeRangeLogType}\\r\\n| extend LogType = iff(isempty(LogType),\\\"empty\\\",LogType)\\r\\n| where LogType in ('' {SelectLogType})\\r\\n| extend NetworkDirection = iif(isempty(NetworkDirection),\\\"empty\\\",NetworkDirection)\\r\\n| where NetworkDirection in ('' {SelectNetworkDirection})\\r\\n| project TimeGenerated, DeviceName, LogType, EventType, SrcIpAddr, SrcPortNumber, SrcMacAddr, DstIpAddr, DstPortNumber, DstMacAddr, HttpRequestMethod, Url,  NetworkProtocol, NetworkDirection\\r\\n| order by TimeGenerated\",\"size\":0,\"title\":\"Total Events by Log Type - Details\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"timelineLogTypeDetails\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoMeraki\\r\\n| where LogType in ('' {SelectLogType})\\r\\n| where isnotempty(EventType)\\r\\n| summarize count() by EventType\\r\\n| sort by count_ \",\"size\":0,\"title\":\"Total Events by Event Type\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"exportMultipleValues\":true,\"exportedParameters\":[{\"fieldName\":\"EventType\",\"parameterName\":\"EventType\",\"parameterType\":1}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"blueDark\"}}]},\"mapSettings\":{\"locInfo\":\"LatLong\",\"sizeSettings\":\"count_\",\"sizeAggregation\":\"Sum\",\"legendMetric\":\"count_\",\"legendAggregation\":\"Sum\",\"itemColorSettings\":{\"type\":\"heatmap\",\"colorAggregation\":\"Sum\",\"nodeColorField\":\"count_\",\"heatmapPalette\":\"greenRed\"}}},\"customWidth\":\"50\",\"name\":\"topEventType\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoMeraki \\r\\n| where LogType in ('' {SelectLogType})\\r\\n| where isnotempty(EventType) and EventType in ('' {EventType:value})\\r\\n| project DeviceName, LogType, EventType, SrcIpAddr, SrcPortNumber, SrcMacAddr, DstIpAddr, DstPortNumber, DstMacAddr\",\"size\":0,\"title\":\"Total Events by Event Type - Details\",\"noDataMessage\":\"Please select Event Type(s) from the left section to view results.\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"SyslogMessage_s\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"100ch\"}}]}},\"customWidth\":\"50\",\"name\":\"topEventTypeDetails\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoMeraki\\r\\n| extend LogType = iif(isempty(LogType),\\\"empty\\\",LogType)\\r\\n| where LogType in ('' {SelectLogType})\\r\\n| extend NetworkDirection = iif(isempty(NetworkDirection),\\\"empty\\\",NetworkDirection)\\r\\n| where NetworkDirection in ('' {SelectNetworkDirection})\\r\\n| make-series Trend = count() default = 0 on TimeGenerated step 1h by NetworkDirection\",\"size\":0,\"title\":\"Total Events by Network Direction\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"timeBrushParameterName\":\"TimeRangeNetworkDirection\",\"exportFieldName\":\"LogType\",\"exportParameterName\":\"SelectedLogType\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\",\"chartSettings\":{\"showLegend\":true}},\"customWidth\":\"50\",\"name\":\"timelineNetworkDirection\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoMeraki\\r\\n| where bin(TimeGenerated,1h) {TimeRangeNetworkDirection}\\r\\n| extend LogType = iif(isempty(LogType),\\\"empty\\\",LogType)\\r\\n| where LogType in ('' {SelectLogType})\\r\\n| extend NetworkDirection = iff(isempty(NetworkDirection),\\\"empty\\\",NetworkDirection)\\r\\n| where NetworkDirection in ('' {SelectNetworkDirection})\\r\\n| project TimeGenerated, DeviceName, LogType, EventType, SrcIpAddr, SrcPortNumber, SrcMacAddr, DstIpAddr, DstPortNumber, DstMacAddr, HttpRequestMethod, Url,NetworkProtocol, NetworkDirection\\r\\n| order by TimeGenerated\\r\\n\",\"size\":0,\"title\":\"Total Events by Network Direction - Details\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"name\":\"timelineNetworkDirectionDetails\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoMeraki\\r\\n| extend NetworkProtocol = iff(isempty(NetworkProtocol),\\\"empty\\\",NetworkProtocol)\\r\\n| extend LogType = iif(isempty(LogType),\\\"empty\\\",LogType)\\r\\n| where LogType in ('' {SelectLogType})\\r\\n| extend NetworkDirection = iif(isempty(NetworkDirection),\\\"empty\\\",NetworkDirection)\\r\\n| where NetworkDirection in ('' {SelectNetworkDirection})\\r\\n| summarize count() by NetworkProtocol\",\"size\":2,\"title\":\"Total Events by Network Protocol\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"NetworkProtocol\",\"exportParameterName\":\"SelectedNetworkProtocol\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"eventsNetworkProtocol\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoMeraki\\r\\n| extend NetworkProtocol = iff(isempty(NetworkProtocol),\\\"empty\\\",NetworkProtocol)\\r\\n| extend LogType = iif(isempty(LogType),\\\"empty\\\",LogType)\\r\\n| where LogType in ('' {SelectLogType})\\r\\n| extend NetworkDirection = iif(isempty(NetworkDirection),\\\"empty\\\",NetworkDirection)\\r\\n| where NetworkDirection in ('' {SelectNetworkDirection})\\r\\n| summarize count() by Action\",\"size\":2,\"title\":\"Total Events by State\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"name\":\"eventState\"}]},\"conditionalVisibility\":{\"parameterName\":\"VisibleTabName\",\"comparison\":\"isEqualTo\",\"value\":\"summary\"},\"name\":\"summary\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"bdcc13aa-9775-4bb2-9a61-ce37703d57dd\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SelectLogType\",\"label\":\"Log Types\",\"type\":2,\"description\":\"Select the Log Type to filter the data\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"\\\"\",\"delimiter\":\",\",\"query\":\"CiscoMeraki\\r\\n| distinct LogType\\r\\n| extend LogType = iff(isempty(LogType),\\\"empty\\\",LogType)\\r\\n| sort by LogType asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parametersDeviceEvents\"},{\"type\":1,\"content\":{\"json\":\"Found_in_Threat_Intel correlates SrcIPAddr and DestIPAddr with Threat Intelligence data present in Sentinel. This helps identify new threat intelligence information that you can use to further enhance your overall security posture. \\r\\n\",\"style\":\"info\"},\"showPin\":false,\"name\":\"noteDeviceEvents\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoMeraki\\r\\n| where isnotempty(DeviceName)\\r\\n| extend LogType = iif(isempty(LogType), \\\"empty\\\", LogType)\\r\\n| where LogType in ('' {SelectLogType})\\r\\n| summarize count() by DeviceName\\r\\n| project-rename Network_Device_name = DeviceName, Events_count = count_\\r\\n| sort by Events_count\",\"size\":0,\"title\":\"Top Affected Network Devices\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"exportMultipleValues\":true,\"exportedParameters\":[{\"fieldName\":\"Network_Device_name\",\"parameterName\":\"Network_Device_name\",\"parameterType\":1}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"sortBy\":[{\"itemKey\":\"Events_count\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"Events_count\",\"sortOrder\":2}],\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Network_Device_name\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Events_count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"name\":\"topNetworkDevices\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let maliciousIP = ThreatIntelligenceIndicator | distinct NetworkIP | where isnotempty(NetworkIP);\\r\\nCiscoMeraki\\r\\n| where isnotempty(DeviceName)\\r\\n| extend LogType = iif(isempty(LogType), \\\"empty\\\", LogType)\\r\\n| where DeviceName in ('' {Network_Device_name}) and LogType in ('' {SelectLogType})\\r\\n| project DeviceName, LogType, SrcIpAddr, SrcPortNumber, SrcMacAddr, DstIpAddr, DstPortNumber, DstMacAddr, Action\\r\\n| extend Found_in_Threat_Intel = iif(SrcIpAddr in (maliciousIP) or DstIpAddr in (maliciousIP), \\\"Yes\\\", \\\"No\\\")\\r\\n| project-reorder Found_in_Threat_Intel\\r\\n| order by Found_in_Threat_Intel, LogType\",\"size\":0,\"title\":\"Events from Affected Network Device(s)\",\"noDataMessage\":\"Please select Affected Network Device(s) from the left section to view results.\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"50\",\"name\":\"topNetworkDevicesDetails\"}]},\"conditionalVisibility\":{\"parameterName\":\"VisibleTabName\",\"comparison\":\"isEqualTo\",\"value\":\"DeviceThreats\"},\"name\":\"DeviceThreat\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"0633e46b-060b-4665-99ce-1ff11b892575\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SelectLogType\",\"label\":\"Log Types\",\"type\":2,\"description\":\"Select the Log Type to filter the data\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"\\\"\",\"delimiter\":\",\",\"query\":\"CiscoMeraki\\r\\n| distinct LogType\\r\\n| extend LogType = iff(isempty(LogType),\\\"empty\\\",LogType)\\r\\n| sort by LogType asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parametersIPEvents\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoMeraki\\r\\n| where LogType in ('' {SelectLogType})\\r\\n| where isnotempty(SrcIpAddr)\\r\\n| summarize count() by SrcIpAddr\\r\\n| sort by count_\",\"size\":0,\"title\":\"Top Affected Source IP Addresses\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"exportMultipleValues\":true,\"exportedParameters\":[{\"fieldName\":\"SrcIpAddr\",\"parameterName\":\"SrcIpAddr\",\"parameterType\":1}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"blueDark\"}}]}},\"customWidth\":\"30\",\"name\":\"topIPAddress\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoMeraki\\r\\n| where LogType in ('' {SelectLogType})\\r\\n| where isnotempty(SrcIpAddr)\\r\\n| where SrcIpAddr in ('' {SrcIpAddr})\\r\\n| project DeviceName, LogType, SrcIpAddr, SrcPortNumber, SrcMacAddr, DstIpAddr, DstPortNumber, DstMacAddr\",\"size\":0,\"title\":\"Events from Affected IP Addresses\",\"noDataMessage\":\"Please select Affected IP(s) from the left section to view results.\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"70\",\"name\":\"topIPAddressDetails\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoMeraki\\r\\n| where LogType in ('' {SelectLogType})\\r\\n| where isnotempty(DstIpAddr)\\r\\n| summarize count() by DstIpAddr\\r\\n| sort by count_\",\"size\":0,\"title\":\"Top Affected Destination IP Addresses\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"exportMultipleValues\":true,\"exportedParameters\":[{\"fieldName\":\"DstIpAddr\",\"parameterName\":\"DstIpAddr\",\"parameterType\":1}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"blueDark\"}}]}},\"customWidth\":\"30\",\"name\":\"topOutboundDestination\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoMeraki\\r\\n| where LogType in ('' {SelectLogType})\\r\\n| where isnotempty(DstIpAddr)\\r\\n| where DstIpAddr in ('' {DstIpAddr})\\r\\n| project DeviceName, LogType, SrcIpAddr, SrcPortNumber, SrcMacAddr, DstIpAddr, DstPortNumber, DstMacAddr\",\"size\":0,\"title\":\"Events from Affected IP Addresses\",\"noDataMessage\":\"Please select Affected Outbound Destination(s) from the left section to view results.\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"70\",\"name\":\"topOutboundDestinationDetails\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoMeraki\\r\\n| where LogType in ('' {SelectLogType})\\r\\n| where isnotempty(SrcPortNumber)\\r\\n| summarize count() by SrcPortNumber\\r\\n| sort by count_\",\"size\":0,\"title\":\"Top Events by Source Port\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"exportMultipleValues\":true,\"exportedParameters\":[{\"fieldName\":\"SrcPortNumber\",\"parameterName\":\"SrcPortNumber\",\"parameterType\":1}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"blueDark\"}}]}},\"customWidth\":\"30\",\"name\":\"topSourcePort\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoMeraki\\r\\n| where LogType in ('' {SelectLogType})\\r\\n| where SrcPortNumber in (\\\"0\\\" {SrcPortNumber})\\r\\n| project DeviceName, LogType, SrcIpAddr, SrcPortNumber, SrcMacAddr, DstIpAddr, DstPortNumber, DstMacAddr\",\"size\":0,\"title\":\"Events from Affected Source Port(s)\",\"noDataMessage\":\"Please select Affected Port(s) from the left section to view results.\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"70\",\"name\":\"topSourcePortDetails\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoMeraki\\r\\n| where LogType in ('' {SelectLogType})\\r\\n| where isnotempty(DstPortNumber)\\r\\n| summarize count() by DstPortNumber\\r\\n| sort by count_\",\"size\":0,\"title\":\"Top Events by Destination Port\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"exportMultipleValues\":true,\"exportedParameters\":[{\"fieldName\":\"DstPortNumber\",\"parameterName\":\"DstPortNumber\",\"parameterType\":1}],\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"count_\",\"formatter\":3,\"formatOptions\":{\"min\":0,\"palette\":\"blueDark\"}}]}},\"customWidth\":\"30\",\"name\":\"topDestinationPort\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoMeraki\\r\\n| where LogType in ('' {SelectLogType})\\r\\n| where DstPortNumber in (\\\"0\\\" {DstPortNumber})\\r\\n| project DeviceName, LogType, SrcIpAddr, SrcPortNumber, SrcMacAddr, DstIpAddr, DstPortNumber, DstMacAddr\",\"size\":0,\"title\":\"Events from Affected Destination Port(s)\",\"noDataMessage\":\"Please select Affected Port(s) from the left section to view results.\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"customWidth\":\"70\",\"name\":\"topDestinationPortDetails\"}]},\"conditionalVisibility\":{\"parameterName\":\"VisibleTabName\",\"comparison\":\"isEqualTo\",\"value\":\"IPThreats\"},\"name\":\"IpThreat\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":1,\"content\":{\"json\":\"Found_in_Threat_Intel correlates Sha256 with Threat Intelligence data present in Sentinel. This helps identify new threat intelligence information that you can use to further enhance your overall security posture.\",\"style\":\"info\"},\"name\":\"noteMalwareDetected\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let maliciousFileHash = ThreatIntelligenceIndicator | where isnotempty(FileHashValue) | distinct FileHashValue;\\r\\nCiscoMeraki\\r\\n| where Disposition == \\\"malicious\\\"\\r\\n| summarize Instances=count() by DeviceName, Sha256, Url, Action\\r\\n| extend Found_in_Threat_Intel = iif(isnotempty(Sha256) and Sha256 in (maliciousFileHash), \\\"Yes\\\", \\\"No\\\")\\r\\n| project-reorder Found_in_Threat_Intel, DeviceName, Sha256, Url, Action, Instances\\r\\n| order by Found_in_Threat_Intel, Instances\",\"size\":0,\"title\":\"Top Malware Detections\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IsMalicious\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"blue\",\"compositeBarSettings\":{\"labelText\":\"\"}}},{\"columnMatch\":\"Sha256_s\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80ch\"}},{\"columnMatch\":\"Url_s\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"70ch\"}}]}},\"name\":\"topMalwareDetected\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let maliciousFileHash = ThreatIntelligenceIndicator | where isnotempty(FileHashValue) | distinct FileHashValue;\\r\\nCiscoMeraki\\r\\n| where Disposition == \\\"malicious\\\" and Action == \\\"deny\\\"\\r\\n| summarize Instances=count() by DeviceName, Sha256, Url, Action\\r\\n| extend Found_in_Threat_Intel = iif(isnotempty(Sha256) and Sha256 in (maliciousFileHash), \\\"Yes\\\", \\\"No\\\")\\r\\n| project-reorder Found_in_Threat_Intel, DeviceName, Sha256, Url, Action, Instances\\r\\n| order by Found_in_Threat_Intel, Instances\",\"size\":0,\"title\":\"Top Retrospective Malware Detections\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Sha256_s\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"80ch\"}},{\"columnMatch\":\"Url_s\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"70ch\"}}]}},\"name\":\"topRetrospectiveMalwareDetected\"}]},\"conditionalVisibility\":{\"parameterName\":\"VisibleTabName\",\"comparison\":\"isEqualTo\",\"value\":\"MalwareThreats\"},\"name\":\"MalwareThreats\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"e75c556b-b636-4599-83cc-b8f9c38d7f60\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"DeviceName\",\"label\":\"Device Name\",\"type\":2,\"description\":\"Select the Device Name to filter the data\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"\\\"\",\"delimiter\":\",\",\"query\":\"CiscoMeraki\\r\\n| distinct DeviceName\\r\\n| extend DeviceName = iif(isempty(DeviceName), \\\"empty\\\", DeviceName)\\r\\n| order by DeviceName asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"f67ad484-ff20-49cb-afa6-93c1be8debab\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"LogType\",\"label\":\"Log Type\",\"type\":2,\"description\":\"Select the Log Type to filter the data\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"\\\"\",\"delimiter\":\",\",\"query\":\"CiscoMeraki\\r\\n| distinct LogType\\r\\n| extend LogType = iif(isempty(LogType), \\\"empty\\\", LogType)\\r\\n| order by LogType asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"8077dc84-a7c8-4bb4-b826-fec999bbdc34\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SrcIpAddr\",\"label\":\"Source IP Address\",\"type\":2,\"description\":\"Select the Source IP Address to filter the data\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"\\\"\",\"delimiter\":\",\",\"query\":\"CiscoMeraki\\r\\n| distinct SrcIpAddr\\r\\n| extend SrcIpAddr = iif(isempty(SrcIpAddr), \\\"-\\\", SrcIpAddr)\\r\\n| sort by SrcIpAddr asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"928b0767-1430-4e75-9978-6bfbc7166af1\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SrcPortNumber\",\"label\":\"Source Port Number\",\"type\":2,\"description\":\"Select the Source Port Number to filter the data\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"\\\"\",\"delimiter\":\",\",\"query\":\"CiscoMeraki\\r\\n| distinct SrcPortNumber\\r\\n| extend SrcPortNumber = iif(isempty(SrcPortNumber), 0, SrcPortNumber)\\r\\n| sort by SrcPortNumber asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"648072e7-2c48-45fc-99ab-b1c963de1c1b\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SrcMacAddr\",\"label\":\"Source Mac Address\",\"type\":2,\"description\":\"Select the Source MAC Address to filter the data\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"\\\"\",\"delimiter\":\",\",\"query\":\"CiscoMeraki\\r\\n| distinct SrcMacAddr\\r\\n| extend SrcMacAddr = iif(isempty(SrcMacAddr), \\\"-\\\", SrcMacAddr)\\r\\n| sort by SrcMacAddr asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"33c73a68-1916-4ca4-865c-40c456747c17\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"DstIpAddr\",\"label\":\"Destination IP Address\",\"type\":2,\"description\":\"Select the Destination IP Address to filter the data\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"\\\"\",\"delimiter\":\",\",\"query\":\"CiscoMeraki\\r\\n| distinct DstIpAddr\\r\\n| extend DstIpAddr = iif(isempty(DstIpAddr), \\\"-\\\", DstIpAddr)\\r\\n| sort by DstIpAddr asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"d3a39bb1-1500-4274-ba6f-e987f1e732a8\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"DstPortNumber\",\"label\":\"Destination Port Number\",\"type\":2,\"description\":\"Select the Destination Port Number to filter the data\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"\\\"\",\"delimiter\":\",\",\"query\":\"CiscoMeraki\\r\\n| distinct DstPortNumber\\r\\n| extend DstPortNumber = iif(isempty(DstPortNumber), 0, DstPortNumber)\\r\\n| sort by DstPortNumber asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"06b715b9-0e2d-42c5-a7d4-8fb3398f2e0d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"DstMacAddr\",\"label\":\"Destination Mac Address\",\"type\":2,\"description\":\"Select the Destination MAC Address to filter the data\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"\\\"\",\"delimiter\":\",\",\"query\":\"CiscoMeraki\\r\\n| distinct DstMacAddr\\r\\n| extend DstMacAddr = iif(isempty(DstMacAddr), \\\"-\\\", DstMacAddr)\\r\\n| sort by DstMacAddr asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"7b6901f3-d646-4e1c-8e83-10c48de6a68e\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"HttpRequestMethod\",\"label\":\"HTTP Request Method\",\"type\":2,\"description\":\"Select the HTTP Request Method to filter the data\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"\\\"\",\"delimiter\":\",\",\"query\":\"CiscoMeraki\\r\\n| distinct HttpRequestMethod\\r\\n| extend HttpRequestMethod = iif(isempty(HttpRequestMethod), \\\"empty\\\", HttpRequestMethod)\\r\\n| order by HttpRequestMethod asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"f73f8622-3281-4f88-827a-0df99a944af6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Url\",\"type\":2,\"description\":\"Select the Url to filter the data\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"\\\"\",\"delimiter\":\",\",\"query\":\"CiscoMeraki\\r\\n| distinct Url\\r\\n| extend Url = iif(isempty(Url), \\\"empty\\\", Url)\\r\\n| order by Url asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"fe51c740-f63c-491c-9734-63e612bf68a8\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"NetworkProtocol\",\"label\":\"Network Protocol\",\"type\":2,\"description\":\"Select the Network Protocol to filter the data\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"\\\"\",\"delimiter\":\",\",\"query\":\"CiscoMeraki\\r\\n| distinct NetworkProtocol\\r\\n| extend NetworkProtocol = iif(isempty(NetworkProtocol), \\\"empty\\\", NetworkProtocol)\\r\\n| order by NetworkProtocol asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"38c497b4-9962-4beb-b132-24eb267d68ac\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"NetworkDirection\",\"label\":\"Network Direction\",\"type\":2,\"description\":\"Select the Network Direction to filter the data\",\"isRequired\":true,\"multiSelect\":true,\"quote\":\"\\\"\",\"delimiter\":\",\",\"query\":\"CiscoMeraki\\r\\n| distinct NetworkDirection\\r\\n| extend NetworkDirection = iif(isempty(NetworkDirection), \\\"empty\\\", NetworkDirection)\\r\\n| order by NetworkDirection asc\",\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":2592000000},\"timeContextFromParameter\":\"TimeRange\",\"defaultValue\":\"value::all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parametersAllEvents\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"CiscoMeraki \\r\\n| project\\r\\n    TimeGenerated,\\r\\n    DeviceName=coalesce(DeviceName,\\\"empty\\\"),\\r\\n    LogType=coalesce(LogType,\\\"empty\\\"),\\r\\n    SrcIpAddr=coalesce(SrcIpAddr,\\\"-\\\"),\\r\\n    SrcPortNumber=coalesce(SrcPortNumber,0),\\r\\n    SrcMacAddr=coalesce(SrcMacAddr,\\\"-\\\"),\\r\\n    DstIpAddr=coalesce(DstIpAddr,\\\"-\\\"),\\r\\n    DstPortNumber=coalesce(DstPortNumber,0),\\r\\n    DstMacAddr=coalesce(DstMacAddr,\\\"-\\\"),\\r\\n    HttpRequestMethod=coalesce(HttpRequestMethod,\\\"empty\\\"),\\r\\n    Url=coalesce(Url,\\\"empty\\\"),\\r\\n    NetworkProtocol=coalesce(NetworkProtocol,\\\"empty\\\"),\\r\\n    NetworkDirection=coalesce(NetworkDirection,\\\"empty\\\")\\r\\n| where DeviceName in ('' {DeviceName:value}) and LogType in ('' {LogType:value}) and SrcIpAddr in ('' {SrcIpAddr:value}) and SrcMacAddr in ('' {SrcMacAddr:value}) and DstIpAddr in ('' {DstIpAddr:value}) and DstMacAddr in ('' {DstMacAddr:value}) and HttpRequestMethod in ('' {HttpRequestMethod:value}) and Url in ('' {Url:value}) and NetworkProtocol in ('' {NetworkProtocol:value}) and NetworkDirection in ('' {NetworkDirection:value})\\r\\n| where SrcPortNumber in ('' {SrcPortNumber:value}) and DstPortNumber in ('' {DstPortNumber:value})\\r\\n| order by TimeGenerated\",\"size\":0,\"title\":\"All Events\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"allEvents\"}]},\"conditionalVisibility\":{\"parameterName\":\"VisibleTabName\",\"comparison\":\"isEqualTo\",\"value\":\"allEvents\"},\"name\":\"AllMerakiEvents\"}],\"fromTemplateId\":\"sentinel-CiscoMerakiWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": ".description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "Cisco Meraki Security Event",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "Microsoft",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Microsoft Corporation",
                  "email": "support@microsoft.com",
                  "tier": "Microsoft",
                  "link": "https://support.microsoft.com"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "kind": "Workbook",
                      "contentId": "[variables('workbookContentId1')]",
                      "version": "1.0.0"
                    },
                    {
                      "contentId": "meraki_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "CiscoMerakiNativePoller",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "ThreatIntelligenceIndicator",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "MerakiConnector",
                      "kind": "DataConnector"
                    },
                    {
                      "contentId": "CiscoMerakiNativePolling",
                      "kind": "DataConnector"
                    },
                    {
                      "contentId": "ThreatIntelligence",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "apiVersion": "2022-01-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "2.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "2.0.0",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "Cisco Meraki Security Event",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "Microsoft",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Microsoft Corporation",
          "email": "support@microsoft.com",
          "tier": "Microsoft",
          "link": "https://support.microsoft.com"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentId1')]",
              "version": "[variables('dataConnectorVersion1')]"
            },
            {
              "kind": "Parser",
              "contentId": "[variables('_parserContentId1')]",
              "version": "[variables('parserVersion1')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            }
          ]
        },
        "firstPublishDate": "2022-05-27",
        "providers": [
          "Cisco"
        ],
        "categories": {
          "domains": [
            "Security - Network"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
