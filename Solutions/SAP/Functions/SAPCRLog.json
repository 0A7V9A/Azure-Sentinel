{
    "properties": {
        "category": "SAPFunctions",
        "displayName": "SAPCRLog",
        "query": "//generated function structure for custom log ABAPCRLog_CL \n//generated on 2022-10-13 \n//Sentinel4SAP solution version 2.0.30 \n\n// ABAPCRLog_CL is a custom log that held the change requests coming from S4S agents untill October 2022\nlet D_ABAPCRLog_CL = datatable(TimeGenerated:datetime \n,Request:string\n,Description:string\n,Category:string\n,ClientID:string\n,Owner:string\n,Status:string\n,ObjectType:string\n,ObjectName:string\n,TableName:string\n,ViewName:string\n,TableKey:string\n,SystemID:string\n,SystemNumber:string\n,Instance:string\n,Host:string\n,Type:string\n)['1000-01-01T00:00:00Z','initialString','initialString','initialString','initialString','initialString','initialString','initialString','initialString','initialString','initialString','initialString','initialString','initialString','initialString','initialString','initialString'];\nlet T_ABAPCRLog_CL = (ABAPCRLog_CL | project \nTimeGenerated = column_ifexists('TimeGenerated', '1000-01-01T00:00:00Z')\n,Request = column_ifexists('Request_s', 'initialString')\n,Description = column_ifexists('Description_s', 'initialString')\n,Category = column_ifexists('Category', 'initialString')\n,ClientID = column_ifexists('ClientID_s', 'initialString')\n,Owner = column_ifexists('Owner_s', 'initialString')\n,Status = column_ifexists('Status_s', 'initialString')\n,ObjectType = column_ifexists('ObjectType_s', 'initialString')\n,ObjectName = column_ifexists('ObjectName_s', 'initialString')\n,TableName = column_ifexists('TableName_s', 'initialString')\n,ViewName = column_ifexists('ViewName_s', 'initialString')\n,TableKey = column_ifexists('TableKey_s', 'initialString')\n,SystemID = column_ifexists('SystemID_s', 'initialString')\n,SystemNumber = column_ifexists('SystemNumber_s', 'initialString')\n,Instance = column_ifexists('Instance_s', 'initialString')\n,Host = column_ifexists('Host_s', 'initialString')\n,Type = column_ifexists('Type', 'initialString')\n);\n// ABAPCRLogHeader_CL is a custom log that holds the change requests headers coming from S4S agents starting from October 2022\nlet D_ABAPCRLogHeader_CL = datatable(TimeGeneratedHeader:datetime \n, TimeGenerated: datetime\n,UpdatedOn: datetime \n,Request:string\n,Description:string\n,Category:string\n,ClientID:string\n,Owner:string\n,Status:string\n,SystemID:string\n,SystemNumber:string\n,Instance:string\n,Host:string\n,Type:string\n)['1000-01-01T00:00:00Z', '1000-01-01T00:00:00Z', '1000-01-01T00:00:00Z','initialString','initialString','initialString','initialString','initialString','initialString','initialString','initialString','initialString','initialString','initialString'];\nlet T_CRHeader= ABAPCRLogHeader_CL\n| where TimeGenerated < now() \n// | project-rename TimeGeneratedHeader= TimeGenerated\n| project TimeGeneratedHeader = column_ifexists('TimeGenerated', todatetime('1000-01-01T00:00:00Z'))\n,Request = column_ifexists('Request_s', 'initialString')\n,Description = column_ifexists('Description_s', 'initialString')\n,Category = column_ifexists('Category', 'initialString')\n,ClientID = column_ifexists('ClientID_s', 'initialString')\n,Owner = column_ifexists('Owner_s', 'initialString')\n,Status = column_ifexists('Status_s', 'initialString')\n,SystemID = column_ifexists('SystemID_s', 'initialString')\n,SystemNumber = column_ifexists('SystemNumber_s', 'initialString')\n,Instance = column_ifexists('Instance_s', 'initialString')\n,Host = column_ifexists('Host_s', 'initialString')\n,Type = column_ifexists('Type', 'initialString')\n, UpdatedOn= column_ifexists('UpdatedOn_t', '1000-01-01T00:00:00Z');\n// ABAPCRLogLine_CL is a custom log that holds the change requests line items coming from S4S agents starting October 2022\nlet D_ABAPCRLogLine_CL = datatable(TimeGenerated:datetime \n,Request:string\n,ObjectType:string\n,ObjectName:string\n,TableName:string\n,ViewName:string\n,TableKey:string\n,SystemID:string\n)['1000-01-01T00:00:00Z','initialString','initialString','initialString','initialString','initialString','initialString','initialString'];\nlet T_CRLine= ABAPCRLogLine_CL\n| where TimeGenerated < now()\n| project-away TenantId, SourceSystem, Host_s, Instance_s, MG, ManagementGroupName, Type, _ResourceId\n| project TimeGenerated = column_ifexists('TimeGenerated', '1000-01-01T00:00:00Z')\n,Request = column_ifexists('Request_s', 'initialString')\n,ObjectType = column_ifexists('ObjectType_s', 'initialString')\n,ObjectName = column_ifexists('ObjectName_s', 'initialString')\n,TableName = column_ifexists('TableName_s', 'initialString')\n,ViewName = column_ifexists('ViewName_s', 'initialString')\n,TableKey = column_ifexists('TableKey_s', 'initialString')\n,SystemID = column_ifexists('SystemID_s', 'initialString');\n// create a view that details that \"stiches\" the CR header and line together\nlet T_CRLogVT = (T_CRHeader | union isfuzzy=true D_ABAPCRLogHeader_CL) | join kind=inner  (T_CRLine | union isfuzzy=true (D_ABAPCRLogLine_CL | project-away TimeGenerated)) on Request, SystemID\n| project-away Request1, SystemID1\n| where TimeGenerated != '1000-01-01T00:00:00Z'\n| where SystemID != 'initialString'\n| extend Type= \"ABAPCRLog_CL_VT\";\n// union the old agent data (ABAPCRLog_CL) with newer agents data (ABAPCRLogHeader_CL joined with ABAPCRLogLine_CL)\nT_ABAPCRLog_CL | union isfuzzy= true D_ABAPCRLog_CL , T_CRLogVT\n| where TimeGenerated != '1000-01-01T00:00:00Z'\n",
        "functionAlias": "SAPCRLog",
        "version": 2,
        "etag": "*"
    },
    "name": "SAPCRLog",
    "type": "savedSearches",
    "apiVersion": "2022-10-01"
}