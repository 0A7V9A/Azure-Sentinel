Parser:
  Title: DNS activity ASIM parser
  Version: '0.4'
  LastUpdated: Oct 13th 2021
Product:
  Name: Source agnostic
Normalization:
  Schema: Dns
  Version: '0.1.3'
References:
- Title: ASIM DNS Schema
  Link: https://aka.ms/ASimDnsDoc
- Title: ASIM
  Link: https://aka.ms/AboutASIM
Description: |
  This ASIM parser supports normalizing DNS activity logs from all supported sources to the ASIM DNS activity normalized schema.
ParserName: ASimDns
EquivalentBuiltInParser: _ASim_Dns 
Parsers:
  - _Im_Dns_Empty
  - _ASim_Dns_CiscoUmbrella
  - _ASim_Dns_InfobloxNIOS
  - _ASim_Dns_MicrosoftOMS
  - _ASim_Dns_Gcp     
  - _ASim_Dns_CorelightZeek   
  - _ASim_Dns_MicrosoftSysmon
  - _ASim_Dns_AzureFirewall
  - _ASim_Dns_MicrosoftNXlog
  - _ASim_Dns_ZscalerZIA
  - _ASim_Dns_Native

ParserQuery: |
  let DisabledParsers=materialize(_GetWatchlist('ASimDisabledParsers') | where SearchKey in ('Any', 'Exclude_ASimDns') | extend SourceSpecificParser=column_ifexists('SourceSpecificParser','') | distinct SourceSpecificParser);
  let imDnsBuiltInDisabled=toscalar('Exclude_ASimDnsBuiltIn' in (DisabledParsers) or 'Any' in (DisabledParsers)); 
  union isfuzzy=true
    vimDnsEmpty
    , ASimDnsCiscoUmbrella     (imDnsBuiltInDisabled or ('Exclude_ASimDnsCiscoUmbrella'      in (DisabledParsers) ))
    , ASimDnsInfobloxNIOS      (imDnsBuiltInDisabled or ('Exclude_ASimDnsInfobloxNIOS'       in (DisabledParsers) ))
    , ASimDnsMicrosoftOMS      (imDnsBuiltInDisabled or ('Exclude_ASimDnsMicrosoftOMS'       in (DisabledParsers) ))
    , ASimDnsGcp               (imDnsBuiltInDisabled or ('Exclude_ASimDnsDnsGcp'             in (DisabledParsers) ))
    , ASimDnsCorelightZeek     (imDnsBuiltInDisabled or ('Exclude_ASimDnsCorelightZeek'      in (DisabledParsers) ))
    , ASimDnsMicrosoftSysmon   (imDnsBuiltInDisabled or ('Exclude_ASimDnsMicrosoftSysmon'    in (DisabledParsers) ))
    , ASimDnsAzureFirewall     (imDnsBuiltInDisabled or ('Exclude_ASimASimDnsAzureFirewall'  in (DisabledParsers) ))
    , ASimDnsMicrosoftNXlog    (imDnsBuiltInDisabled or ('Exclude_ASimDnsMicrosoftNXlog'     in (DisabledParsers) ))
    , ASimDnsZscalerZIA        (imDnsBuiltInDisabled or ('Exclude_ASimDnsZscalerZIA'         in (DisabledParsers) ))
    , ASimDnsNative            (imDnsBuiltInDisabled or ('Exclude_ASimDnsNative'             in (DisabledParsers) ))