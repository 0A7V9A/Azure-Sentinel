{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "workspaceName": {
            "type": "string"
        },
        "location": {
            "type": "string"
        },
        "infobloxComputer": {
            "type": "string",
            "metadata": {
                "description": "Comma separated list of quoted Infoblox computer names"
            }
        }
    },
    "variables": {},
    "resources": [
        {
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
            "name": "linkedInfoblox",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "https://raw.githubusercontent.com/Azure/Azure-Sentinel/dev/Normalization/Parsers/Normalized%20Schema%20-%20DNS%20Events/ARM/Infoblox/Infoxblox.json",
                    "contentVersion": "1.0.0.0"
                },
                "parameters": {
                    "workspaceName": {
                        "value": "[parameters('workspaceName')]"
                    },
                    "location": {
                        "value": "[parameters('location')]"
                    },
                    "infobloxComputer": {
                        "value": "[parameters('infobloxComputer')]"
                    }
                }
            }
        },
        {
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
            "name": "linkedCiscoUmbrella",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "https://raw.githubusercontent.com/Azure/Azure-Sentinel/dev/Normalization/Parsers/Normalized%20Schema%20-%20DNS%20Events/ARM/CiscoUmbrella/CiscoUmbrella.json",
                    "contentVersion": "1.0.0.0"
                },
                "parameters": {
                    "workspaceName": {
                        "value": "[parameters('workspaceName')]"
                    },
                    "location": {
                        "value": "[parameters('location')]"
                    },
                    "infobloxComputer": {
                        "value": "[parameters('infobloxComputer')]"
                    }
                }
            }
        },
        {
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
            "name": "linkedMicrosoftDns",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "https://raw.githubusercontent.com/Azure/Azure-Sentinel/dev/Normalization/Parsers/Normalized%20Schema%20-%20DNS%20Events/ARM/Microsoft/Microsoft.json",
                    "contentVersion": "1.0.0.0"
                },
                "parameters": {
                    "workspaceName": {
                        "value": "[parameters('workspaceName')]"
                    },
                    "location": {
                        "value": "[parameters('location')]"
                    },
                    "infobloxComputer": {
                        "value": "[parameters('infobloxComputer')]"
                    }
                }
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
            "apiVersion": "2020-08-01",
            "name": "Microsoft.OperationalInsights/workspaces/Information Model - Dns",
            "dependsOn": [
                "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
            ],
            "properties": {
                "etag": "*",
                "displayName": "Information Model - Dns",
                "category": "Security",
                "FunctionAlias": "imDns",
                "query": "union isfuzzy=true vimDnsEmpty, vimDnsCisco , vimDnsInfoblox , vimDnsMicrosoft",
                "version": 1
            }
        },
        {
            "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
            "apiVersion": "2020-08-01",
            "name": "Microsoft.OperationalInsights/workspaces/Dns",
            "dependsOn": [
                "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
            ],
            "properties": {
                "etag": "*",
                "displayName": "Dns",
                "category": "Security",
                "FunctionAlias": "vimDnsEmpty",
                "query": "let EmptyNewDnsEvents=datatable(TimeGenerated:datetime , _ResourceId:string , Type:string , EventCount:int  , EventStartTime:datetime , EventType:string , EventResult:string , EventResultDetails:string , EventProduct:string , EventVendor:string  , EventSchemaVersion:string , Dvc:string, EventMessage:string, EventSeverity:string, EventOriginalUid:string, EventReportUrl:string, TenantId:string, DvcHostname:string  , EventProductVersion:string  , DvcIpAddr:string  , DvcAction:string  , SrcIpAddr:string  , SrcPortNumber:int  , DstIpAddr:string  , DstPortNumber:int  , ResponseName:dynamic  , EventSubType:string  , Query:string  , QueryType:int  , QueryTypeName:string  , ResponseCode:int  , NetworkProtocol:string  , Flags:dynamic   , QueryClass:string  , QueryClassName:string  , SrcUserAadId:string  , SrcUserDomain:string  , SrcUserName:string  , SrcUserSid:string  , SrcUserUpn:string  , UrlCategory:string   , ThreatCategory:string  , EventEndTime:datetime   , ResponseCodeName:string   , DomainCategory:string   , IpAddr:string  , Domain:string  , TransactionIdHex:string  )[];  EmptyNewDnsEvents ",
                "version": 1
            }
        }
    ],
    "outputs": {
    }
}