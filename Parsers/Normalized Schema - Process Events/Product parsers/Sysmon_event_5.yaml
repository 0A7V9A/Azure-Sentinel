Parser:
  Title: Sysmon event no. 5 - Process terminated
  Version: '0.1'
  LastUpdated: May 30, 2021
Product:
  Name: System Monitor
Normalization:
  Schema: ProcessEvents
  Version: '1.0.0'
References:
- Title: Using functions
  Link: https://docs.microsoft.com
- Title: Tech Community
  Link: https://techcommunity.microsoft.com
Description: Parser for Sysmon windows logs - event number 5; event Termination
ParserName: vimProcessEventsMicrosftSysmon5
ParserQuery: | 
            let ParsedProcessEvent=(){
                // Create the raw table from the raw XML file structure
                Event 
                | where Source == "Microsoft-Windows-Sysmon" and EventID==5 and TimeGenerated > ago(1d)
                | parse EventData with * '<Data Name="RuleName">'RuleName'</Data>'
                         '<Data Name="UtcTime">'UtcTime'</Data>'
                         '<Data Name="ProcessGuid">{'ProcessGuid'}</Data>'
                         '<Data Name="ProcessId">'ProcessId'</Data>'
                         '<Data Name="Image">'Image'</Data>' *
                | extend 
                        EventType = "ProcessTerminated",
                        EventStartTime = todatetime(TimeGenerated),
                        EventEndTime = todatetime(TimeGenerated),
                        EventCount = int(1),
                        EventVendor = "Microsoft",
                        EventSchemaVersion = "0.0.1",
                        EventProduct = "Sysmon",
                        DvcOs = "Windows"
                | project-rename
                        //***** Mandatory Fields - name change ******
                        DvcHostName = Computer,
                        //***** Optional Fields - name change ******
                        TargetUserName = UserName,
                        TargetProcessFilePath = Image,
                        TargetProcessId = ProcessId,
                        TargetProcessGuid = ProcessGuid,
                        EventOriginalId=EventID
                | project-away
                        EventLog,
                        EventLevel,
                        EventLevelName,
                        RenderedDescription,
                        UtcTime,
                        ParameterXml,
                        Source,
                        EventData
                 //***** Aliases ******
                | extend
                       TargetUser = TargetUserName,
                       TargetProcessName = TargetProcessFilePath,
                       Dvc = DvcHostName
                }; ParsedProcessEvent
