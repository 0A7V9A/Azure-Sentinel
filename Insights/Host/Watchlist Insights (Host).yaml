---
BaseQuery: |-
    let defaultValue = "defaultValue";
    let HostFQDN = strcat('{{Host_HostName}}', '.', '{{Host_DnsDomain}}');
    let hvas = _GetWatchlist('HighValueAssets');
    let GetHighValueAssets =
    hvas
    | extend AssetId = column_ifexists('Asset Id', defaultValue)
    | extend AssetFQDN = column_ifexists('Asset FQDN', defaultValue)
    | extend AssetName = column_ifexists('Asset Name', defaultValue)
    | extend Tags = column_ifexists('Tags', defaultValue)
    | extend IPAddress = column_ifexists('IP Address', defaultValue)
    | extend AssetType = column_ifexists('Asset Type', defaultValue)
    | where (AssetId != '' and AssetId == '{{Host_AzureID}}') or
            (AssetFQDN != '' and AssetFQDN == HostFQDN) or
            (AssetName != '' and AssetName == '{{Host_HostName}}') or
            (AssetId != '' and AssetId == '{{Host_OMSAgentID}}')
    | extend ['Watchlist Insight'] = 'Device is tagged as High Value Asset'
    | extend ['Additional Data'] = strcat('Asset Type: ',AssetType,', ','IP Address: ',IPAddress)
    | project ['Watchlist Insight'], ['Additional Data'],Tags;
    GetHighValueAssets
DataTypes:
  -
    DataType: "Watchlist templates"
EntitiesFilter: {}
Insights:
  DefaultTimeRange:
    AfterRange: 0d
    BeforeRange: 0d
  Description: |-
      ### Description
       ___
      This insight aggregates data from the watchlists templates (High Value Assets) regarding the device.
  DisplayName: "Watchlist Insights (Preview)"
  Id: 3834647e-ac3e-4fb4-a5f8-0dd50ba2b66b
  ReferenceTimeRange:
    BeforeRange: 0d
  SingleValuesQuery: {}
  TableQuery:
    ColumnsDefinitions:
      -
        Header: "Watchlist Insight"
        OutputType: String
        SupportDeepLink: false
      -
        Header: "Additional Data"
        OutputType: String
        SupportDeepLink: false
      -
        Header: Tags
        OutputType: String
        SupportDeepLink: false
    QueriesDefinitions:
      -
        Filter: " where 1 == 1"
        Project: " project ['Watchlist Insight'], ['Additional Data'], Tags"
        Summarize: " summarize count() by ['Watchlist Insight'], ['Additional Data'], Tags"
Provider: Sentinel
RequiredInputFieldsSets:
  - - Host_HostName
    - Host_DnsDomain
  - - Host_AzureID
  - - Host_OMSAgentID
SchemaVersion: "1.0"
Type: KQL
