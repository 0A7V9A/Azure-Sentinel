--- 
BaseQuery: |-
    let HostFQDN = strcat('{{Host_HostName}}', '.', '{{Host_DnsDomain}}');
    let hostsSchemaDatatable = datatable (['Asset Type']:string, ['Asset Id']:guid, ['Asset Name']:string, ['Asset FQDN']:string,	['IP Address']:string, ['Tags']:string) [];
    let hvas = union isfuzzy=true hostsSchemaDatatable,  _GetWatchlist('HighValueAssets');
    let GetHighValueAssets = hvas | where (['Asset Id'] != '' and ['Asset Id'] == '{{Host_AzureID}}') or (['Asset FQDN'] != '' and ['Asset FQDN'] == HostFQDN) or (['Asset Name'] != '' and ['Asset Name'] == '{{Host_HostName}}') or (['Asset Id'] != '' and ['Asset Id'] == '{{Host_OMSAgentID}}')  | extend ['Watchlist Insight'] = 'Device is tagged as High Value Asset'| extend ['Additional Data'] = strcat('Asset Type: ',['Asset Type'],', ','IP Address: ',['IP Address']) | project ['Watchlist Insight'],['Additional Data'],Tags;
    GetHighValueAssets   
DataTypes: 
  - 
    DataType: "Watchlist templates"
EntitiesFilter: {}
Insights: 
  DefaultTimeRange: 
    AfterRange: 0d
    BeforeRange: 0d
  Description: |-
      ### Description
       ___ 
      This insight aggregates data from the watchlists templates (High Value Assets) regarding the device.
  DisplayName: "Watchlist Insights (Preview)"
  Id: 3834647e-ac3e-4fb4-a5f8-0dd50ba2b66b
  ReferenceTimeRange: 
    BeforeRange: 0d
  SingleValuesQuery: {}
  TableQuery: 
    ColumnsDefinitions: 
      - 
        Header: "Watchlist Insight"
        OutputType: String
        SupportDeepLink: false
      - 
        Header: "Additional Data"
        OutputType: String
        SupportDeepLink: false
      - 
        Header: Tags
        OutputType: String
        SupportDeepLink: false
    QueriesDefinitions: 
      - 
        Filter: " where 1 == 1"
        Project: " project ['Watchlist Insight'], ['Additional Data'], Tags"
        Summarize: " summarize count() by ['Watchlist Insight'], ['Additional Data'], Tags"
Provider: Sentinel
RequiredInputFieldsSets: 
  - - Host_HostName
    - Host_DnsDomain
  - - Host_AzureID
  - - Host_OMSAgentID
SchemaVersion: "1.0"
Type: KQL
