{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "metadata": {
        "title": "Logic Apps Custom Connectors and Playbook templates - ForcepointNGFW",
        "description": "This is a linked json file for deploying ForcepointNGFW custom connectors + 6 playbooks.",
        "prerequisites": [
            "1. Forcepoint SMC API Key should be known.[Refer here](http://www.websense.com/content/support/library/ngfw/v610/rfrnce/ngfw_6100_ug_smc-api_a_en-us.pdf )",
            "2. Forcepoint SMC Version number should be known. [Refer here](https://help.stonesoft.com/onlinehelp/StoneGate/SMC/)",
            "3. Forcepoint FUID version number should be known.[Refer here](https://www.websense.com/content/support/library/uid/v20/install/fuid_200_ht_integrate-fuid_a_en-us.pdf)",
            "4. Security policy rule name created in SMC should be known.",
            "5. Forcepoint FUID service endpoint should be known. (e.g.  https://forcepointdomain:PortNumber/})",
            "6. Forcepoint SMC service endpoint should be known. (e.g.  https://forcepointdomain:PortNumber/})",
            "7. Users must have access to Microsoft Teams and they should be a part of a Teams channel and also Power Automate app should be installed in the Microsoft Teams channel."

        ],
        "lastUpdateTime": "2021-07-26T00:00:00.000Z",
        "entities": [ "URLs", "IPs" ],
        "tags": [ "Enrichment", "Teams", "Block" ],
        "support": {
            "tier": "community"
        },
        "author": {
            "name": "Accenture"
        }
    },
    "parameters": {
        "linkedTemplateForcepointFUIDCustomConnectorURI": {
            "type": "string",
            "metadata": {
                "description": "The Uri of the linked template for FUID custom connector"
            }
        },
        "linkedTemplateForcepointSMCCustomConnectorURI": {
            "type": "string",
            "metadata": {
                "description": "The Uri of the linked template for SMC custom connector"
            }
        },
        "linkedTemplatePlaybookBlockOrUnblockIPTeamsURI": {
            "type": "string",
            "metadata": {
                "description": "The Uri of the linked template for block or unblock IP on teams playbook"
            }
        },
        "linkedTemplatePlaybookBlockIPByUsernameURI": {
            "type": "string",
            "metadata": {
                "description": "The Uri of the linked template for block IP by username playbook"
            }
        },
        "linkedTemplatePlaybookBlockIPURI": {
            "type": "string",
            "metadata": {
                "description": "The Uri of the linked template for Block IP playbook"
            }
        },

        "linkedTemplatePlaybookBlockURLURI": {
            "type": "string",
            "metadata": {
                "description": "The Uri of the linked template for Block URL playbook"
            }
        },
        "linkedTemplatePlaybookEnrichmentIPURI": {
            "type": "string",
            "metadata": {
                "description": "The Uri of the linked template for Enrichment IP playbook"
            }
        },
        "linkedTemplatePlaybookEnrichmentURLURI": {
            "type": "string",
            "metadata": {
                "description": "The Uri of the linked template for Enrichment URL playbook"
            }
        },
        "BlockorUnblockIPPlaybookName": {
            "type": "String",
            "metadata": {
                "description": "Enter name for block IP by username playbook without spaces"
            }
        },
        "BlockIPByUsernamePlaybookName": {
            "type": "String",
            "metadata": {
                "description": "Enter name for block IP by username playbook without spaces"
            }
        },
        "BlockIPPlaybookName": {
            "type": "String",
            "metadata": {
                "description": "Enter name for block or unblock IP playbook without spaces"
            }
        },
        "BlockURLPlaybookName": {
            "type": "String",
            "metadata": {
                "description": "Enter name for block or unblock URL playbook without spaces"
            }
        },
        "EnrichmentIPPlaybookName": {
            "type": "String",
            "metadata": {
                "description": "Enter name for enrichment IP playbook without spaces"
            }
        },
        "EnrichmentURLPlaybookName": {
            "type": "String",
            "metadata": {
                "description": "Enter name for enrichment URL playbook without spaces"
            }
        },
        "ForcepointSMCApiKey": {
            "type": "securestring",
            "metadata": {
                "description": "Enter the api key for smc login"
            }
        },
        "SMCVersionNumber": {
            "type": "string",
            "metadata": {
                "description": "Enter the version number of SMC"
            }
        },
        "FUIDVersionNumber": {
            "type": "string",
            "metadata": {
                "description": "Enter the version number of FUID"
            }
        },
        "SecurityPolicyRule": {
            "type": "string",
            "metadata": {
                "description": "Enter smc firewall security policy rule"
            }
        },
        "ForcepointFUIDConnectorName": {
            "type": "String",
            "metadata": {
                "description": "Enter the name for FUID Connector without spaces"
            }
        },
        "ServiceEndPointFUIDConnector": {
            "type": "String",
            "metadata": {
                "description": "Enter the ForcepointFUID Service EndPoint as 'https://{forcepointDomainname}:{portnumber}/'"
            }
        },
        "ForcepointSMCConnectorName": {
            "type": "String",
            "metadata": {
                "description": "Enter the name for SMC Connector without spaces"
            }
        },
        "ServiceEndPointSMCConnector": {
            "type": "String",
            "metadata": {
                "description": "Enter the ForcepointSMC Service EndPoint as 'https://{forcepointDomainname}:{portnumber}/' "
            }
        }
    },
    "variables": {},
    "resources": [
        {
            "name": "linkedTemplateForcepointFUIDCustomConnectorURI",
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2018-05-01",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "[parameters('linkedTemplateForcepointFUIDCustomConnectorURI')]"
                },
                "parameters": {
                    "ForcepointFUIDConnectorName": {
                        "value": "[parameters('ForcepointFUIDConnectorName')]"
                    },
                    "ServiceEndPoint": {
                        "value": "[parameters('ServiceEndPointFUIDConnector')]"
                    }
                }
            }
        },
        {
            "name": "linkedTemplateForcepointSMCCustomConnectorURI",
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2018-05-01",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "[parameters('linkedTemplateForcepointSMCCustomConnectorURI')]"
                },
                "parameters": {
                    "ForcepointSMCConnectorName": {
                        "value": "[parameters('ForcepointSMCConnectorName')]"
                    },
                    "ServiceEndPoint": {
                        "value": "[parameters('ServiceEndPointSMCConnector')]"
                    }
                }
            }
        },
        {
            "name": "linkedTemplatePlaybookBlockOrUnblockIPTeamsURI",
            "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'linkedTemplateForcepointSMCCustomConnectorURI')]"
            ],
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2018-05-01",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "[parameters('linkedTemplatePlaybookBlockOrUnblockIPTeamsURI')]"
                },
                "parameters": {
                    "PlaybookName": {
                        "Value": "[parameters('BlockorUnblockIPPlaybookName')]"
                    },
                    "ForcepointSMCConnectorName": {
                        "Value": "[parameters('ForcepointSMCConnectorName')]"
                    },
                    "ForcepointSMCApiKey": {
                        "Value": "[parameters('ForcepointSMCApiKey')]"
                    },
                    "VersionNumber": {
                        "Value": "[parameters('SMCVersionNumber')]"
                    },
                    "SecurityPolicyRule": {
                        "Value": "[parameters('SecurityPolicyRule')]"
                    }
                }
            }
        },
        {
            "name": "linkedTemplatePlaybookBlockIPByUsernameURI",
            "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'linkedTemplateForcepointFUIDCustomConnectorURI')]",
                "[resourceId('Microsoft.Resources/deployments', 'linkedTemplateForcepointSMCCustomConnectorURI')]"
            ],
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2018-05-01",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "[parameters('linkedTemplatePlaybookBlockIPByUsernameURI')]"
                },
                "parameters": {
                    "PlaybookName": {
                        "Value": "[parameters('BlockIPByUsernamePlaybookName')]"
                    },
                    "ForcepointSMCConnectorName": {
                        "Value": "[parameters('ForcepointSMCConnectorName')]"
                    },
                    "ForcepointSMCApiKey": {
                        "Value": "[parameters('ForcepointSMCApiKey')]"
                    },
                    "SMCVersionNumber": {
                        "Value": "[parameters('SMCVersionNumber')]"
                    },
                    "SecurityPolicyRule": {
                        "Value": "[parameters('SecurityPolicyRule')]"
                    },
                    "ForcepointFUIDConnectorName": {
                        "Value": "[parameters('ForcepointFUIDConnectorName')]"
                    },
                    "FUIDVersionNumber": {
                        "Value": "[parameters('FUIDVersionNumber')]"
                    }
                }
            }
        },
        {
            "name": "linkedTemplatePlaybookBlockIPURI",
            "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'linkedTemplateForcepointSMCCustomConnectorURI')]"
            ],
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2018-05-01",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "[parameters('linkedTemplatePlaybookBlockIPURI')]"
                },
                "parameters": {
                    "PlaybookName": {
                        "Value": "[parameters('BlockIPPlaybookName')]"
                    },
                    "ForcepointSMCConnectorName": {
                        "Value": "[parameters('ForcepointSMCConnectorName')]"
                    },
                    "ForcepointSMCApiKey": {
                        "Value": "[parameters('ForcepointSMCApiKey')]"
                    },
                    "VersionNumber": {
                        "Value": "[parameters('SMCVersionNumber')]"
                    },
                    "SecurityPolicyRule": {
                        "Value": "[parameters('SecurityPolicyRule')]"
                    }
                }
            }
        },
        {
            "name": "linkedTemplatePlaybookBlockURLURI",
            "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'linkedTemplateForcepointSMCCustomConnectorURI')]"
            ],
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2018-05-01",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "[parameters('linkedTemplatePlaybookBlockURLURI')]"
                },
                "parameters": {
                    "PlaybookName": {
                        "Value": "[parameters('BlockURLPlaybookName')]"
                    },
                    "ForcepointSMCConnectorName": {
                        "Value": "[parameters('ForcepointSMCConnectorName')]"
                    },
                    "ForcepointSMCApiKey": {
                        "Value": "[parameters('ForcepointSMCApiKey')]"
                    },
                    "VersionNumber": {
                        "Value": "[parameters('SMCVersionNumber')]"
                    },
                    "SecurityPolicyRule": {
                        "Value": "[parameters('SecurityPolicyRule')]"
                    }
                }
            }
        },
        {
            "name": "linkedTemplatePlaybookEnrichmentIPURI",
            "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'linkedTemplateForcepointSMCCustomConnectorURI')]"
            ],
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2018-05-01",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "[parameters('linkedTemplatePlaybookEnrichmentIPURI')]"
                },
                "parameters": {
                    "PlaybookName": {
                        "Value": "[parameters('EnrichmentIPPlaybookName')]"
                    },
                    "ForcepointSMCConnectorName": {
                        "Value": "[parameters('ForcepointSMCConnectorName')]"
                    },
                    "ForcepointSMCApiKey": {
                        "Value": "[parameters('ForcepointSMCApiKey')]"
                    },
                    "VersionNumber": {
                        "Value": "[parameters('SMCVersionNumber')]"
                    }
                }
            }
        },
        {
            "name": "linkedTemplatePlaybookEnrichmentURLURI",
            "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'linkedTemplateForcepointSMCCustomConnectorURI')]"
            ],
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2018-05-01",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "[parameters('linkedTemplatePlaybookENrichmentURLURI')]"
                },
                "parameters": {
                    "PlaybookName": {
                        "Value": "[parameters('EnrichmentURLPlaybookName')]"
                    },
                    "ForcepointSMCConnectorName": {
                        "Value": "[parameters('ForcepointSMCConnectorName')]"
                    },
                    "ForcepointSMCApiKey": {
                        "Value": "[parameters('ForcepointSMCApiKey')]"
                    },
                    "VersionNumber": {
                        "Value": "[parameters('SMCVersionNumber')]"
                    }
                }
            }
        }
    ]
}